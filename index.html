
<!-- 
To do for v2.372
    1. Add logo to hosting backend.
    2. Remove the analytics button from everywhere but the dashboard.

To do for v3.0
    1. Separate scripts and CSS to stop ballooning the HTML size.
    2. Add accounts and onboarding, to prevent bots.
    3. Add reCAPTCHA or hCAPTCHA depending on what isn't blocked.

To do for Future updates
    1. Add phone app

-->
<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-86DQ5HTDV9"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-86DQ5HTDV9');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lagiote Revise</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="https://i.ibb.co/1fyDzymL/Study-Stack-Pro-Photoroom.png">
    <style>
        :root {
            --bg-color: #f7fafc; --text-color: #333; --header-bg: white; --card-bg: white; --border-color: #e2e8f0; --border-dashed: #e2e8f0; --primary-color: #667eea; --primary-hover: #5a67d8; --secondary-text: #718096; --shadow-color: rgba(0,0,0,0.05); --input-bg: #f7fafc; --input-focus-bg: white; --button-secondary-bg: #e2e8f0; --button-secondary-text: #4a5568; --button-secondary-hover: #cbd5e0; --success-color: #38a169; --danger-color: #e53e3e;
        }
        .dark-mode {
            --bg-color: #1a202c; --text-color: #e2e8f0; --header-bg: #2d3748; --card-bg: #2d3748; --border-color: #4a5568; --border-dashed: #4a5568; --primary-color: #7f9cf5; --primary-hover: #667eea; --secondary-text: #a0aec0; --shadow-color: rgba(0,0,0,0.2); --input-bg: #2d3748; --input-focus-bg: #4a5568; --button-secondary-bg: #4a5568; --button-secondary-text: #e2e8f0; --button-secondary-hover: #718096; --success-color: #68d391; --danger-color: #fc8181;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: var(--bg-color); min-height: 100vh; color: var(--text-color); transition: background-color 0.3s, color 0.3s; }
        .view-container { display: none; }
        .view-container.animating { animation-duration: 0.4s; animation-timing-function: ease-in-out; animation-fill-mode: forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeOut { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(-10px); } }
        .fade-in { display: block !important; animation-name: fadeIn; }
        .fade-out { animation-name: fadeOut; }
        .sub-view.animating { animation-duration: 0.4s; animation-timing-function: ease-in-out; animation-fill-mode: forwards; }
        .sub-view-fade-in { display: flex !important; flex-direction: column; animation-name: fadeIn; }
        .sub-view-fade-out { animation-name: fadeOut; }
        @keyframes deckClick { 0% { transform: scale(1); } 50% { transform: scale(0.97); } 100% { transform: scale(1); } }
        .deck-clicked { animation: deckClick 0.3s ease-in-out; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .section-title { font-size: 1.4rem; font-weight: 600; color: var(--text-color); margin-bottom: 25px; }
        .hidden { display: none !important; }
        .app-header { background: var(--header-bg); padding: 15px 20px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
        .logo-section { display: flex; align-items: center; gap: 15px; }
        .header-btn { background: var(--button-secondary-bg); border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; display: flex; align-items: center; justify-content: center; color: var(--button-secondary-text); transition: all 0.2s; }
        .header-btn:hover { background: var(--button-secondary-hover); transform: scale(1.05); }
        .logo {width: 48px; height: 48px; border-radius: 10px; overflow: hidden; cursor: pointer; display: flex; align-items: center; justify-content: center; color: white;}
        .logo img {width: 100%; height: 100%; object-fit: contain}
        .welcome-text { display: flex; align-items: baseline; gap: 10px; }
        .welcome-text h1 { font-size: 1.8rem; font-weight: 700; color: var(--text-color); }
        .welcome-text p { color: var(--secondary-text); font-size: 1rem; }
        .header-actions { display: flex; align-items: center; gap: 15px; }
        .search-bar { position: relative; width: 350px; max-width: 100%; }
        .search-input { width: 100%; padding: 12px 20px 12px 45px; border: 2px solid var(--border-color); border-radius: 25px; font-size: 16px; background: var(--input-bg); color: var(--text-color); transition: all 0.3s; }
        .search-input:focus { outline: none; border-color: var(--primary-color); background: var(--input-focus-bg); box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }
        .search-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--secondary-text); width: 20px; height: 20px; }
        .main-content { margin-bottom: 40px; padding-top: 30px; }
        .decks-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px; }
        .category-folder { margin-bottom: 40px; }
        .category-title { font-size: 1.5rem; font-weight: 600; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid var(--border-color); }
        .deck-card { background: var(--card-bg); border-radius: 20px; padding: 25px; box-shadow: 0 8px 25px var(--shadow-color); transition: all 0.3s; position: relative; overflow: hidden; display: flex; flex-direction: column; border-top: 6px solid; }
        .deck-card-main-clickable { cursor: pointer; flex-grow: 1; display: flex; flex-direction: column; }
        .deck-card:hover { transform: translateY(-5px); box-shadow: 0 12px 35px var(--shadow-color); }
        .deck-card[data-category="Science"] { border-color: #4ecdc4; } .deck-card[data-category="Math"] { border-color: #667eea; } .deck-card[data-category="Language"] { border-color: #fab1a0; } .deck-card[data-category="History"] { border-color: #fd79a8; } .deck-card[data-category="Other"] { border-color: #a29bfe; }
        .deck-category { font-size: 0.8rem; font-weight: 600; padding: 4px 10px; border-radius: 20px; display: inline-block; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px; }
        .deck-card[data-category="Science"] .deck-category, .deck-detail-category.Science { color: #317b75; background-color: #e6fffa; } .deck-card[data-category="Math"] .deck-category, .deck-detail-category.Math { color: #5a67d8; background-color: #ebf4ff; } .deck-card[data-category="Language"] .deck-category, .deck-detail-category.Language { color: #c53030; background-color: #fff5f5; } .deck-card[data-category="History"] .deck-category, .deck-detail-category.History { color: #b83280; background-color: #fff5f7; } .deck-card[data-category="Other"] .deck-category, .deck-detail-category.Other { color: #6c5ce7; background-color: #f3f2ff; }
        .dark-mode .deck-card[data-category="Science"] .deck-category, .dark-mode .deck-detail-category.Science { color: #81e6d9; background-color: #2c7a7b; } .dark-mode .deck-card[data-category="Math"] .deck-category, .dark-mode .deck-detail-category.Math { color: #9f7aea; background-color: #5a67d830; } .dark-mode .deck-card[data-category="Language"] .deck-category, .dark-mode .deck-detail-category.Language { color: #f6ad55; background-color: #c5303030; } .dark-mode .deck-card[data-category="History"] .deck-category, .dark-mode .deck-detail-category.History { color: #f687b3; background-color: #b8328030; } .dark-mode .deck-card[data-category="Other"] .deck-category, .dark-mode .deck-detail-category.Other { color: #a3bffa; background-color: #6c5ce730; }
        .deck-header { margin-bottom: 15px; flex-grow: 1; }
        .deck-name { font-size: 1.4rem; font-weight: 700; color: var(--text-color); margin-bottom: 5px; line-height: 1.3; }
        .deck-info { display: flex; align-items: center; gap: 15px; color: var(--secondary-text); font-size: 0.9rem; font-weight: 500; }
        .deck-date { font-size: 0.8rem; color: var(--secondary-text); margin-top: auto; padding-bottom: 15px; } 
        .deck-progress-container { margin-top: 10px; }
        .deck-progress-label { font-size: 0.8rem; color: var(--secondary-text); margin-bottom: 5px; display: flex; justify-content: space-between; }
        .deck-progress-bar-outer { width: 100%; height: 8px; background: var(--border-color); border-radius: 4px; overflow: hidden; }
        .deck-progress-bar-inner { height: 100%; border-radius: 4px; transition: width 0.5s ease-in-out; }
        .deck-card[data-category="Science"] .deck-progress-bar-inner { background-color: #4ecdc4; } .deck-card[data-category="Math"] .deck-progress-bar-inner { background-color: #667eea; } .deck-card[data-category="Language"] .deck-progress-bar-inner { background-color: #fab1a0; } .deck-card[data-category="History"] .deck-progress-bar-inner { background-color: #fd79a8; } .deck-card[data-category="Other"] .deck-progress-bar-inner { background-color: #a29bfe; }
        .deck-actions { display: grid; grid-template-columns: 1fr 1fr auto; gap: 12px; margin-top: 15px; }
        .action-btn { flex: 1; padding: 12px 10px; border: none; border-radius: 12px; font-weight: 600; font-size: 14px; cursor: pointer; transition: all 0.3s; font-family: 'Inter', sans-serif; display: inline-flex; align-items: center; justify-content: center; gap: 6px; }
        .export-btn { background: var(--button-secondary-bg); color: var(--button-secondary-text); border: 2px solid var(--border-color); padding: 10px; flex: 0 0 auto; width: 44px; grid-column: 3 / 4; grid-row: 1 / 3;}
        .export-btn:hover { background: var(--button-secondary-hover); border-color: #cbd5e0; }
        .learn-btn { background: var(--primary-color); color: white; }
        .learn-btn:hover { background: var(--primary-hover); transform: translateY(-1px); }
        .review-btn { background: var(--button-secondary-bg); color: var(--button-secondary-text); border: 2px solid var(--border-color); }
        .review-btn:hover { background: var(--button-secondary-hover); border-color: #cbd5e0; }
        .spaced-btn { background: #38b2ac; color: white; grid-column: 1 / 3; }
        .spaced-btn:hover { background: #319795; transform: translateY(-1px); }
        .deck-detail-view { background: var(--card-bg); border-radius: 20px; padding: 30px; box-shadow: 0 8px 25px var(--shadow-color); margin-bottom: 30px; }
        .deck-detail-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 25px; }
        .deck-detail-title { font-size: 1.8rem; font-weight: 700; color: var(--text-color); margin-bottom: 5px; }
        .deck-detail-category { display: inline-block; padding: 5px 12px; border-radius: 20px; font-size: 0.9rem; font-weight: 500; }
        .deck-detail-actions { display: flex; flex-wrap: wrap; gap: 10px; }
        .deck-cards-list { max-height: 400px; overflow-y: auto; border: 2px solid var(--border-color); border-radius: 15px; padding: 20px; }
        .deck-card-item { padding: 15px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: flex-start; gap: 15px; }
        .deck-card-item:last-child { border-bottom: none; }
        .deck-card-content { flex: 1; }
        .deck-card-question { font-weight: 500; color: var(--text-color); margin-bottom: 5px; }
        .deck-card-answer { color: var(--secondary-text); font-size: 0.95rem; }
        .card-image { max-width: 200px; max-height: 150px; border-radius: 8px; margin-top: 8px; }
        .deck-card-meta { display: flex; align-items: center; gap: 10px; }
        .new-badge { font-size: 0.75rem; font-weight: 600; color: var(--primary-color); background-color: #ebf4ff; padding: 2px 8px; border-radius: 10px; margin-left: 8px; }
        .dark-mode .new-badge { color: #9f7aea; background-color: #5a67d830; }
        .deck-card-actions { display: flex; gap: 10px; }
        .deck-card-action-btn { background: none; border: none; cursor: pointer; padding: 5px; border-radius: 6px; color: var(--secondary-text); transition: all 0.3s; }
        .deck-card-action-btn:hover { background: var(--input-bg); color: var(--text-color); }
        .deck-card-action-btn.edit:hover { color: var(--primary-color); }
        .deck-card-action-btn.delete:hover { color: var(--danger-color); }
        .create-options { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .create-card { background: var(--card-bg); border: 3px dashed var(--border-dashed); border-radius: 20px; padding: 40px 30px; text-align: center; cursor: pointer; transition: all 0.3s; position: relative; overflow: hidden; }
        .create-card:hover { border-color: var(--primary-color); background: var(--input-focus-bg); }
        .create-icon { font-size: 2.5rem; margin: 0 auto 15px auto; display: block; width: 40px; height: 40px; color: var(--primary-color); }
        .create-title { font-size: 1.2rem; font-weight: 600; color: var(--text-color); margin-bottom: 8px; }
        .create-desc { color: var(--secondary-text); font-size: 0.95rem; line-height: 1.4; }
        .no-decks { text-align: center; color: var(--secondary-text); font-size: 1.1rem; padding: 60px 20px; background: var(--card-bg); border-radius: 20px; border: 2px dashed var(--border-dashed); }
        .no-decks-icon { font-size: 4rem; margin: 0 auto 20px auto; display: block; width: 64px; height: 64px; opacity: 0.5; color: var(--secondary-text); }
        .btn { background: var(--primary-color); color: white; border: none; padding: 12px 24px; border-radius: 10px; font-size: 16px; font-weight: 500; cursor: pointer; transition: all 0.3s; font-family: 'Inter', sans-serif; display: inline-flex; align-items: center; justify-content: center; gap: 8px; }
        .btn svg { width: 20px; height: 20px; }
        .btn:hover { background: var(--primary-hover); transform: translateY(-1px); }
        .btn:disabled { background: #cbd5e0; cursor: not-allowed; transform: none; }
        .btn-secondary { background: var(--button-secondary-bg); color: var(--button-secondary-text); }
        .btn-secondary:hover { background: var(--button-secondary-hover); }
        .btn-danger { background: var(--danger-color); }
        .btn-danger:hover { background: #c53030; }
        .btn-success { background: var(--success-color); }
        .btn-success:hover { background: #2f855a; }
        .btn-prominent { padding: 16px 32px; font-size: 18px; font-weight: 600; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); }
        .form-group { margin-bottom: 25px; }
        .form-group label { display: block; margin-bottom: 8px; color: var(--secondary-text); font-weight: 500; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 12px 15px; border: 2px solid var(--border-color); background-color: var(--input-bg); color: var(--text-color); border-radius: 10px; font-size: 16px; font-family: 'Inter', sans-serif; transition: border-color 0.3s, background-color 0.3s; }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus { outline: none; border-color: var(--primary-color); background-color: var(--input-focus-bg); }
        .form-group textarea { min-height: 120px; resize: vertical; }
        .back-btn { background: none; border: none; color: var(--primary-color); font-size: 16px; cursor: pointer; margin-bottom: 20px; display: flex; align-items: center; gap: 8px; font-weight: 500; }
        .back-btn:hover { color: var(--primary-hover); }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); backdrop-filter: blur(5px); align-items: center; justify-content: center; }
        .modal.show { display: flex; }
        .modal-content { background-color: var(--card-bg); padding: 40px; border-radius: 20px; width: 90%; max-width: 500px; max-height: 90vh; overflow-y: auto; position: relative; animation: modalSlideIn 0.3s ease-out; text-align: left; }
        .modal-content.text-center { text-align: center; }
        @keyframes modalSlideIn { from { opacity: 0; transform: translateY(-30px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }
        .close { position: absolute; right: 20px; top: 20px; font-size: 24px; font-weight: bold; cursor: pointer; color: var(--secondary-text); transition: color 0.3s; }
        .close:hover { color: var(--text-color); }
        .modal h2 { color: var(--text-color); margin-bottom: 15px; font-size: 1.8rem; font-weight: 700; text-align: center; }
        .modal p { color: var(--secondary-text); margin-bottom: 30px; line-height: 1.5; text-align: center; }
        .modal-actions { display: flex; gap: 15px; justify-content: center; }
        .settings-container { background: var(--card-bg); border-radius: 20px; padding: 40px; box-shadow: 0 8px 25px var(--shadow-color); }
        .settings-section { padding-bottom: 20px; margin-bottom: 20px; border-bottom: 2px solid var(--border-color); }
        .settings-section:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        .settings-section h2, .settings-section h4 { font-size: 1.3rem; font-weight: 600; color: var(--text-color); margin-bottom: 20px; }
        .dark-mode-toggle { display: flex; align-items: center; justify-content: space-between; }
        .switch { position: relative; display: inline-block; width: 50px; height: 28px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary-color); }
        input:checked + .slider:before { transform: translateX(22px); }
        .study-container { max-width: 800px; margin: 0 auto; padding: 20px; position: relative; display: flex; flex-direction: column; min-height: calc(100vh - 100px); }
        .study-header { text-align: center; margin-bottom: 30px; display: flex; justify-content: center; align-items: center; position: relative; }
        .study-header-content { flex-grow: 1; }
        .study-header-actions { position: absolute; right: 0; top: 50%; transform: translateY(-50%); display: flex; gap: 10px; }
        .study-title { font-size: 2rem; font-weight: 700; color: var(--text-color); margin-bottom: 10px; }
        .study-subtitle { color: var(--secondary-text); font-size: 1.1rem; }
        .flashcard-inner {
            display: grid;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        } 
       .flashcard.is-flipped .flashcard-inner { transform: rotateY(180deg); }
        .flashcard { width: 100%; max-width: 1500px; background: transparent; perspective: 1000px; margin-bottom: 0px; flex-grow: 0; display: flex; flex-direction: column; }
        .flashcard-front, .flashcard-back {
            grid-area: 1 / 1 / 1 / 1;
            padding: 40px;
            min-height: 250px;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            background: var(--card-bg);
            border-radius: 20px;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: 0 10px 30px var(--shadow-color);
            overflow-y: auto;
        }
        .flashcard-back { transform: rotateY(180deg); }
        #cardBucketInfo { position: absolute; top: 15px; left: 20px; font-size: 0.9rem; font-weight: 500; color: var(--secondary-text); background-color: var(--input-bg); padding: 4px 10px; border-radius: 12px; z-index: 5; }
        .question { font-size: 1.5rem; font-weight: 600; color: var(--text-color); margin-bottom: 25px; line-height: 1.4; }
        .answer { font-size: 1.2rem; color: var(--text-color); background: var(--input-bg); padding: 20px; border-radius: 12px; margin-top: 20px; line-height: 1.5; }
        #writeAnswerInput { width: 100%; min-height: 100px; margin-top: 20px; font-family: 'Inter', sans-serif; font-size: 1.1rem; padding: 20px; border-radius: 12px; transition: all 0.3s; }
        #writeAnswerInput:focus { border-color: var(--primary-color); box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1); }
        #writeAnswerInput.correct { border-color: var(--success-color); background-color: #f0fff4; }
        .dark-mode #writeAnswerInput.correct { background-color: #2c7a7b; }
        #writeAnswerInput.incorrect { border-color: var(--danger-color); background-color: #fff5f5; }
        .dark-mode #writeAnswerInput.incorrect { background-color: #c5303030; }
        .accent-buttons { margin-top: 15px; display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; }
        .accent-buttons button { background: var(--button-secondary-bg); border: 1px solid var(--border-color); color: var(--button-secondary-text); padding: 5px 12px; border-radius: 8px; cursor: pointer; font-size: 1rem; }
        .accent-buttons button:hover { background: var(--button-secondary-hover); }
        .answer-buttons { display: flex; justify-content: center; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
        .btn-show { background: #38b2ac; padding: 15px 30px; font-size: 16px; }
        .btn-show:hover { background: #319795; }
        .btn-correct { background: var(--success-color); order: 2; }
        .btn-incorrect { background: var(--danger-color); order: 1; }
        .btn-correct:hover { background: #2f855a; }
        .btn-incorrect:hover { background: #c53030; }
        .advanced-answer-btn { flex: 1; min-width: 100px; padding: 12px 15px; font-size: 14px; }
        .btn-again { background: #e53e3e; } .btn-again:hover { background: #c53030; }
        .btn-hard { background: #dd6b20; } .btn-hard:hover { background: #c05621; }
        .btn-good { background: #3182ce; } .btn-good:hover { background: #2b6cb0; }
        .btn-easy { background: #38a169; } .btn-easy:hover { background: #2f855a; }
        .progress-dashboard { background: var(--card-bg); border-radius: 20px; padding: 30px; margin-bottom: 30px; box-shadow: 0 8px 25px var(--shadow-color); position: relative; }
        #deckNotesDisplay { background: var(--input-bg); border: 2px solid var(--border-color); padding: 20px; border-radius: 15px; margin-bottom: 25px; }
        #deckNotesDisplay h3 { margin-bottom: 10px; }
        #deckNotesDisplay img { max-width: 100%; height: auto; border-radius: 8px; margin-top: 10px; }
        .progress-title { font-size: 1.8rem; font-weight: 700; text-align: center; margin-bottom: 25px; color: var(--text-color); }
        .round-info { text-align: center; margin-bottom: 25px; padding: 15px; background: var(--input-bg); border-radius: 12px; color: var(--primary-color); font-weight: 500; }
        .buckets-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .bucket { background: var(--input-bg); border-radius: 12px; padding: 20px; text-align: center; border: 2px solid var(--border-color); }
        .bucket-number { font-size: 1rem; font-weight: 600; color: var(--primary-color); margin-bottom: 5px; }
        .bucket-count { font-size: 1.8rem; font-weight: 700; color: var(--text-color); }
        .progress-bar-container { width: 100%; height: 10px; background: var(--border-color); border-radius: 5px; overflow: hidden; margin: 20px 0; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #38a169, #48bb78); transition: width 0.5s ease; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin: 25px 0; }
        .stat { text-align: center; padding: 15px; background: var(--input-bg); border-radius: 12px; border: 2px solid var(--border-color); }
        .stat-value { font-size: 1.5rem; font-weight: 700; color: var(--primary-color); }
        .stat-label { font-size: 0.9rem; color: var(--secondary-text); margin-top: 5px; }
        #cardView { display: flex; flex-direction: column; flex-grow: 1; }
        .ai-generator-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 25px; }
        .ai-panel { background: var(--card-bg); border-radius: 20px; padding: 30px; box-shadow: 0 8px 25px var(--shadow-color); display: flex; flex-direction: column; }
        .ai-panel h2 { font-size: 1.3rem; font-weight: 600; color: var(--text-color); margin-bottom: 20px; }
        .ai-tabs, .import-tabs { display: flex; border-bottom: 2px solid var(--border-color); margin-bottom: 20px; }
        .ai-tab, .import-tab { padding: 10px 15px; cursor: pointer; font-weight: 500; color: var(--secondary-text); border-bottom: 3px solid transparent; margin-bottom: -2px; transition: all 0.3s; }
        .ai-tab.active, .import-tab.active { color: var(--primary-color); border-bottom-color: var(--primary-color); }
        .file-drop-zone { border: 3px dashed var(--border-dashed); border-radius: 15px; padding: 25px; text-align: center; cursor: pointer; transition: all 0.3s; }
        .file-drop-zone:hover, .file-drop-zone.dragover { border-color: var(--primary-color); background: var(--input-focus-bg); }
        .file-drop-zone p { color: var(--secondary-text); margin-bottom: 10px; }
        .processing-controls { margin-top: auto; background: var(--input-bg); border-radius: 15px; padding: 25px; border: 2px solid var(--border-color); }
        .processing-controls h3 { font-size: 1.2rem; font-weight: 600; color: var(--text-color); margin-bottom: 15px; }
        .document-list, .flashcard-list { flex-grow: 1; overflow-y: auto; max-height: 500px; padding-right: 10px; }
        .document-item { background: var(--input-bg); border: 2px solid var(--border-color); border-radius: 12px; padding: 15px; margin-bottom: 10px; display: flex; flex-direction: column; }
        .document-item-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .document-name { font-weight: 500; color: var(--text-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-right: 10px; display: flex; align-items: center; }
        .document-status-icon { width: 20px; height: 20px; margin-right: 8px; flex-shrink: 0; }
        .remove-doc-btn { background: none; border: none; cursor: pointer; color: var(--secondary-text); padding: 0; width: 20px; height: 20px; }
        .remove-doc-btn:hover { color: #e53e3e; }
        .document-info { font-size: 0.9rem; color: var(--secondary-text); }
        .generated-card { background: var(--input-bg); border: 2px solid var(--border-color); border-radius: 12px; padding: 15px; margin-bottom: 10px; position: relative; }
        .generated-card .question { font-size: 1rem; margin-bottom: 8px; font-weight: 500; padding-right: 60px; }
        .generated-card .answer { font-size: 0.95rem; background: none; padding: 0; margin: 0; padding-right: 60px; }
        .generated-card-actions { position: absolute; top: 15px; right: 15px; display: flex; gap: 8px; }
        .generated-card-action-btn { background: none; border: none; cursor: pointer; padding: 5px; border-radius: 6px; color: var(--secondary-text); transition: all 0.3s; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; }
        .generated-card-action-btn:hover { background: var(--border-color); }
        .generated-card-action-btn.edit:hover { color: var(--primary-color); }
        .generated-card-action-btn.delete:hover { color: #e53e3e; }
        .list-empty-state { display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%; text-align: center; color: var(--secondary-text); }
        .list-empty-state-icon { width: 48px; height: 48px; margin-bottom: 10px; opacity: 0.6; }
        .spinner { width: 20px; height: 20px; border: 3px solid var(--primary-color); border-bottom-color: transparent; border-radius: 50%; animation: spin 1s ease-in-out infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .editor-container { background: var(--card-bg); border-radius: 20px; padding: 40px; box-shadow: 0 8px 25px var(--shadow-color); }
        .editor-container .question-input,
        .editor-container .solution-input {
            font-family: 'Inter', sans-serif;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 15px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background-color: var(--input-bg);
            color: var(--text-color);
            width: 100%;
        }
        /* Styling for Practice Test Textbox */
        #testAnswerInput {
            width: 100%;
            min-height: 120px;
            margin-top: 20px;
            font-family: 'Inter', sans-serif;
            font-size: 1.1rem;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid var(--border-color);
            background-color: var(--input-bg);
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        #testAnswerInput:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        /* Add specific styling for correct/incorrect states if not already present */
        #testAnswerInput.correct {
            border-color: var(--success-color);
            background-color: #f0fff4; /* Light green background */
        }

        .dark-mode #testAnswerInput.correct {
            background-color: #2c7a7b;
        }

        #testAnswerInput.incorrect {
            border-color: var(--danger-color);
            background-color: #fff5f5; /* Light red background */
        }

        .dark-mode #testAnswerInput.incorrect {
            background-color: #c5303030;
        }

        .editor-container .question-input:focus,
        .editor-container .solution-input:focus {
            outline: none;
            border-color: var(--primary-color);
            background-color: var(--input-focus-bg);
            /* Adds a modern shadow effect on focus */
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }
        .form-section { margin-bottom: 40px; }
        .form-row { display: flex; gap: 20px; margin-bottom: 25px; }
        .form-group { flex: 1; }
        .form-group.full-width { flex: 1 1 100%; }
        .form-group label { font-size: 16px; }
        .form-group input, .form-group textarea { padding: 15px 20px !important; border-radius: 10px !important; font-size: 16px !important; margin-bottom: 10px; min-height: 80px; resize: vertical; font-family: 'Inter', sans-serif; }
        .flashcard-editor-row {
            display: flex;
            align-items: center; /* Vertically align the button with the card */
            gap: 15px; /* Creates space between the card and the button */
            margin-bottom: 25px; /* Space between each card row */
        }

        /* Add this to style the main card content area */
        .flashcard-item {
            flex-grow: 1; /* Allows the card to take up all available horizontal space */
            padding: 25px;
            border: 2px solid var(--border-color);
            border-radius: 15px;
            background-color: var(--input-bg);
            position: relative; /* This keeps the card number positioned correctly */
        }
        .image-preview { min-height: 20px; margin-bottom: 10px; }
        .image-preview img { max-width: 150px; max-height: 150px; border-radius: 8px; margin-top: 10px; display: block; }
        .image-controls { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .image-controls span { font-size: 0.9rem; color: var(--secondary-text); }
        .question-input { border-color: var(--border-color) !important; }
        .solution-input { border-color: var(--border-color) !important; margin-bottom: 0; }
        .remove-card-btn {
            position: static; 
            background: #fee2e2;
            border: 2px solid #fca5a5;
            color: #dc2626;
            cursor: pointer;
            padding: 8px;
            border-radius: 10px;
            transition: all 0.3s;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        .remove-card-btn:hover { background: #fecaca; border-color: #f87171; color: #b91c1c; transform: scale(1.05); }
        .card-type-selector { width: 100%; margin-bottom: 15px; padding: 10px; border: 2px solid var(--border-color); border-radius: 10px; background-color: var(--input-bg); color: var(--text-color); }
                .sequence-input {
                    width: 100%;
                    min-height: 150px;
                    margin-top: 10px;
                    font-family: 'Fira Mono', 'Consolas', monospace;
                    line-height: 1.5;
                    background: var(--input-bg);
                    border: 2px solid var(--primary-color);
                    border-radius: 10px;
                    padding: 16px;
                    font-size: 1.1rem;
                    color: var(--text-color);
                    box-shadow: 0 2px 8px var(--shadow-color);
                }
                .sequence-items {
                    width: 100%;
                    min-height: 120px;
                    font-family: 'Inter', sans-serif;
                    background: var(--input-bg);
                    border: 2px solid var(--primary-color);
                    border-radius: 10px;
                    padding: 16px;
                    font-size: 1.1rem;
                    color: var(--text-color);
                    box-shadow: 0 2px 8px var(--shadow-color);
                }
                #sequenceInput {
                    width: 100%;
                    font-family: 'Inter', sans-serif;
                    background: var(--input-bg);
                    border: 2px solid var(--primary-color);
                    border-radius: 10px;
                    padding: 16px;
                    font-size: 1.1rem;
                    color: var(--text-color);
                    box-shadow: 0 2px 8px var(--shadow-color);
                }
                .sequence-input::placeholder,
                .sequence-items::placeholder,
                #sequenceInput::placeholder,
                .question-input::placeholder,
                .solution-input::placeholder,
                textarea::placeholder,
                input::placeholder {
                    font-family: 'Inter', sans-serif;
                    color: var(--secondary-text);
                    opacity: 1;
                }
                /* Ensure typed text in all textboxes uses Inter font */
                input, textarea, .sequence-input, .sequence-items, #sequenceInput, .question-input, .solution-input {
                    font-family: 'Inter', sans-serif;
                }
        .sequence-input::placeholder,
        .sequence-items::placeholder,
        #sequenceInput::placeholder,
        .question-input::placeholder,
        .solution-input::placeholder,
        textarea::placeholder,
        input::placeholder {
            font-family: 'Inter', sans-serif;
            color: var(--secondary-text);
            opacity: 1;
        }
        .code-textarea {
            width: 100%;
            min-height: 150px;
            margin-top: 10px;
            font-family: 'Fira Mono', 'Consolas', monospace;
            line-height: 1.5;
            background: var(--input-bg);
            border: 2px solid var(--primary-color);
            border-radius: 10px;
            padding: 16px;
            font-size: 1.1rem;
            color: var(--text-color);
            box-shadow: 0 2px 8px var(--shadow-color);
        }
        }
        .sequence-items {
            width: 100%;
            min-height: 120px;
            font-family: 'Fira Mono', 'Consolas', monospace;
            background: var(--input-bg);
            border: 2px solid var(--primary-color);
            border-radius: 10px;
            padding: 16px;
            font-size: 1.1rem;
            color: var(--text-color);
            box-shadow: 0 2px 8px var(--shadow-color);
        }
        #sequenceInput {
            width: 100%;
            font-family: 'Fira Mono', 'Consolas', monospace;
            background: var(--input-bg);
            border: 2px solid var(--primary-color);
            border-radius: 10px;
            padding: 16px;
            font-size: 1.1rem;
            color: var(--text-color);
            box-shadow: 0 2px 8px var(--shadow-color);
        }
        .add-question-btn { width: 100%; padding: 20px; border: 3px dashed var(--border-dashed); border-radius: 15px; background: var(--card-bg); color: var(--secondary-text); font-size: 16px; font-weight: 500; cursor: pointer; transition: all 0.3s; margin-bottom: 30px; }
        .add-question-btn:hover { border-color: var(--primary-color); background: var(--input-focus-bg); color: var(--primary-color); }
        .actions-section { display: flex; justify-content: flex-end; padding-top: 20px; border-top: 2px solid var(--border-color); }
        .checkbox-group { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }
        .checkbox-group input[type="radio"], .checkbox-group input[type="checkbox"] { width: 18px; height: 18px; accent-color: var(--primary-color); }
        .checkbox-group label { margin: 0; font-weight: 500; color: var(--text-color); }
        .form-group-inline { display: flex; align-items: center; gap: 10px; }
        #toast-container { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 2000; display: flex; flex-direction: column; align-items: center; gap: 10px; }
        .toast { background-color: var(--header-bg); color: var(--text-color); padding: 12px 20px; border-radius: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); font-size: 15px; font-weight: 500; display: flex; align-items: center; gap: 10px; transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55); opacity: 0; transform: translateY(20px) scale(0.9); }
        .toast.show { opacity: 1; transform: translateY(0) scale(1); }
        .toast.success { background-color: var(--success-color); color: white; }
        .toast.error { background-color: var(--danger-color); color: white; }
        @keyframes button-feedback-correct { 0% { background-color: var(--success-color); } 50% { background-color: #2f855a; transform: scale(1.05); } 100% { background-color: var(--success-color); } }
        @keyframes button-feedback-incorrect { 0% { background-color: var(--danger-color); } 50% { background-color: #c53030; transform: scale(1.05); } 100% { background-color: var(--danger-color); } }
        .feedback-correct { animation: button-feedback-correct 0.4s ease-in-out; }
        .feedback-incorrect { animation: button-feedback-incorrect 0.4s ease-in-out; }
        .custom-file-upload { border: 2px solid var(--border-color); border-radius: 10px; display: inline-block; padding: 12px 20px; cursor: pointer; background-color: var(--button-secondary-bg); color: var(--button-secondary-text); font-weight: 500; transition: all 0.3s; }
        .custom-file-upload:hover { background-color: var(--button-secondary-hover); }
        #importFileInput { display: none; }
        #fileNameDisplay { margin-top: 10px; color: var(--secondary-text); font-style: italic; }
        #testCardView { display: flex; flex-direction: column; flex-grow: 1; }
        #testOptions { width: 100%; margin-top: 20px; display: flex; flex-direction: column; gap: 10px; }
        #testOptions .btn { width: 100%; margin: 0; padding: 15px; font-size: 1rem; }
        .dashboard-footer { text-align: center; margin-top: 40px; }

        @media (max-width: 1024px) { .ai-generator-grid { grid-template-columns: 1fr; } }
        @media (max-width: 768px) {
            .app-header { flex-direction: column; gap: 15px; padding: 15px; }
            .header-actions { width: 100%; justify-content: space-between; }
            .search-bar { order: 2; width: 100%; }
            .header-settings-btn { order: 3;}
            .welcome-text h1 { font-size: 1.5rem; text-align: center;}
            .welcome-text p { display: none; }
            .decks-grid { grid-template-columns: 1fr; }
            .create-options { grid-template-columns: 1fr; }
            .answer-buttons { flex-direction: column; align-items: center; }
            .action-btn { padding: 10px 16px; font-size: 13px; }
            .form-row { flex-direction: column; gap: 15px; }
            .editor-container, .settings-container { padding: 25px; }
            .deck-detail-header { flex-direction: column; gap: 15px; }
            .deck-detail-actions { width: 100%; justify-content: center; }
            .generated-card .question, .generated-card .answer { padding-right: 0; }
            .generated-card-actions { position: static; margin-top: 10px; justify-content: flex-end; }
            .flashcard-front, .flashcard-back { padding: 20px; }
        }

        .settings-option-group {
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 10px 15px 15px 15px; /* Top padding is smaller due to legend */
            margin-top: 10px;
        }

        .settings-option-group legend {
            font-weight: 600;
            color: var(--text-color);
            padding: 0 8px; /* Creates a clean break in the fieldset border */
            margin-left: 10px;
            font-size: 0.95rem;
        }

        .radio-option-row {
            display: flex;
            align-items: center;
            padding: 5px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            margin-top: 5px;
        }

        .radio-option-row:hover {
            background-color: var(--input-bg);
        }

        .radio-option-row input[type="radio"] {
            width: 18px;
            height: 18px;
            accent-color: var(--primary-color);
            cursor: pointer;
        }

        .radio-option-row label {
            margin: 0 0 0 12px; /* Reset margin and add left spacing */
            font-weight: 500;
            color: var(--text-color);
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="toast-container"></div>

    <header class="app-header">
         <div class="logo-section">
            <button id="headerBackBtn" class="header-btn hidden" title="Go Back">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" /></svg>
            </button>
            <div class="logo" onclick="backToDashboard(true)">
                <img src='https://i.ibb.co/1fyDzymL/Study-Stack-Pro-Photoroom.png'>
            </div>
            <div class="welcome-text">
                <h1 id="welcomeMessage">Lagiote Revise</h1>
                <span style="font-size: 0.8rem; color: var(--secondary-text); align-self: flex-end; padding-bottom: 5px;">v2.37</span>
            </div>
        </div>
        <div class="header-actions">
            <div class="search-bar">
                <span class="search-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" /></svg></span>
                <input type="text" class="search-input" placeholder="Search decks..." id="searchInput">
            </div>
            <button id="headerSettingsBtn" class="header-btn header-settings-btn" title="Settings" onclick="showSettings()">
                 <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" d="M10.343 3.94c.09-.542.56-.94 1.11-.94h1.093c.55 0 1.02.398 1.11.94l.149.894c.07.424.384.764.78.93.398.164.855.142 1.205-.108l.737-.527a1.125 1.125 0 0 1 1.45.12l.773.774c.39.39.44 1.02.12 1.45l-.527.737c-.25.35-.272.806-.108 1.204.165.397.505.71.93.78l.893.15c.543.09.94.56.94 1.11v1.093c0 .55-.397 1.02-.94 1.11l-.893.149c-.425.07-.765.383-.93.78-.165.398-.143.854.108 1.204l.527.738c.32.43.27.96-.12 1.45l-.773.773a1.125 1.125 0 0 1-1.45.12l-.737-.527c-.35-.25-.806-.272-1.204-.108-.397.165-.71.505-.78.93l-.15.893c-.09.543-.56.94-1.11.94h-1.093c-.55 0-1.02-.398-1.11-.94l-.149-.894c-.07-.424-.384-.764-.78-.93-.398-.164-.855-.142-1.205.108l-.737.527a1.125 1.125 0 0 1-1.45-.12l-.773-.774a1.125 1.125 0 0 1-.12-1.45l.527-.737c.25-.35.272-.806.108-1.204-.165-.397-.505-.71-.93-.78l-.894-.15c-.542-.09-.94-.56-.94-1.11v-1.093c0-.55.398-1.02.94-1.11l.894-.149c.424-.07.765-.383.93-.78.165-.398.143-.854-.108-1.204l-.527-.738a1.125 1.125 0 0 1 .12-1.45l.773-.773a1.125 1.125 0 0 1 1.45-.12l.737.527c.35.25.806.272 1.204.108.397-.165.71.505.78-.93l.15-.893Z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" /></svg>
            </button>
        </div>
    </header>

    <div id="dashboard" class="container view-container">
        <div class="main-content">
            <div id="decksSection">
                <p id="subtitle" style="color: var(--secondary-text); font-size: 1.1rem; margin-bottom: 25px;"></p>
                <div id="decksContainer"></div><br><br>
            </div>
            <div id="deckDetailView" class="deck-detail-view hidden">
                <div class="deck-detail-header">
                    <div>
                        <span class="deck-detail-category" id="deckDetailCategory"></span>
                        <h2 class="deck-detail-title" id="deckDetailTitle"></h2>
                    </div>
                    <div class="deck-detail-actions">
                        <button class="btn learn-btn" onclick="configureStudy('learn')">Learn</button>
                        <button class="btn spaced-btn" onclick="configureStudy('spaced')">Spaced Learning</button>
                        <button class="btn review-btn" onclick="configureStudy('review')">Review</button>
                        <button class="btn review-btn" id="deckDetailTestBtn">Practice Test</button>
                        <button class="btn btn-secondary" id="deckDetailSettingsBtn">Settings</button>
                        <button class="btn btn-secondary" id="deckDetailEditBtn">Edit</button>
                        <button class="btn btn-danger" id="deckDetailDeleteBtn">Delete</button>
                    </div>
                </div>
                <h3 class="section-title">Cards in this deck</h3>
                <div class="deck-cards-list" id="deckCardsList"></div>
            </div>
            <div class="create-section">
                <div class="section-title">Start a new deck</div>
                <div class="create-options">
                    <div class="create-card" onclick="showAiGenerator()">
                        <span class="create-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" /></svg></span>
                        <div class="create-title">Create with AI</div>
                        <div class="create-desc">Generate flashcards from text, images, or PDFs</div>
                    </div>
                    <div class="create-card" onclick="showEditor()">
                        <span class="create-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" /></svg></span>
                        <div class="create-title">Create Manually</div>
                        <div class="create-desc">Build your own deck card-by-card</div>
                    </div>
                    <div class="create-card" onclick="showImportModal()">
                         <span class="create-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 16.5V9.75m0 0 3 3m-3-3-3 3M6.75 19.5a4.5 4.5 0 0 1-1.41-8.775 5.25 5.25 0 0 1 10.233-2.33 3 3 0 0 1 3.758 3.848A3.752 3.752 0 0 1 18 19.5H6.75Z" /></svg></span>
                         <div class="create-title">Import Deck</div>
                         <div class="create-desc">Import from JSON, CSV, or pasted text</div>
                     </div>
                </div>
            </div>
            <div style="text-align: center; padding-top: 20px; border-top: 1px solid var(--border-color); margin-top: 40px;">
                <button class="btn" onclick="showDownloadsModal()">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="20" height="20" style="margin-right: 8px;"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3" /></svg>
                    Download Desktop App
                </button>
            </div>
             <div class="dashboard-footer">
                <button class="btn btn-secondary" onclick="showAnalyticsModal()">Show Analytics</button>
                <button class="btn btn-secondary" onclick="showInternalAnalytics()" style="margin-left: 10px;">Internal Dashboard</button>
            </div>
        </div>
    </div> <!-- This closes the #dashboard view -->

<div id="internalAnalyticsView" class="container view-container">
<div class="section-title" style="padding-top: 20px;">Internal Analytics Dashboard</div>
<div class="settings-container">

    <!-- Section for Key Metric Histograms -->
    <div class="settings-section">
        <h2>Interaction Metrics Distributions</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px;">
            <div>
                <h4>Recall Latency (ms)</h4>
                <canvas id="latencyHistogram"></canvas>
            </div>
            <div>
                <h4>Answer Fluency (chars/sec)</h4>
                <canvas id="fluencyHistogram"></canvas>
            </div>
            <div>
                <h4>Corrections per Answer</h4>
                <canvas id="correctionsHistogram"></canvas>
            </div>
        </div>
    </div>

    <!-- Section for Scatter Plot -->
    <div class="settings-section">
        <h2>Latency vs. Correctness</h2>
        <canvas id="latencyScatterPlot" style="max-height: 400px;"></canvas>
    </div>

    <!-- Section for Time-Series -->
    <div class="settings-section">
        <h2>Interactions Per Day</h2>
        <canvas id="interactionsTimeSeries" style="max-height: 400px;"></canvas>
    </div>

    <!-- Section for Error Analysis -->
    <div class="settings-section">
        <h2>Common Error Analysis</h2>
        <div class="form-row">
            <div class="form-group">
                <label for="errorDeckSelect">Select Deck</label>
                <select id="errorDeckSelect"></select>
            </div>
            <div class="form-group">
                <label for="errorCardSelect">Select Card</label>
                <select id="errorCardSelect"></select>
            </div>
        </div>
        <div id="errorAnalysisResult" style="margin-top: 20px;">
            <p>Please select a card to see a breakdown of common incorrect answers.</p>
        </div>
    </div>

</div>
</div>
    <div id="aiGenerator" class="container view-container">
        <div class="section-title" style="padding-top: 20px;">AI Flashcard Generator</div>
        <div class="ai-generator-grid">
            <div class="ai-panel">
                <div class="ai-tabs">
                    <div id="aiTabInput" class="ai-tab active" onclick="switchAiTab('input')">1. Add Content</div>
                    <div id="aiTabCustomise" class="ai-tab" onclick="switchAiTab('customise')">2. Customise</div>
                </div>
                <div id="aiContentInput">
                    <div class="form-group">
                        <label>Upload Files or Enter Text</label>
                        <div class="file-drop-zone" id="file-drop-zone">
                             <input id="file-input" type="file" multiple class="hidden"/>
                             <p>Drag & drop or click to select files (Text, Image, PDF, DocX)</p>
                             <button type="button" class="btn btn-secondary" id="select-file-btn">Select Files</button>
                        </div>
                    </div>
                     <div class="form-group">
                        <textarea id="ai-text-input" placeholder="Or paste your text here..." style="min-height: 150px;"></textarea>
                        <button id="add-text-btn" class="btn" style="width:100%; margin-top:10px;">Add Text as Document</button>
                    </div>
                </div>
                <div id="aiContentCustomise" class="hidden">
                    <div class="form-group">
                        <label for="aiGenerationSource">Generate cards from...</label>
                        <select id="aiGenerationSource">
                            <option value="mixture" selected>General (Topic + Text)</option>
                            <option value="text">Text Content Only</option>
                            <option value="topic">Topic / Filename Only</option>
                        </select>
                    </div>
                     <div class="form-group">
                        <label for="aiPromptSelection">AI Prompt</label>
                        <div class="form-group-inline">
                            <select id="aiPromptSelection" style="flex-grow:1;"></select>
                            <button id="editPromptBtn" class="btn btn-secondary hidden" style="padding: 12px 15px;">Edit</button>
                        </div>
                    </div>
                     <div class="form-group">
                        <label for="flashcard-count-setting">Max Flashcards per Document</label>
                        <select id="flashcard-count-setting"><option value="auto" selected>Auto (Recommended)</option><option value="10">10</option><option value="20">20</option><option value="30">30</option></select>
                    </div>
                     <div class="form-group">
                        <label for="language-setting">Language</label>
                        <select id="language-setting"><option value="auto" selected>Auto (Recommended)</option><option value="English">English</option><option value="Spanish">Spanish</option><option value="French">French</option><option value="German">German</option></select>
                    </div>
                </div>
                <div class="processing-controls">
                    <h3 id="doc-count-title">Process All (0 documents)</h3>
                    <div id="processing-status" class="hidden" style="margin-bottom: 15px;">
                        <div style="margin-bottom: 5px; font-size: 0.9rem; color: var(--secondary-text);">Processing <span id="progress-current">0</span> of <span id="progress-total">0</span>...</div>
                        <div class="progress-bar-container"><div class="progress-fill" id="progress-bar" style="width: 0%;"></div></div>
                    </div>
                    <button id="process-btn" class="btn" style="width: 100%;" disabled>
                        <span id="process-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" /></svg></span>
                        <span id="loader-icon" class="spinner hidden"></span>
                        <span id="process-text">Process All</span>
                    </button>
                </div>
            </div>
            <div class="ai-panel">
                <h2 id="doc-list-count">Documents (0)</h2>
                <div class="document-list" id="document-list">
                    <div id="empty-doc-list" class="list-empty-state">
                        <div class="list-empty-state-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" /></svg></div>
                        <p>Your uploaded documents will appear here.</p>
                    </div>
                </div>
            </div>
            <div class="ai-panel">
                <h2 id="flashcard-count">Generated Flashcards (0)</h2>
                <div class="flashcard-list" id="flashcard-list">
                    <div id="empty-flashcard-list" class="list-empty-state">
                        <div class="list-empty-state-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" /></svg></div>
                        <p>Generated cards will appear here after processing.</p>
                    </div>
                </div>
                 <div id="flashcard-summary" class="processing-controls hidden" style="margin-top: 15px;">
                    <button id="save-deck-btn" class="btn btn-success" style="width: 100%;">Save as New Deck</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="editorView" class="container view-container">
        <div class="editor-container" style="margin-top:20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid var(--border-color);">
                <h2 style="font-size: 1.8rem; font-weight: 700;">Create / Edit Deck</h2>
                <button class="btn btn-success" onclick="editorSaveDeck()">Save Deck</button>
            </div>
            <div class="form-section">
                <div class="form-row">
                    <div class="form-group">
                        <label for="deckTitle">Title</label>
                        <input type="text" id="deckTitle" placeholder="Enter deck title">
                    </div>
                     <div class="form-group">
                        <label for="deckCategory">Category</label>
                        <select id="deckCategory" class="form-group"></select>
                    </div>
                </div>
                <div class="form-group">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <label for="deckNotes" style="margin-bottom: 0;">Notes (optional, shown before studying)</label>
                        <button class="btn btn-secondary" style="padding: 5px 10px; font-size: 12px;" onclick="triggerNotesImageUpload(this)">Add Image</button>
                        <input type="file" class="image-upload-input" accept="image/*" style="display:none;" onchange="handleNotesImageUpload(this)">
                    </div>
                    <textarea id="deckNotes" placeholder="Add any notes, summaries, or instructions for this deck..."></textarea>
                </div>
            </div>
            <div class="flashcards-section">
                <div id="flashcardsContainer"></div>
                <button class="add-question-btn" onclick="editorAddNewCard()">+ Add Question</button>
                <div class="actions-section">
                    <button class="btn btn-success" onclick="editorSaveDeck()">Save Deck</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="settingsView" class="container view-container">
        <div class="settings-container" style="margin-top:20px;">
            <div class="settings-section">
                <h2>Profile</h2>
                <div class="form-group">
                <label for="usernameInput">Your Name</label>
                <input type="text" id="usernameInput" placeholder="Enter your name">
            </div>
            <button class="btn" onclick="saveUsername()">Save Name</button>
        </div>
        <div class="settings-section">
            <h2>Appearance</h2>
            <div class="dark-mode-toggle">
                <label for="darkModeToggle">Dark Mode</label>
                <label class="switch">
                    <input type="checkbox" id="darkModeToggle">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
         <div class="settings-section">
            <h2>Study Settings</h2>
            <div class="checkbox-group">
                <input type="checkbox" id="enableInStudyEditing">
                <label for="enableInStudyEditing">Enable card editing during study sessions</label>
            </div>
             <div class="form-group">
                 <label for="newCardsPerDay">New Cards Per Day (Spaced Learning)</label>
                 <input type="number" id="newCardsPerDay" value="20" min="1">
             </div>
            <div class="form-group">
                <fieldset class="settings-option-group">
                    <legend>Spaced Learning Feedback Style</legend>
                    
                    <div class="radio-option-row" onclick="document.getElementById('feedbackStyleSimple').checked = true;">
                        <input type="radio" id="feedbackStyleSimple" name="spacedFeedbackStyle" value="simple" checked>
                        <label for="feedbackStyleSimple">Simple (Correct / Incorrect)</label>
                    </div>

                    <div class="radio-option-row" onclick="document.getElementById('feedbackStyleAdvanced').checked = true;">
                        <input type="radio" id="feedbackStyleAdvanced" name="spacedFeedbackStyle" value="advanced">
                        <label for="feedbackStyleAdvanced">Advanced (4 Buttons)</label>
                    </div>

                </fieldset>
            </div>
            <button class="btn" onclick="saveStudySettings()">Save Study Settings</button>
            
        </div>
        <div class="settings-section">
            <h2>Danger Zone</h2>
            <p style="color: var(--secondary-text); margin-bottom: 15px;">These actions are permanent and cannot be undone.</p>
            <button class="btn btn-danger" onclick="clearAllDecks()">Clear All Decks</button>
        </div>
    </div>
</div>

<div id="studyMode" class="container view-container">
    <div class="study-container">
        <div class="study-header">
            <div class="study-header-content">
                <div class="study-title" id="studyTitle">Learning Mode</div>
                <div class="study-subtitle" id="studySubtitle">Deck Name</div>
            </div>
            <div class="study-header-actions">
                 <button id="accentToggleBtn" class="header-btn hidden" title="Toggle Accents">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" d="M12 21a9.004 9.004 0 0 0 8.716-6.747M12 21a9.004 9.004 0 0 1-8.716-6.747M12 21c1.356 0 2.673-.174 3.946-.512M12 21c-1.273 0-2.59-.174-3.872-.512M21 12a9 9 0 0 0-9-9c-1.356 0-2.673.174-3.946.512M3 12a9 9 0 0 1 9-9c1.273 0 2.59.174 3.872.512M12 3v18" /></svg>
                </button>
                <button id="editStudyCardBtn" class="header-btn hidden" title="Edit Card">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="20" height="20">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
                    </svg>
                </button>
                <button id="switchStudyModeBtn" class="header-btn hidden" title="Switch Study Mode">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="20" height="20">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487zm0 0L19.5 7.125" />
                    </svg>
                </button>
                <button id="instructionsBtn" class="header-btn" title="Instructions">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z" /></svg>
                </button>
            </div>
        </div>
        <div id="progressView" class="hidden sub-view">
            <div class="progress-dashboard">
                <div id="deckNotesDisplay" class="hidden"></div>
                <div class="progress-title" id="progressTitle">Learning Progress</div>
                <div class="round-info" id="roundInfo">Round 1 - 0 of 0 cards</div>
                <div class="buckets-grid" id="bucketsContainer"></div>
                <div class="progress-bar-container"><div class="progress-fill" id="progressBarFill" style="width: 0%"></div></div>
                <div class="stats" id="statsContainer"></div>
                <div style="text-align: center; margin-top: 25px;">
                    <button class="btn" id="continueBtn">Continue Round</button>
                    <button class="btn btn-secondary" onclick="endSession()" style="margin-left: 10px;">End Session</button>
                    <button class="btn btn-danger" id="resetBtn" onclick="resetProgress()" style="margin-left: 10px;">Reset Progress</button>
                </div>
            </div>
        </div>
        <div id="cardView" class="hidden sub-view">
            <div class="round-info" id="cardRoundInfo">Round 1 - Card 1 of 5</div>
            <div class="flashcard">
                <div class="flashcard-inner">
                    <div class="flashcard-front">
                        <div id="cardBucketInfo">New</div>
                        <div id="cardQuestionContent">
                            <div class="question" id="cardQuestion"></div>
                        </div>
                    </div>
                    <div class="flashcard-back">
                        <div id="cardAnswerContent" class="hidden">
                            <div class="answer" id="cardAnswer"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <textarea id="writeAnswerInput" class="form-group textarea hidden" placeholder="Type your answer here..."></textarea>
                <div id="accentButtonsContainer" class="accent-buttons hidden"></div>
                <div id="userAnswerDisplay" class="answer hidden" style="border: 2px solid var(--border-color); margin-bottom: 10px;"></div>
            </div>
            <div class="answer-buttons" id="simpleAnswerButtons">
                <button class="btn btn-show" id="showAnswerBtn" onclick="showAnswer()">Show Answer</button>
                <button class="btn btn-secondary hidden" id="showQuestionBtn" onclick="showQuestion()">Show Question</button>
                <button class="btn btn-show hidden" id="checkAnswerBtn" onclick="autoCheckAnswer()">Check Answer</button>
                <button class="btn btn-incorrect hidden" id="incorrectBtn" onclick="markIncorrect()">Incorrect</button>
                <button class="btn btn-correct hidden" id="correctBtn" onclick="markCorrect()">Correct</button>
            </div>
             <div class="answer-buttons hidden" id="advancedAnswerButtons">
                <button class="btn btn-again advanced-answer-btn" onclick="markSpaced(1)">Again</button>
                <button class="btn btn-hard advanced-answer-btn" onclick="markSpaced(2)">Hard</button>
                <button class="btn btn-good advanced-answer-btn" onclick="markSpaced(3)">Good</button>
                <button class="btn btn-easy advanced-answer-btn" onclick="markSpaced(4)">Easy</button>
            </div>
        </div>
        <div id="sequenceView" class="hidden sub-view">
            <div class="progress-dashboard">
                <div class="round-info" id="sequenceProgress">Item 1 of 7</div>
                <div class="progress-bar-container">
                    <div class="progress-fill" id="sequenceProgressBar" style="width: 0%"></div>
                </div>
                <div class="sequence-prompt">
                    <div class="question" id="sequencePrompt"></div>
                    <input type="text" id="sequenceInput" class="form-group" placeholder="Type your answer..." style="margin-top: 20px;">
                    <div id="sequenceFeedback" class="answer hidden"></div>
                </div>
                <div style="text-align: center; margin-top: 25px;">
                    <button class="btn btn-show" id="checkSequenceBtn" onclick="checkAnswer(document.getElementById('sequenceInput').value)">Check Answer</button>
                </div>
            </div>
        </div>
        <div id="completeView" class="hidden sub-view">
            <div class="progress-dashboard">
                <div class="progress-title">Complete!</div>
                <p style="text-align: center; font-size: 1.2rem; margin: 25px 0; color: var(--secondary-text);">Congratulations! You've mastered all your flashcards.</p>
                <div class="stats" id="finalStats"></div>
                <div style="text-align: center; margin-top: 25px;">
                    <button class="btn" onclick="restartStudy()">Study Again</button>
                    <button class="btn btn-secondary" onclick="endSession()" style="margin-left: 10px;">End Session</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="practiceTestModal" class="modal">
    <div class="modal-content" style="max-width: 500px;">
        <span class="close" onclick="closePracticeTestModal()">&times;</span>
        <h2>Practice Test</h2>
        <div class="form-group">
            <label for="testType">Test Type</label>
            <select id="testType">
                <option value="flashcard">Flashcards</option>
                <option value="multiple_choice">Multiple Choice</option>
                <option value="type">Type Answer</option>
                <option value="mixed">Mixed Types</option>
            </select>
        </div>
        <div class="form-group">
            <label for="numQuestions">Number of Questions</label>
            <input type="number" id="numQuestions" min="1" max="100" value="10">
        </div>
        <div class="modal-actions">
            <button class="btn btn-secondary" onclick="closePracticeTestModal()">Cancel</button>
            <button class="btn btn-success" onclick="startPracticeTest()">Start Test</button>
        </div>
    </div>
</div>

<div id="practiceTestView" class="container view-container">
    <div class="study-container">
        <div class="study-header">
            <div class="study-header-content">
                <div class="study-title" id="testTitle">Practice Test</div>
                <div class="study-subtitle" id="testSubtitle">Deck Name</div>
            </div>
            <div class="study-header-actions">
                <button id="testAccentToggleBtn" class="header-btn hidden" title="Toggle Accents">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" d="M12 21a9.004 9.004 0 0 0 8.716-6.747M12 21a9.004 9.004 0 0 1-8.716-6.747M12 21c1.356 0 2.673-.174 3.946-.512M12 21c-1.273 0-2.59-.174-3.872-.512M21 12a9 9 0 0 0-9-9c-1.356 0-2.673.174-3.946-.512M3 12a9 9 0 0 1 9-9c1.273 0 2.59.174 3.872.512M12 3v18" /></svg>
                </button>
                <button id="testInstructionsBtn" class="header-btn" title="Instructions">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z" /></svg>
                </button>
            </div>
        </div>
        <div id="testProgressView" class="hidden sub-view">
            <div class="progress-dashboard">
                <div class="progress-title">Test Progress</div>
                <div class="round-info" id="testInfo">0 of 0 questions</div>
                <div class="progress-bar-container"><div class="progress-fill" id="testProgressBar" style="width: 0%"></div></div>
                <div class="stats">
                    <div class="stat"><div class="stat-value" id="testCorrectCount">0</div><div class="stat-label">Correct</div></div>
                    <div class="stat"><div class="stat-value" id="testIncorrectCount">0</div><div class="stat-label">Incorrect</div></div>
                </div>
                <div style="text-align: center; margin-top: 25px;">
                    <button class="btn" onclick="startTest()">Start Test</button>
                </div>
            </div>
        </div>
        <div id="testCardView" class="hidden sub-view">
            <div class="round-info" id="testCardInfo">Question 1 of 10</div>
            <div class="flashcard">
                <div class="flashcard-inner">
                    <div class="flashcard-front">
                        <div class="question" id="testQuestion"></div>
                    </div><br><br><br><br>
                    <br>
                    <div class="flashcard-back">
                        <div id="testAnswerContent" class="hidden">
                            <div class="answer" id="testAnswer"></div>
                        </div>
                    </div>
                    <br><br><br>
                </div>
            </div>
            <div id="testOptions" class="hidden"></div>
            <div style="text-align: center; margin-top: 30px;">
                <textarea id="testAnswerInput" class="form-group textarea hidden" placeholder="Type your answer here..."></textarea>
                <div id="testAccentButtonsContainer" class="accent-buttons hidden"></div>
            </div>
            <div class="answer-buttons">
                <button class="btn btn-show" id="testShowAnswerBtn" onclick="showTestAnswer()">Show Answer</button>
                <button class="btn btn-show hidden" id="testCheckAnswerBtn" onclick="checkTestAnswer()">Check Answer</button>
                <button class="btn btn-incorrect hidden" id="testIncorrectBtn" onclick="markTestIncorrect()">Incorrect</button>
                <button class="btn btn-correct hidden" id="testCorrectBtn" onclick="markTestCorrect()">Correct</button>
                <button class="btn btn-success hidden" id="testNextBtn" onclick="nextTestQuestion()">Next</button>
            </div>
        </div>
        <div id="testCompleteView" class="hidden sub-view">
            <div class="progress-dashboard">
                <div class="progress-title">Test Complete!</div>
                <p style="text-align: center; font-size: 1.2rem; margin: 25px 0; color: var(--secondary-text);">
                    You scored <span id="testScore">0</span>% (<span id="testCorrectFinal">0</span> out of <span id="testTotalFinal">0</span>)
                </p>
                <div class="stats">
                    <div class="stat"><div class="stat-value" id="testTime">0s</div><div class="stat-label">Time Taken</div></div>
                    <div class="stat"><div class="stat-value" id="testAccuracy">0%</div><div class="stat-label">Accuracy</div></div>
                </div>
                <div style="text-align: center; margin-top: 25px;">
                    <button class="btn" onclick="restartTest()">Retake Test</button>
                    <button class="btn btn-secondary" onclick="endTest()" style="margin-left: 10px;">End Test</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="importModal" class="modal">
    <div class="modal-content" style="max-width: 700px;">
        <span class="close" onclick="closeImportModal()">&times;</span>
        <h2>Import Deck</h2>
        <div class="import-tabs">
            <div id="importTabPaste" class="import-tab active" onclick="switchImportTab('paste')">Paste Text</div>
            <div id="importTabFile" class="import-tab" onclick="switchImportTab('file')">Import File</div>
        </div>
        <div id="importContentPaste">
            <div class="form-group">
                <label for="importPastedText">Paste your content here</label>
                <textarea id="importPastedText" style="min-height: 200px;" placeholder="Question 1<Tab>Answer 1&#x0a;Question 2<Tab>Answer 2"></textarea>
            </div>
            <p style="font-size: 0.9rem; color: var(--secondary-text); text-align: left; margin-top: -15px; margin-bottom: 20px;">Separate terms and definitions with a Tab, and separate cards with a new line.</p>
        </div>
        <div id="importContentFile" class="hidden">
            <div class="form-group">
                <label for="importFileInput" class="custom-file-upload">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="20" height="20" style="vertical-align: middle; margin-right: 8px;"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5" /></svg>
                    Choose File
                </label>
                <input type="file" id="importFileInput" accept=".json,.csv,.txt">
                <div id="fileNameDisplay">No file chosen</div>
                <p style="font-size: 0.9rem; color: var(--secondary-text); text-align: left; margin-top: 10px;">Supports .json (exported from here), .csv, and .txt files.</p>
            </div>
        </div>
        <div class="form-group">
            <label for="importDeckName">New Deck Name</label>
            <input type="text" id="importDeckName" placeholder="e.g., Biology Chapter 5">
        </div>
        <div class="modal-actions">
            <button class="btn btn-success" onclick="importData()">Import and Create Deck</button>
        </div>
    </div>
</div>

<div id="saveAiDeckModal" class="modal">
    <div class="modal-content" style="max-width: 500px;">
        <span class="close" onclick="closeSaveAiDeckModal()">&times;</span>
        <h2>Save AI-Generated Deck</h2>
        <p style="color: var(--secondary-text); margin-bottom: 25px;">Name your new deck and choose a category.</p>
         <div class="form-group">
            <label for="aiDeckName">Deck Name</label>
            <input type="text" id="aiDeckName" placeholder="e.g., Year 7 Chemistry">
        </div>
        <div class="form-group">
            <label for="aiDeckCategory">Category</label>
            <select id="aiDeckCategory"></select>
        </div>
        <div class="modal-actions" style="margin-top: 15px;">
            <button class="btn" onclick="saveAiGeneratedDeck()" style="width: 100%;">Save Deck</button>
        </div>
    </div>
</div>

<div id="confirmActionModal" class="modal">
    <div class="modal-content text-center">
        <h2 id="confirmActionTitle">Confirm Action</h2>
        <p id="confirmActionText"></p>
        <div class="modal-actions">
            <button id="confirmActionCancelBtn" class="btn btn-secondary" onclick="cancelAction()">Cancel</button>
            <button id="confirmActionConfirmBtn" class="btn btn-danger">Confirm</button>
        </div>
    </div>
</div>

<div id="editCardModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeEditCardModal()">&times;</span>
        <h2>Edit Flashcard</h2>
        <div class="form-group">
            <label for="editCardQuestion">Question</label>
            <textarea id="editCardQuestion" class="question-input"></textarea>
        </div>
        <div class="form-group">
            <label for="editCardAnswer">Answer</label>
            <textarea id="editCardAnswer" class="solution-input"></textarea>
        </div>
        <div class="modal-actions" style="margin-top: 15px;">
            <button class="btn btn-secondary" onclick="closeEditCardModal()">Cancel</button>
            <button class="btn btn-success" onclick="saveEditedCard()">Save Changes</button>
        </div>
    </div>
</div>

<div id="editAiCardModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeEditAiCardModal()">&times;</span>
        <h2>Edit AI Flashcard</h2>
        <div class="form-group">
            <label for="editAiCardQuestion">Question</label>
            <textarea id="editAiCardQuestion" class="question-input"></textarea>
        </div>
        <div class="form-group">
            <label for="editAiCardAnswer">Answer</label>
            <textarea id="editAiCardAnswer" class="solution-input"></textarea>
        </div>
        <div class="modal-actions" style="margin-top: 15px;">
            <button class="btn btn-secondary" onclick="closeEditAiCardModal()">Cancel</button>
            <button class="btn btn-success" onclick="saveAiEditedCard()">Save Changes</button>
        </div>
    </div>
</div>

<div id="nameModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeNameModal()">&times;</span>
        <h2>Welcome to Lagiote Revise!</h2>
        <p>What should we call you?</p>
        <form id="nameForm">
            <div class="form-group">
                <input type="text" id="nameInput" placeholder="Enter your name" required>
            </div>
            <div class="modal-actions">
                <button type="submit" class="btn">Get Started</button>
            </div>
        </form>
    </div>
</div>

<div id="addCategoryModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeAddCategoryModal()">&times;</span>
        <h2>Add New Category</h2>
        <div class="form-group">
            <label for="newCategoryInput">Category Name</label>
            <input type="text" id="newCategoryInput" placeholder="e.g., Biology">
        </div>
        <div class="modal-actions">
            <button class="btn" onclick="saveNewCategory()">Add Category</button>
        </div>
    </div>
</div>

<div id="customPromptModal" class="modal">
    <div class="modal-content" style="max-width: 700px;">
        <span class="close" onclick="closeCustomPromptModal()">&times;</span>
        <h2>Custom AI Prompt</h2>
        <p>Enter your custom prompt below. The application will append the document content to your prompt.</p>
        <div class="form-group">
            <textarea id="customPromptTextarea" style="min-height: 250px;"></textarea>
        </div>
        <div class="modal-actions">
            <button class="btn" onclick="saveCustomPrompt()">Save Prompt</button>
        </div>
    </div>
</div>

<div id="deckSettingsModal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
        <span class="close" onclick="closeDeckSettingsModal()">&times;</span>
        <h2>Deck Settings</h2>
        <div id="deckSettingsForm">
             <div class="settings-section">
                <h4>Learn Mode Options</h4>
                <div class="form-group">
                    <fieldset class="settings-option-group">
                        <legend>Default Study Method</legend>
                        
                        <div class="radio-option-row" onclick="document.getElementById('deckSettingsStudyModeFlashcard').checked = true;">
                            <input type="radio" id="deckSettingsStudyModeFlashcard" name="deckSettingsStudyMode" value="flashcard" checked>
                            <label for="deckSettingsStudyModeFlashcard">Flashcard Mode</label>
                        </div>
                
                        <div class="radio-option-row" onclick="document.getElementById('deckSettingsStudyModeWrite').checked = true;">
                            <input type="radio" id="deckSettingsStudyModeWrite" name="deckSettingsStudyMode" value="write">
                            <label for="deckSettingsStudyModeWrite">Type Mode</label>
                        </div>
                
                    </fieldset>
                </div>
                <div class="form-group">
                    <label for="deckSettingsCardsPerRound">Cards per Round</label>
                    <select id="deckSettingsCardsPerRound">
                        <option value="5">5</option>
                        <option value="10">10</option>
                        <option value="15">15</option>
                        <option value="20">20</option>
                        <option value="all">All</option>
                    </select>
                </div>
                <div class="form-group">
                     <label for="bucketCount">Number of Learning Buckets</label>
                     <select id="bucketCount">
                         <option value="3">3 Buckets</option>
                         <option value="4">4 Buckets</option>
                         <option value="5">5 Buckets</option>
                     </select>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="retypeIncorrectToggle">
                    <label for="retypeIncorrectToggle">Require retyping incorrect answers</label>
                </div>
            </div>
            <div class="settings-section">
                <h4>Auto-marking (Type Mode)</h4>
                <h5>AI Auto-Marking (Hides manual buttons)</h5><br>
                <div class="checkbox-group">
                    <input type="checkbox" id="forgivingAutomarkingToggle">
                    <label for="forgivingAutomarkingToggle">Enable AI Auto-marking</label>
                </div>
                <h5>Auto-detection</h5><br>
                 <div class="checkbox-group">
                    <input type="checkbox" id="caseSensitiveToggle">
                    <label for="caseSensitiveToggle">Case-Sensitive Matching</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="punctuationToggle">
                    <label for="punctuationToggle">Consider Punctuation</label>
                </div>
            </div>
            <div class="settings-section">
                <h4>Review Mode</h4>
                <div class="form-group">
                     <label for="reviewOrder">Card Order</label>
                     <select id="reviewOrder">
                         <option value="random">Random</option>
                         <option value="alphabetical">Alphabetical</option>
                     </select>
                </div>
            </div>

            <div class="modal-actions" style="margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeDeckSettingsModal()">Cancel</button>
                <button class="btn btn-success" onclick="saveDeckSettings()">Save Settings</button>
            </div>
        </div>
    </div>
</div>


<div id="instructionsModal" class="modal">
    <div class="modal-content">
         <span class="close" onclick="this.parentElement.parentElement.classList.remove('show')">&times;</span>
         <h2>Keyboard Shortcuts</h2>
         <p style="text-align: left; margin-top: 20px; line-height: 1.8;">
            <b>During Spaced Learning Mode (4 Buttons):</b><br>
            - <b>1</b>: Again<br>
            - <b>2</b>: Hard<br>
            - <b>3</b>: Good<br>
            - <b>4</b>: Easy<br><br>
            <b>During Simple Flashcard Mode:</b><br>
            - <b>Space / Enter</b>: Show Answer<br>
            - <b> / 2</b>: Mark as Correct<br>
            - <b> / 1</b>: Mark as Incorrect<br><br>
            <b>During Type Mode:</b><br>
            - <b>Enter / </b>: Check Answer<br>
            - <b> / 2</b>: Mark as Correct (after checking)<br>
            - <b> / 1</b>: Mark as Incorrect (after checking)<br><br>
            <b>On Progress Screen:</b><br>
            - <b>Enter</b>: Start Next Round
         </p>
    </div>
</div>
<div id="downloadsModal" class="modal">
    <div class="modal-content">
         <span class="close" onclick="this.parentElement.parentElement.classList.remove('show')">&times;</span>
         <h2>Download the Desktop App</h2>
         <p style="text-align: left;">
            Get the full Lagiote Revise experience on your Windows or Mac computer for offline access when you can't access the internet.<br><br>
            There may be a warning when you first run the app - this is normal for apps outside the official app stores. Please click, 'Show More' and then 'Run Anyway' if prompted by your OS security settings.
         </p>
         <div id="download-buttons-container" style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin-top: 20px; min-height: 50px;">
            <!-- Download buttons will be injected here by JavaScript -->
         </div>
         <p style="color: var(--secondary-text); font-size: 0.9rem; margin-top: 20px;">
            <em>Note: The desktop app is currently in beta and may have some bugs. Please report any issues you encounter.</em>
         </p>
    </div>
</div>
<div id="analyticsModal" class="modal">
    <div class="modal-content" style="max-width: 700px;">
        <span class="close" onclick="this.parentElement.classList.remove('show')">&times;</span>
        <h2>Analytics</h2>
        <div class="stats" style="grid-template-columns: repeat(2, 1fr); margin-bottom: 30px;">
            <div class="stat">
                <div class="stat-value" id="analyticsStreak">0 days</div>
                <div class="stat-label">Current Streak</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="analyticsTotalTime">0m</div>
                <div class="stat-label">Total Study Time</div>
            </div>
        </div>
        <h4>Session History</h4>
        <div id="analyticsSessionList" style="max-height: 300px; overflow-y: auto; margin-top: 15px;">
            <p>No study sessions recorded yet.</p>
        </div>
    </div>
</div>

<script>
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js';
    
    let db;
    let decks = {};
    let categories = ["Science", "Maths", "Language",];
    let globalSettings = {};
    let analyticsData = {
        lastUsed: null,
        streak: 0,
        totalStudyTime: 0, 
        sessions: []
    };

    let currentDeckId = null;
    let currentMode = null;
    let confirmCallback = null;
    let cardToEdit = { deckId: null, cardIndex: null, from: null };
    let aiCardToEditIndex = null;
    let studyState = {
        buckets: [],
        currentRound: 1,
        currentCardIndex: 0, // This will now be an index for the ALP
        roundCards: [], // We will deprecate this for learn mode but keep for others
        settings: {},
        lastRoundIncorrect: [],
        isRetypingIncorrect: false,
        startTime: null,
        activeLearningPool: [],
        knowledgeStates: new Map(),
        // Sequence study properties
        masterSequence: [],       // Complete sequence being learned
        chunks: [[]],            // Array of sequence chunks
        currentChunkIndex: 0,    // Index of current chunk being learned
        chunkStates: [],         // Status of each chunk ('learning', 'mastered', 'locked')
        isSequenceMode: false     // Whether we're in sequence learning mode
    };

    function chunkSequence(items, chunkSize = 7) {
        const chunks = [];
        for (let i = 0; i < items.length; i += chunkSize) {
            chunks.push(items.slice(i, i + chunkSize));
        }
        return chunks;
    }

    function startSequenceSession(card) {
        studyState.isSequenceMode = true;
        studyState.masterSequence = [...card.content.items];
        studyState.chunks = chunkSequence(card.content.items);
        studyState.currentChunkIndex = 0;
        studyState.chunkStates = studyState.chunks.map((_, index) => 
            index === 0 ? 'learning' : 'locked'
        );
        startChunk(0);
    }

    function startChunk(chunkIndex) {
        if (chunkIndex >= studyState.chunks.length) {
            // All chunks completed
            completeStudySession();
            return;
        }

        studyState.currentChunkIndex = chunkIndex;
        studyState.chunkStates[chunkIndex] = 'learning';
        
        // Initialize the current chunk for learning
        const currentChunk = studyState.chunks[chunkIndex];
        studyState.roundCards = [{
            id: `sequence-chunk-${chunkIndex}`,
            content: { items: currentChunk },
            archetype: 'SEQUENCE',
            isNew: true
        }];
        studyState.currentCardIndex = 0;
        studyState.currentRound = 1;
        
        // Update UI to show chunk progress
        updateProgressDisplay();
    }
    const DEFAULT_DECK_SETTINGS = { learnMode: 'flashcard', reviewOrder: 'random', cardsPerRound: 10, maxBuckets: 4, caseSensitive: false, punctuation: false, retypeIncorrect: true, feedbackStyle: 'simple', forgivingAutomarking: false };
    let batchDocuments = [];
    let allFlashcards = [];
    let isProcessing = false;
    let editorCardCounter = 0;
    let currentViewingDeckId = null;
    let activeView = 'dashboard';
    let viewHistory = [];
    let customAiPrompt = '';

    class SM2Algorithm {
        constructor() {
            this.defaultInterval = 1;
            this.defaultFactor = 2.5;
        }

        calculateNextReview(card) {
            const now = new Date();
            
            if (!card.sm2Data) {
                card.sm2Data = {
                    interval: 0,
                    factor: this.defaultFactor,
                    repetition: 0,
                    dueDate: now.toISOString()
                };
            }
            
            const data = card.sm2Data;
            
            return function(quality) { 
                if (quality >= 3) { 
                    if (data.repetition === 0) {
                        data.interval = 1;
                    } else if (data.repetition === 1) {
                        data.interval = 6;
                    } else {
                        data.interval = Math.round(data.interval * data.factor);
                    }
                    data.repetition++;
                } else { 
                    data.repetition = 0;
                    data.interval = 1;
                }
                
                data.factor = data.factor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02));
                if (data.factor < 1.3) data.factor = 1.3;
                
                const dueDate = new Date();
                dueDate.setDate(dueDate.getDate() + data.interval);
                data.dueDate = dueDate.toISOString();
                
                return data;
            };
        }
    }

    let practiceTestState = {
        deckId: null,
        cards: [],
        currentCardIndex: 0,
        correctCount: 0,
        incorrectCount: 0,
        startTime: null,
        testType: 'flashcard',
        numQuestions: 10
    };

    window.onload = function() {
        initDB().then(() => {
            loadSavedData();
            setupEventListeners();
            showView('dashboard', true);
        }).catch(error => {
            console.error("Failed to initialize the database:", error);
            showToast("Could not start the application. Database initialization failed.", "error");
        });
    };
    
    function initDB() {
        return new Promise((resolve, reject) => {
            const request = indexedDB.open('LagioteDB', 4); 

            request.onerror = event => reject("Error opening DB: " + event.target.errorCode);
            
            request.onsuccess = event => {
                db = event.target.result;
                resolve();
            };

            request.onupgradeneeded = event => {
                db = event.target.result;
                const transaction = event.target.transaction;

                if (!db.objectStoreNames.contains('decks')) {
                    db.createObjectStore('decks', { keyPath: 'id' });
                }
                if (!db.objectStoreNames.contains('appData')) {
                    db.createObjectStore('appData', { keyPath: 'key' });
                }
                if (!db.objectStoreNames.contains('concepts')) {
                    db.createObjectStore('concepts', { keyPath: 'conceptID' });
                }
                if (!db.objectStoreNames.contains('userKnowledgeState')) {
                    db.createObjectStore('userKnowledgeState', { keyPath: ['userID', 'cardID'] });
                }
                
                if (!db.objectStoreNames.contains('interactionLogs')) {
                    const logStore = db.createObjectStore('interactionLogs', { keyPath: 'id', autoIncrement: true });
                    logStore.createIndex('by_cardID', 'cardID', { unique: false });
                    logStore.createIndex('by_timestamp', 'timestamp', { unique: false });
                    console.log("Created 'interactionLogs' object store.");
                }

                if (event.oldVersion < 3) {
                    console.log("Starting database migration for Milestone 1.1...");
                    const deckStore = transaction.objectStore('decks');
                    const conceptStore = transaction.objectStore('concepts');
                    const stateStore = transaction.objectStore('userKnowledgeState');

                    deckStore.getAll().onsuccess = (e) => {
                        const allDecks = e.target.result;
                        if (!allDecks || allDecks.length === 0) return;

                        allDecks.forEach(deck => {
                            let deckNeedsUpdate = false;
                            deck.cards.forEach(card => {
                                if (card.conceptID) return;
                                deckNeedsUpdate = true;
                                const newConceptID = `concept-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
                                conceptStore.put({ conceptID: newConceptID, createdAt: new Date().toISOString() });
                                card.conceptID = newConceptID;
                                card.cardArchetype = 'Paired Association';
                                stateStore.put({
                                    userID: 'default_user', cardID: card.id, masteryScore: 0.5, stability: 1.0,
                                    lastReviewed: card.sm2Data ? card.sm2Data.dueDate : new Date().toISOString(), recallHistory: []
                                });
                            });
                            if (deckNeedsUpdate) deckStore.put(deck);
                        });
                        console.log("Migration for Milestone 1.1 complete.");
                    };
                }
            };
        });
    }

    let currentInteractionLog = {};

    /**
     * Resets the log object for a new card.
     * @param {string} cardID The ID of the card being shown.
     */
    function startInteractionLog(cardID) {
        currentInteractionLog = {
            cardID: cardID,
            questionLoadTime: performance.now(),
            firstKeyPressTime: null,
            backspaceCount: 0,
            deleteCount: 0,
            attemptCount: (studyState.isRetypingIncorrect ? 2 : 1) // Starts at 1 or 2 if retyping
        };
    }

    /**
     * Handles keydown events in the "Type Mode" input to capture metrics.
     * @param {KeyboardEvent} e The keyboard event.
     */
    function handleInteractionLogging(e) {
        // On First Keypress: Record a second timestamp.
        if (currentInteractionLog.firstKeyPressTime === null && e.key.length === 1) {
            currentInteractionLog.firstKeyPressTime = performance.now();
        }

        // On Each Keypress: Increment counters for backspace/delete.
        if (e.key === 'Backspace') {
            currentInteractionLog.backspaceCount++;
        } else if (e.key === 'Delete') {
            currentInteractionLog.deleteCount++;
        }
    }
    
    async function logInteraction(logData) {
    if (!db) {
        console.error("Database not available for logging interaction.");
        return;
    }

    try {
        const transaction = db.transaction(['interactionLogs'], 'readwrite');
        const store = transaction.objectStore('interactionLogs');
        
        const logEntry = {
            userID: 'default_user', 
            cardID: logData.cardID,
            timestamp: new Date().toISOString(),
            wasCorrect: logData.wasCorrect,
            latency: logData.recallLatency,
            fluency: logData.answerFluency,
            corrections: logData.totalCorrections,
            attempts: logData.attemptCount,
            userAnswer: logData.userAnswer,
            synced: false 
        };
        
        store.add(logEntry);

        transaction.onerror = (event) => {
            console.error("Error saving interaction log to IndexedDB:", event.target.error);
        };
    } catch (error) {
        console.error("Failed to initiate IndexedDB transaction for logging:", error);
    }


    try {
        const backendUrl = 'http://localhost:3000/api/log/interaction'; // Your local backend URL
        
        const response = await fetch(backendUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            // We send the same data structure to the backend
            body: JSON.stringify({
                userID: 'default_user',
                cardID: logData.cardID,
                timestamp: new Date().toISOString(),
                wasCorrect: logData.wasCorrect,
                recallLatency: logData.recallLatency,
                answerFluency: logData.answerFluency,
                totalCorrections: logData.totalCorrections,
                attemptCount: logData.attemptCount,
                userAnswer: logData.userAnswer
            }),
            // Use a short timeout to prevent long waits on a slow network
            signal: AbortSignal.timeout(5000) 
        });

        if (!response.ok) {
            // The server responded with an error (e.g., 400, 500)
            console.warn(`Backend logging failed with status: ${response.status}`);
        } else {
            // Optional: If successful, you could later update the 'synced' flag
            // in IndexedDB, but that's a more advanced synchronization feature.
            // For now, just knowing it was sent is enough.
        }
    } catch (error) {
        // This block will catch network errors (e.g., user is offline, server is down)
        if (error.name === 'AbortError') {
            console.warn('Backend logging timed out.');
        } else {
            console.warn('Could not send log to backend. User might be offline.', error);
        }
    }
}

        let chartInstances = {};

        async function showInternalAnalytics() {
            showView('internalAnalyticsView');
            
            try {
                const transaction = db.transaction(['interactionLogs'], 'readonly');
                const store = transaction.objectStore('interactionLogs');
                const allLogs = await new Promise((resolve, reject) => {
                    const request = store.getAll();
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });

                if (!allLogs || allLogs.length === 0) {
                    console.warn("No interaction logs found to generate analytics.");
                    // You could show a message on the UI here
                    return;
                }

                renderHistograms(allLogs);
                renderLatencyScatterPlot(allLogs);
                renderInteractionsTimeSeries(allLogs);
                setupErrorAnalysis(allLogs);

            } catch (error) {
                console.error("Failed to fetch interaction logs for analytics:", error);
            }
        }

        function renderHistograms(logs) {
            const latencies = logs.map(log => log.latency).filter(l => l !== null);
            const fluencies = logs.map(log => log.fluency).filter(f => f > 0);
            const corrections = logs.map(log => log.corrections);

            createBarChart('latencyHistogram', 'Recall Latency', latencies, 'rgba(102, 126, 234, 0.6)');
            createBarChart('fluencyHistogram', 'Answer Fluency', fluencies, 'rgba(56, 178, 172, 0.6)');
            createBarChart('correctionsHistogram', 'Corrections Count', corrections, 'rgba(229, 62, 62, 0.6)');
        }

        function createBarChart(canvasId, label, data, color) {
            if (chartInstances[canvasId]) chartInstances[canvasId].destroy();
            
            const ctx = document.getElementById(canvasId).getContext('2d');
            
            const valueCounts = data.reduce((acc, value) => {
                acc[value] = (acc[value] || 0) + 1;
                return acc;
            }, {});
            const labels = Object.keys(valueCounts).sort((a, b) => a - b);
            const chartData = labels.map(key => valueCounts[key]);

            chartInstances[canvasId] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `Frequency of ${label}`,
                        data: chartData,
                        backgroundColor: color,
                        borderColor: color.replace('0.6', '1'),
                        borderWidth: 1
                    }]
                },
                options: { scales: { y: { beginAtZero: true } } }
            });
        }

        function renderLatencyScatterPlot(logs) {
            const canvasId = 'latencyScatterPlot';
            if (chartInstances[canvasId]) chartInstances[canvasId].destroy();

            const data = logs.filter(log => log.latency !== null).map(log => ({
                x: log.latency,
                y: log.wasCorrect ? 1 + (Math.random() * 0.1 - 0.05) : 0 + (Math.random() * 0.1 - 0.05) // Add jitter
            }));

            const ctx = document.getElementById(canvasId).getContext('2d');
            chartInstances[canvasId] = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'User Interaction',
                        data: data,
                        backgroundColor: (context) => context.raw.y > 0.5 ? 'rgba(56, 178, 172, 0.7)' : 'rgba(229, 62, 62, 0.7)',
                    }]
                },
                options: {
                    scales: {
                        x: { title: { display: true, text: 'Recall Latency (ms)' } },
                        y: { 
                            title: { display: true, text: 'Outcome' },
                            ticks: {
                                callback: (value) => value === 1 ? 'Correct' : (value === 0 ? 'Incorrect' : '')
                            },
                            min: -0.2, max: 1.2
                        }
                    }
                }
            });
        }

        /**
         * Renders the time-series graph of interactions per day.
         */
        function renderInteractionsTimeSeries(logs) {
            const canvasId = 'interactionsTimeSeries';
            if (chartInstances[canvasId]) chartInstances[canvasId].destroy();

            const interactionsByDay = logs.reduce((acc, log) => {
                const day = new Date(log.timestamp).toISOString().split('T')[0];
                acc[day] = (acc[day] || 0) + 1;
                return acc;
            }, {});

            const sortedDays = Object.keys(interactionsByDay).sort();
            const chartLabels = sortedDays;
            const chartData = sortedDays.map(day => interactionsByDay[day]);

            const ctx = document.getElementById(canvasId).getContext('2d');
            chartInstances[canvasId] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: chartLabels,
                    datasets: [{
                        label: 'Number of Interactions',
                        data: chartData,
                        fill: false,
                        borderColor: 'rgba(102, 126, 234, 1)',
                        tension: 0.1
                    }]
                }
            });
        }

        /**
         * Sets up the dropdowns and event listeners for the error analysis tool.
         */
        function setupErrorAnalysis(logs) {
            const deckSelect = document.getElementById('errorDeckSelect');
            const cardSelect = document.getElementById('errorCardSelect');

            deckSelect.innerHTML = '<option value="">-- Select a Deck --</option>';
            Object.values(decks).forEach(deck => {
                const option = document.createElement('option');
                option.value = deck.id;
                option.textContent = deck.name;
                deckSelect.appendChild(option);
            });

            deckSelect.onchange = () => {
                const deckId = deckSelect.value;
                cardSelect.innerHTML = '<option value="">-- Select a Card --</option>';
                if (deckId && decks[deckId]) {
                    decks[deckId].cards.forEach(card => {
                        const option = document.createElement('option');
                        option.value = card.id;
                        option.textContent = card.question.substring(0, 50) + '...'; // Truncate long questions
                        cardSelect.appendChild(option);
                    });
                }
                generateErrorAnalysisReport(logs, null); // Clear results
            };

            cardSelect.onchange = () => {
                generateErrorAnalysisReport(logs, cardSelect.value);
            };
        }

        /**
         * Generates and displays the table of common incorrect answers for a given card.
         */
        function generateErrorAnalysisReport(logs, cardId) {
            const resultContainer = document.getElementById('errorAnalysisResult');
            if (!cardId) {
                resultContainer.innerHTML = '<p>Please select a card to see a breakdown of common incorrect answers.</p>';
                return;
            }

            const incorrectAnswers = logs
                .filter(log => log.cardID == cardId && !log.wasCorrect)
                .map(log => log.userAnswer.trim().toLowerCase());

            if (incorrectAnswers.length === 0) {
                resultContainer.innerHTML = '<p>No incorrect answers have been logged for this card yet.</p>';
                return;
            }

            const answerCounts = incorrectAnswers.reduce((acc, answer) => {
                acc[answer] = (acc[answer] || 0) + 1;
                return acc;
            }, {});

            const sortedAnswers = Object.entries(answerCounts).sort(([, a], [, b]) => b - a);

            let tableHTML = `
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr>
                            <th style="text-align: left; padding: 8px; border-bottom: 1px solid var(--border-color);">Incorrect Answer</th>
                            <th style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">Frequency</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            sortedAnswers.forEach(([answer, count]) => {
                tableHTML += `
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid var(--border-color);">${answer}</td>
                        <td style="text-align: right; padding: 8px; border-bottom: 1px solid var(--border-color);">${count}</td>
                    </tr>
                `;
            });
            tableHTML += '</tbody></table>';

            resultContainer.innerHTML = tableHTML;
        }
    
    async function saveDataToDB(storeName, data) {
        return new Promise((resolve, reject) => {
            const transaction = db.transaction([storeName], 'readwrite');
            const store = transaction.objectStore(storeName);
            const request = store.put(data);
            request.onsuccess = () => resolve();
            request.onerror = event => reject("Error saving data: " + event.target.error);
        });
    }

    async function getDataFromDB(storeName, key) {
        return new Promise((resolve, reject) => {
            const transaction = db.transaction([storeName], 'readonly');
            const store = transaction.objectStore(storeName);
            const request = store.get(key);
            request.onsuccess = event => resolve(event.target.result);
            request.onerror = event => reject("Error getting data: " + event.target.error);
        });
    }

    async function getAllDataFromDB(storeName) {
        return new Promise((resolve, reject) => {
            const transaction = db.transaction([storeName], 'readonly');
            const store = transaction.objectStore(storeName);
            const request = store.getAll();
            request.onsuccess = event => resolve(event.target.result);
            request.onerror = event => reject("Error getting all data: " + event.target.error);
        });
    }
    
    async function deleteDataFromDB(storeName, key) {
        return new Promise((resolve, reject) => {
            const transaction = db.transaction([storeName], 'readwrite');
            const store = transaction.objectStore(storeName);
            const request = store.delete(key);
            request.onsuccess = () => resolve();
            request.onerror = (event) => reject("Error deleting data: " + event.target.error);
        });
    }
    
    async function clearStoreInDB(storeName) {
        return new Promise((resolve, reject) => {
            const transaction = db.transaction([storeName], 'readwrite');
            const store = transaction.objectStore(storeName);
            const request = store.clear();
            request.onsuccess = () => resolve();
            request.onerror = event => reject("Error clearing store: " + event.target.error);
        });
    }


    function setupEventListeners() {
        setupSearch();
        setupKeyboardControls();
        setupAiGenerator();
        
        document.getElementById('deckDetailTestBtn').addEventListener('click', () => openPracticeTestModal(currentViewingDeckId));
        document.getElementById('deckDetailEditBtn').addEventListener('click', () => editDeck(currentViewingDeckId));
        document.getElementById('deckDetailDeleteBtn').addEventListener('click', () => deleteDeck(currentViewingDeckId));
        document.getElementById('deckDetailSettingsBtn').addEventListener('click', () => openDeckSettingsModal(currentViewingDeckId));
        document.getElementById('headerBackBtn').addEventListener('click', goBack);
        document.getElementById('nameForm').addEventListener('submit', saveName);
        document.getElementById('darkModeToggle').addEventListener('change', toggleDarkMode);
        document.getElementById('aiPromptSelection').addEventListener('change', handlePromptSelection);
        document.getElementById('editPromptBtn').addEventListener('click', openCustomPromptModal);
        document.getElementById('continueBtn').addEventListener('click', continueStudy);
        document.getElementById('instructionsBtn').addEventListener('click', () => document.getElementById('instructionsModal').classList.add('show'));
        document.getElementById('accentToggleBtn').addEventListener('click', toggleAccentButtons);
        document.getElementById('testAccentToggleBtn').addEventListener('click', toggleTestAccentButtons);
        document.getElementById('switchStudyModeBtn').addEventListener('click', toggleStudyMode);
        document.getElementById('editStudyCardBtn').addEventListener('click', editCurrentStudyCard);
        document.getElementById('writeAnswerInput').addEventListener('keydown', (e) => {
            if ((e.key === 'Enter' && !e.shiftKey) || e.key === 'ArrowUp') {
                e.preventDefault();
                e.stopPropagation();
                const writeInput = document.getElementById('writeAnswerInput');
                const checkAnswerBtnVisible = !document.getElementById('checkAnswerBtn').classList.contains('hidden');
                if (!checkAnswerBtnVisible || writeInput.disabled) return;
                if (writeInput.value.trim() === '') {
                    showToast('Please enter an answer', 'error');
                    return;
                }
                autoCheckAnswer();
            }
        });
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                // Find any visible modal and close it
                const visibleModal = document.querySelector('.modal.show');
                if (visibleModal) {
                    visibleModal.classList.remove('show');
                }
            }
        });
        document.getElementById('flashcardsContainer').addEventListener('keydown', function(event) {
            if (event.key === 'Tab' && !event.shiftKey) {
                const activeElement = document.activeElement;
                if (activeElement.classList.contains('solution-input')) {
                    const cardRow = activeElement.closest('.flashcard-editor-row');
                    if (cardRow === this.lastElementChild) {
                        event.preventDefault();
                        editorAddNewCard(); 
                    }
                }
            }
        });
        document.addEventListener('keydown', function(event) {
            const practiceTestView = document.getElementById('practiceTestView');
            if (practiceTestView.classList.contains('hidden')) {
                return;
            }

            if (event.key === 'Enter'|| 'ArrowUp') {
                const nextBtn = document.getElementById('testNextBtn');
                const checkBtn = document.getElementById('testCheckAnswerBtn');
                const showAnswerBtn = document.getElementById('testShowAnswerBtn');
                if (!nextBtn.classList.contains('hidden')) {
                    event.preventDefault();
                    nextBtn.click();
                }
                else if (!checkBtn.classList.contains('hidden')) {
                    if(event.target === document.getElementById('testAnswerInput')){
                        event.preventDefault();
                    }
                    checkBtn.click();
                }
                else if (!showAnswerBtn.classList.contains('hidden')) {
                    event.preventDefault();
                    showAnswerBtn.click();
                }
            }
        });
        document.getElementById('testInstructionsBtn').addEventListener('click', () => {
            showToast("Practice test instructions would appear here", "info");
        });

        ['deckCategory', 'aiDeckCategory'].forEach(id => {
            document.getElementById(id).addEventListener('change', handleCategoryChange);
        });

        document.getElementById('importFileInput').addEventListener('change', function() {
            const fileNameDisplay = document.getElementById('fileNameDisplay');
            if (this.files.length > 0) {
                fileNameDisplay.textContent = this.files[0].name;
            } else {
                fileNameDisplay.textContent = 'No file chosen';
            }
        });
        document.getElementById('writeAnswerInput').addEventListener('keydown', handleInteractionLogging);
    }
    
    function showToast(message, type = 'success', duration = 3000) {
        const container = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.textContent = message;
        container.appendChild(toast);
        setTimeout(() => toast.classList.add('show'), 10);
        setTimeout(() => {
            toast.classList.remove('show');
            toast.addEventListener('transitionend', () => toast.remove());
        }, duration);
    }

    function showView(viewId, isInitial = false) {
        if (activeView === viewId && !isInitial) return;
        if (activeView === 'editorView' && !isEditorClean()) {
            showConfirmModal(
                'You have unsaved changes. Are you sure you want to leave?',
                () => transitionView(viewId, isInitial)
            );
            return;
        }
        transitionView(viewId, isInitial);
    }
    
    function transitionView(viewId, isInitial = false) {
         if (!isInitial && activeView !== viewId && viewId !=='dashboard') {
            if(viewHistory[viewHistory.length-1] !== activeView) {
                 viewHistory.push(activeView);
            }
        }
        
        const currentView = document.getElementById(activeView);
        const nextView = document.getElementById(viewId);
        
        const isDashboard = viewId === 'dashboard' && document.getElementById('deckDetailView').classList.contains('hidden');
        document.querySelector('.search-bar').style.display = (viewId === 'dashboard') ? 'flex' : 'none';
        document.getElementById('headerSettingsBtn').style.display = (viewId === 'dashboard') ? 'flex' : 'none';
        document.getElementById('headerBackBtn').classList.toggle('hidden', viewHistory.length === 0 || viewId === 'dashboard');

        if (isInitial) {
            if(currentView) currentView.classList.remove('fade-in', 'fade-out', 'animating');
            nextView.classList.add('fade-in', 'animating');
            activeView = viewId;
            return;
        }

        if (currentView) {
            currentView.classList.add('fade-out', 'animating');
            currentView.classList.remove('fade-in');
            
            setTimeout(() => {
                currentView.style.display = 'none';
                currentView.classList.remove('fade-out', 'animating');
                nextView.style.display = 'block';
                nextView.classList.add('fade-in', 'animating');
                activeView = viewId;
                window.scrollTo(0, 0);
            }, 400);
        }
    }
    
    function transitionSubView(currentElem, nextElem) {
        if (currentElem && !currentElem.classList.contains('hidden')) {
            currentElem.classList.add('sub-view-fade-out', 'animating');
            setTimeout(() => {
                currentElem.classList.add('hidden');
                currentElem.classList.remove('sub-view-fade-out', 'animating');
                if (nextElem) {
                    nextElem.classList.remove('hidden');
                    nextElem.classList.add('sub-view-fade-in', 'animating');
                }
            }, 400);
        } else if (nextElem) {
            nextElem.classList.remove('hidden');
            nextElem.classList.add('sub-view-fade-in', 'animating');
        }
    }

    function goBack() {
        if (activeView === 'editorView' && !isEditorClean()) {
            showConfirmModal(
                'You have unsaved changes. Are you sure you want to leave?',
                () => continueGoBack()
            );
        } else {
            continueGoBack();
        }
    }

    function continueGoBack() {
         const previousView = viewHistory.pop();
        if (previousView) {
            transitionView(previousView);
        } else {
             backToDashboard(true);
        }
    }

    function showAiGenerator() { showView('aiGenerator'); }
    function showEditor() { showView('editorView'); editorInitialize(); }
    async function showSettings() {
        const settings = await getDataFromDB('appData', 'userSettings');
         document.getElementById('usernameInput').value = settings?.username || '';
         document.getElementById('enableInStudyEditing').checked = settings?.enableInStudyEditing || false;
         document.getElementById('newCardsPerDay').value = settings?.newCardsPerDay || 20;
         const feedbackStyle = settings?.spacedLearningFeedbackStyle || 'simple';
         document.querySelector(`input[name="spacedFeedbackStyle"][value="${feedbackStyle}"]`).checked = true;
         showView('settingsView');
    }

    async function backToDashboard(isFromLogo = false) {
        const performBack = async () => {
            if (currentDeckId && currentMode) await endSession();
            
            showView('dashboard');
            currentDeckId = null;
            currentMode = null;
            document.getElementById('deckDetailView').classList.add('hidden');
            document.getElementById('decksSection').classList.remove('hidden');
            document.querySelector('.create-section').classList.remove('hidden');
            currentViewingDeckId = null;
            updateDashboard();
            if(isFromLogo) viewHistory = [];
            document.getElementById('headerBackBtn').classList.add('hidden');
        };
        
        if (activeView === 'editorView' && !isEditorClean()) {
            showConfirmModal(
                'You have unsaved changes. Are you sure you want to leave?',
                () => { transitionView('dashboard'); performBack(); }
            );
        } else {
            performBack();
        }
    }
    
    async function loadSavedData() {
        const settings = await getDataFromDB('appData', 'userSettings');
        globalSettings = settings || {};
        globalSettings.newCardsPerDay = globalSettings.newCardsPerDay || 20;

        if (globalSettings.username) {
            document.getElementById('welcomeMessage').textContent = `Welcome back, ${globalSettings.username}!`;
            checkName();
        } else {
            document.getElementById('nameModal').classList.add('show');
        }
        
        const savedCategories = await getDataFromDB('appData', 'categories');
        if(savedCategories) categories = savedCategories.data;
        populateCategoryDropdowns();
        
        const savedDecks = await getAllDataFromDB('decks');
        decks = {};
        const sm2 = new SM2Algorithm();
        savedDecks.forEach(deck => {
            deck.cards.forEach(card => {
                if (!card.sm2Data) {
                    card.sm2Data = sm2.calculateNextReview(card)(3); 
                }
            });
            decks[deck.id] = deck;
        });
        
        const savedAnalytics = await getDataFromDB('appData', 'analytics');
        if (savedAnalytics) analyticsData = savedAnalytics;
        updateStreak();

        if (globalSettings.darkMode) {
            document.body.classList.add('dark-mode');
            document.getElementById('darkModeToggle').checked = true;
        }
        updateDashboard();
    }

    function formatDate(isoString) {
        if (!isoString) return '';
        const date = new Date(isoString);
        return date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
    }
    
    async function exportDeck(deckId, event) {
        event.stopPropagation();
        let deck = decks[deckId];
        if (!deck) return;
        showToast('Preparing export...', 'info', 2000);
        
        let deckToExport = JSON.parse(JSON.stringify(deck));
        const compressionPromises = [];

        for (const card of deckToExport.cards) {
            if (card.questionImage && card.questionImage.startsWith('data:image')) {
                compressionPromises.push(compressImage(card.questionImage).then(compressed => card.questionImage = compressed));
            }
            if (card.answerImage && card.answerImage.startsWith('data:image')) {
                compressionPromises.push(compressImage(card.answerImage).then(compressed => card.answerImage = compressed));
            }
        }

        await Promise.all(compressionPromises);

        const dataStr = JSON.stringify(deckToExport, null, 2); 
        const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
        const exportFileDefaultName = `${deck.name.replace(/ /g, '_')}_export.json`;
        const linkElement = document.createElement('a');
        linkElement.setAttribute('href', dataUri);
        linkElement.setAttribute('download', exportFileDefaultName);
        linkElement.click();
        showToast('Export started successfully!');
    }

    function updateDashboard() {
        const decksContainer = document.getElementById('decksContainer');
        const deckCount = Object.keys(decks).length;
        const subtitle = document.getElementById('subtitle');
        subtitle.textContent = deckCount === 0 ? "Create your first deck to get started!" : `Your saved decks:`;
        
        if (deckCount === 0) {
            decksContainer.innerHTML = `<div class="no-decks">
                <div class="no-decks-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25" /></svg></div>
                <div>No flashcard decks yet.<br>Create your first deck to get started!</div>
            </div>`;
            return;
        }

        decksContainer.innerHTML = '';
        const groupedDecks = {};
        for (const deck of Object.values(decks)) {
            const category = deck.category || 'Other';
            if (!groupedDecks[category]) groupedDecks[category] = [];
            groupedDecks[category].push(deck);
        }

        const sortedCategories = Object.keys(groupedDecks).sort((a,b) => categories.indexOf(a) - categories.indexOf(b));

        for (const category of sortedCategories) {
            const categoryFolder = document.createElement('div');
            categoryFolder.className = 'category-folder';
            categoryFolder.innerHTML = `<h3 class="category-title">${category}</h3><div class="decks-grid"></div>`;
            const decksGrid = categoryFolder.querySelector('.decks-grid');

            const sortedDecks = groupedDecks[category].sort((a,b) => new Date(b.created) - new Date(a.created));

            decksGrid.innerHTML = sortedDecks.map(deck => {
                if (!deck.learnState || !deck.settings || !deck.learnState.buckets) {
                    deck.settings = {...DEFAULT_DECK_SETTINGS, ...(deck.settings || {})};
                    const allCards = deck.cards;
                    deck.learnState = { 
                        buckets: [[...allCards]],
                        currentRound: 1, 
                        maxBuckets: deck.settings.maxBuckets
                    };
                }
                 while (deck.learnState.buckets.length < deck.settings.maxBuckets) deck.learnState.buckets.push([]);
                 while (deck.learnState.buckets.length > deck.settings.maxBuckets) {
                    const extraCards = deck.learnState.buckets.pop();
                    if (deck.learnState.buckets.length > 0) deck.learnState.buckets[deck.learnState.buckets.length - 1].push(...extraCards);
                }
                deck.learnState.maxBuckets = deck.settings.maxBuckets;
                
                const totalCards = deck.cards.length;
                const maxBuckets = deck.settings.maxBuckets;
                let currentProgressPoints = 0;
                deck.learnState.buckets.forEach((bucket, i) => {
                    currentProgressPoints += bucket.length * i;
                });
                const maxProgressPoints = totalCards > 0 ? totalCards * (maxBuckets - 1) : 0;
                const progressPercent = maxProgressPoints > 0 ? (currentProgressPoints / maxProgressPoints) * 100 : 0;
                
                return `<div class="deck-card" data-category="${category}" data-deck-id="${deck.id}">
                    <div class="deck-card-main-clickable" onclick="showDeckDetail('${deck.id}', this.parentElement)">
                         <div class="deck-header">
                            <div class="deck-category">${category}</div>
                            <div class="deck-name">${deck.name}</div>
                            <div class="deck-info"><span>${totalCards} cards</span></div>
                        </div>
                        <div class="deck-progress-container">
                             <div class="deck-progress-label"><span>Progress</span><span>${Math.round(progressPercent)}%</span></div>
                             <div class="deck-progress-bar-outer"><div class="deck-progress-bar-inner" style="width: ${progressPercent}%;"></div></div>
                        </div>
                        <div class="deck-date">Created: ${formatDate(deck.created)}</div>
                    </div>
                     <div class="deck-actions">
                        <button class="action-btn learn-btn" onclick="event.stopPropagation(); configureStudy('learn', '${deck.id}')">Learn</button>
                        <button class="action-btn review-btn" onclick="event.stopPropagation(); configureStudy('review', '${deck.id}')">Review</button>
                        <button class="action-btn spaced-btn" onclick="event.stopPropagation(); configureStudy('spaced', '${deck.id}')">Spaced Learning</button>
                        <button class="action-btn export-btn" title="Export Deck" onclick="exportDeck('${deck.id}', event)">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="18" height="18"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3" /></svg>
                        </button>
                    </div>
                </div>`;
            }).join('');
            decksContainer.appendChild(categoryFolder);
        }
    }

    function showDeckDetail(deckId, cardElement) {
        const deck = decks[deckId];
        if (!deck) return;
        if (cardElement) {
            cardElement.classList.add('deck-clicked');
            cardElement.addEventListener('animationend', () => cardElement.classList.remove('deck-clicked'), { once: true });
        }
        
        currentViewingDeckId = deckId;
        showView('dashboard');
        
        document.getElementById('deckDetailTitle').textContent = deck.name;
        const categoryElement = document.getElementById('deckDetailCategory');
        const category = deck.category || "Other";
        categoryElement.textContent = category;
        categoryElement.className = `deck-detail-category ${category}`;
        
        const cardsList = document.getElementById('deckCardsList');
        cardsList.innerHTML = '';
        
        if (deck.cards.length === 0) {
            cardsList.innerHTML = '<p style="text-align: center; color: var(--secondary-text);">No cards in this deck yet.</p>';
        } else {
            deck.cards.forEach((card, index) => {
                const cardItem = document.createElement('div');
                cardItem.className = 'deck-card-item';
                const newBadge = card.isNew ? '<span class="new-badge">New</span>' : '';
                let question = '';
                let answer = '';
                let questionImageHTML = '';
                let answerImageHTML = '';
                // Support both standard and SEQUENCE cards
                if (card.archetype === 'SEQUENCE' && card.content && Array.isArray(card.content.items)) {
                    question = `Sequence (${card.content.items.length} items)`;
                    answer = card.content.items.map((item, idx) => `${idx + 1}. ${item}`).join('<br>');
                } else if (card.content) {
                    question = card.content.question || '';
                    answer = card.content.answer || '';
                    questionImageHTML = card.content.questionImage ? `<img src="${card.content.questionImage}" class="card-image">` : '';
                    answerImageHTML = card.content.answerImage ? `<img src="${card.content.answerImage}" class="card-image">` : '';
                } else {
                    question = card.question || '';
                    answer = card.answer || '';
                    questionImageHTML = card.questionImage ? `<img src="${card.questionImage}" class="card-image">` : '';
                    answerImageHTML = card.answerImage ? `<img src="${card.answerImage}" class="card-image">` : '';
                }
                cardItem.innerHTML = `<div class="deck-card-content">
                        <div class="deck-card-question">${index + 1}. ${question} ${newBadge}</div>
                        ${questionImageHTML}
                        <div class="deck-card-answer">${answer}</div>
                        ${answerImageHTML}
                    </div>
                    <div class="deck-card-actions">
                        <button class="deck-card-action-btn edit" title="Edit Card" onclick="editCard('${deckId}', ${index}, 'detail')"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="16" height="16"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" /></svg></button>
                        <button class="deck-card-action-btn delete" title="Delete Card" onclick="deleteCardFromDetail('${deckId}', ${index})"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="16" height="16"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" /></svg></button>
                    </div>`;
                cardsList.appendChild(cardItem);
            });
        }
        
        document.getElementById('decksSection').classList.add('hidden');
        document.querySelector('.create-section').classList.add('hidden');
        document.getElementById('deckDetailView').classList.remove('hidden');
        
        document.getElementById('headerBackBtn').classList.remove('hidden');
    }

    function editCard(deckId, cardIndex, from) {
        const deck = decks[deckId];
        if (!deck || !deck.cards[cardIndex]) return;
        cardToEdit = { deckId, cardIndex, from };
        const card = deck.cards[cardIndex];
        document.getElementById('editCardQuestion').value = card.question;
        document.getElementById('editCardAnswer').value = card.answer;
        document.getElementById('editCardModal').classList.add('show');
    }
    
    function editCurrentStudyCard() {
        const card = studyState.roundCards[studyState.currentCardIndex];
        const deck = decks[currentDeckId];
        const cardIndexInDeck = deck.cards.findIndex(c => c.id === card.id);
        if (cardIndexInDeck > -1) {
            editCard(currentDeckId, cardIndexInDeck, 'study');
        }
    }

    function closeEditCardModal() {
        document.getElementById('editCardModal').classList.remove('show');
        cardToEdit = { deckId: null, cardIndex: null, from: null };
    }

    async function saveEditedCard() {
        const { deckId, cardIndex, from } = cardToEdit;
        if (deckId === null || cardIndex === null) return;
        
        const deck = decks[deckId];
        const newQuestion = document.getElementById('editCardQuestion').value.trim();
        const newAnswer = document.getElementById('editCardAnswer').value.trim();
        
        if (newQuestion && newAnswer) {
            const originalCard = deck.cards[cardIndex];
            originalCard.question = newQuestion;
            originalCard.answer = newAnswer;
            
            if (from === 'study') {
                const updateCardInArray = (arr) => {
                    const idx = arr.findIndex(c => c.id === originalCard.id);
                    if (idx > -1) arr[idx] = { ...arr[idx], question: newQuestion, answer: newAnswer };
                };
                
                if (currentMode === 'learn' || currentMode === 'spaced') {
                    studyState.buckets.forEach(bucket => updateCardInArray(bucket));
                } else if (currentMode === 'review') {
                    updateCardInArray(studyState.stillLearning);
                    updateCardInArray(studyState.correct);
                }
                updateCardInArray(studyState.roundCards);
                showNextCard(); 
            }
            
            await saveDataToDB('decks', deck);
            if (from === 'detail' && currentViewingDeckId === deckId) showDeckDetail(deckId);
            
            closeEditCardModal();
        } else {
            showToast("Question and Answer cannot be empty.", 'error');
        }
    }

    async function deleteCardFromDetail(deckId, cardIndex) {
        const deck = decks[deckId];
        if (!deck || !deck.cards[cardIndex]) return;
        
        showConfirmModal('Are you sure you want to delete this card?', async () => {
            deck.cards.splice(cardIndex, 1);
            await saveDataToDB('decks', deck);
            showDeckDetail(deckId);
            updateDashboard();
            showToast('Card deleted.');
        });
    }

    function setupSearch() {
        document.getElementById('searchInput').addEventListener('input', function() {
            const query = this.value.toLowerCase().trim();
            document.querySelectorAll('.deck-card').forEach(cardElement => {
                const deckId = cardElement.dataset.deckId;
                if (!deckId || !decks[deckId]) return;
                const deck = decks[deckId];
                let isMatch = deck.name.toLowerCase().includes(query) || (deck.category && deck.category.toLowerCase().includes(query));
                cardElement.style.display = isMatch ? 'flex' : 'none';
            });
            document.querySelectorAll('.category-folder').forEach(folder => {
                const visibleCards = folder.querySelectorAll('.deck-card[style*="display: flex"], .deck-card:not([style])');
                folder.style.display = visibleCards.length > 0 ? 'block' : 'none';
            });
        });
    }
    
    async function createNewDeck(name, category, cards, notes = '') {
        const deckId = Date.now().toString();
        const settings = { ...DEFAULT_DECK_SETTINGS };
        const sm2 = new SM2Algorithm();
        const processedCards = cards.map(c => ({
            ...c,
            sm2Data: sm2.calculateNextReview(c)(3)
        }));

        const newDeck = {
            id: deckId, name, category, cards: processedCards, notes,
            created: new Date().toISOString(),
            settings: settings,
            learnState: {
                buckets: [[...processedCards], ...Array.from({length: settings.maxBuckets - 1}, () => [])],
                currentRound: 1, maxBuckets: settings.maxBuckets
            },
            reviewState: { stillLearning: [...processedCards], correct: [], currentRound: 1, lastRoundIncorrect: [] }
        };
        decks[deckId] = newDeck;
        await saveDataToDB('decks', newDeck);
        return deckId;
    }

    function editDeck(deckId) {
        const deck = decks[deckId];
        if (!deck) return;
        showView('editorView');
        document.getElementById('deckTitle').value = deck.name;
        document.getElementById('deckCategory').value = deck.category;
        document.getElementById('deckNotes').value = deck.notes || '';
        const container = document.getElementById('flashcardsContainer');
        container.innerHTML = '';
        editorCardCounter = 0;
        deck.cards.forEach(card => editorAddNewCard(card));
        currentDeckId = deckId;
    }

    function deleteDeck(deckId) {
        const deckName = decks[deckId]?.name || 'this deck';
        showConfirmModal(`Are you sure you want to permanently delete the deck "${deckName}"? This action cannot be undone.`, async () => {
            delete decks[deckId];
            await deleteDataFromDB('decks', deckId);
            if (currentViewingDeckId === deckId) {
                backToDashboard();
            } else {
                updateDashboard();
            }
            showToast(`Deck "${deckName}" deleted.`);
        });
    }

    function editorInitialize() {
        document.getElementById('deckTitle').value = '';
        populateCategoryDropdowns();
        document.getElementById('deckCategory').value = 'Other';
        document.getElementById('deckNotes').value = '';
        const container = document.getElementById('flashcardsContainer');
        container.innerHTML = '';
        editorCardCounter = 0;
        editorAddNewCard();
        editorAddNewCard();
        document.getElementById('deckTitle').focus();
        currentDeckId = null;
    }

    function isEditorClean() {
        const title = document.getElementById('deckTitle').value.trim();
        if (title) return false;
        const cardItems = document.querySelectorAll('#editorView .flashcard-item');
        for (const item of cardItems) {
            const q = item.querySelector('.question-input').value.trim();
            const a = item.querySelector('.solution-input').value.trim();
            const qImg = item.querySelector('.question-image-input').value.trim();
            const aImg = item.querySelector('.answer-image-input').value.trim();
            if (q || a || qImg || aImg) return false;
        }
        return true;
    }

    function editorAddNewCard(card = {}) {
        const { question = '', answer = '', questionImage = '', answerImage = '' } = card;
        // Only allow one flashcard for sequence decks
        const deckTypeSelect = document.getElementById('deckTypeSelector');
        const isSequenceDeck = deckTypeSelect && deckTypeSelect.value === 'SEQUENCE';
        const container = document.getElementById('flashcardsContainer');
        if (isSequenceDeck && container.children.length > 0) return;
        editorCardCounter++;
        // ...existing code...
        // Hide the Check Answer button to prevent double submission
        document.getElementById('checkSequenceBtn').classList.add('hidden');
        const newRow = document.createElement('div');
        newRow.className = 'flashcard-editor-row';
        newRow.setAttribute('data-card-id', editorCardCounter);
        const questionImagePreview = questionImage ? `<img src="${questionImage}">` : '';
        const answerImagePreview = answerImage ? `<img src="${answerImage}">` : '';
        newRow.innerHTML = `
            <div class="flashcard-item">
                <div class="flashcard-number">${document.querySelectorAll('.flashcard-editor-row').length + 1}.</div>
                <select class="card-type-selector" onchange="handleCardTypeChange(this)">
                    <option value="PAIRED_ASSOCIATION">Question & Answer</option>
                    <option value="SEQUENCE">Sequence</option>
                </select>
                <div class="standard-input">
                    <textarea class="question-input" placeholder="Question">${question}</textarea>
                    <div class="image-controls">
                        <button class="btn btn-secondary" style="padding: 5px 10px; font-size: 12px;" onclick="triggerImageUpload(this)">Upload Image</button>
                    </div>
                    <div class="question-image-preview image-preview">${questionImagePreview}</div>
                    <input type="file" class="image-upload-input" accept="image/*" style="display:none;" onchange="handleImageFile(this)">
                    <input type="hidden" class="question-image-input" value="${questionImage}">
                    <textarea class="solution-input" placeholder="Answer" style="margin-top:20px;">${answer}</textarea>
                    <div class="image-controls">
                        <button class="btn btn-secondary" style="padding: 5px 10px; font-size: 12px;" onclick="triggerImageUpload(this)">Upload Image</button>
                    </div>
                    <div class="answer-image-preview image-preview">${answerImagePreview}</div>
                    <input type="file" class="image-upload-input" accept="image/*" style="display:none;" onchange="handleImageFile(this)">
                    <input type="hidden" class="answer-image-input" value="${answerImage}">
                </div>
                <div class="sequence-input hidden">
                    <textarea class="sequence-items" placeholder="Enter each item of the sequence on a new line"></textarea>
                </div>
            </div>
            <button class="remove-card-btn" onclick="editorRemoveCard(${editorCardCounter})"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" style="width: 20px; height: 20px;"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" /></svg></button>
        `;
        container.appendChild(newRow);
        newRow.querySelectorAll('textarea').forEach(textarea => {
            textarea.addEventListener('paste', handleImagePaste);
        });
        if (!question && !answer) newRow.querySelector('.question-input').focus();
    }
    
    function triggerImageUpload(button) {
        button.closest('.image-controls').nextElementSibling.nextElementSibling.click();
    }

    function handleImageFile(input) {
        const file = input.files[0];
        if (file && file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = e => {
                const dataUrl = e.target.result;
                const preview = input.previousElementSibling;
                const dataInput = input.nextElementSibling;
                preview.innerHTML = `<img src="${dataUrl}">`;
                dataInput.value = dataUrl;
            };
            reader.readAsDataURL(file);
        }
    }

    function handleImagePaste(event) {
        const items = (event.clipboardData || window.clipboardData).items;
        for (let i = 0; i < items.length; i++) {
            if (items[i].type.indexOf('image') !== -1) {
                event.preventDefault();
                const blob = items[i].getAsFile();
                const reader = new FileReader();
                reader.onload = (e) => {
                    const dataUrl = e.target.result;
                    const textarea = event.target;
                    const preview = textarea.nextElementSibling.nextElementSibling;
                    const dataInput = preview.nextElementSibling.nextElementSibling;
                    preview.innerHTML = `<img src="${dataUrl}">`;
                    dataInput.value = dataUrl;
                };
                reader.readAsDataURL(blob);
                break;
            }
        }
    }
    
    function triggerNotesImageUpload(button) {
        button.nextElementSibling.click();
    }

    function handleNotesImageUpload(input) {
        const file = input.files[0];
        if (file && file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = e => {
                const dataUrl = e.target.result;
                const notesTextarea = document.getElementById('deckNotes');
                const imgTag = `<img src="${dataUrl}" style="max-width: 100%; border-radius: 8px;">`;
                notesTextarea.value += (notesTextarea.value ? '\n\n' : '') + imgTag;
            };
            reader.readAsDataURL(file);
        }
    }

    function editorRemoveCard(cardId) {
        const cardRow = document.querySelector(`#editorView [data-card-id="${cardId}"]`);
        if (cardRow) {
            cardRow.remove();
            editorRenumberCards();
        }
    }

    function editorRenumberCards() {
        const cardRows = document.querySelectorAll('#editorView .flashcard-editor-row');
        cardRows.forEach((row, index) => {
            const cardItem = row.querySelector('.flashcard-item');
            if (cardItem) {
                cardItem.querySelector('.flashcard-number').textContent = `${index + 1}.`;
            }
        });
    }

    function handleCardTypeChange(selectElement) {
        const cardRow = selectElement.closest('.flashcard-item');
        const standardInput = cardRow.querySelector('.standard-input');
        const sequenceInput = cardRow.querySelector('.sequence-input');
        
        if (selectElement.value === 'SEQUENCE') {
            standardInput.classList.add('hidden');
            sequenceInput.classList.remove('hidden');
        } else {
            standardInput.classList.remove('hidden');
            sequenceInput.classList.add('hidden');
        }
    }

    async function editorSaveDeck() {
        const saveBtn = document.querySelector('.editor-container .actions-section .btn-success');
        const originalText = saveBtn.innerHTML;
        saveBtn.innerHTML = '<span class="spinner" style="border-width:2px; width:16px; height:16px;"></span> Saving...';
        saveBtn.disabled = true;
        const name = document.getElementById('deckTitle').value.trim();
        const category = document.getElementById('deckCategory').value;
        const notes = document.getElementById('deckNotes').value.trim();
        if (!name) { showToast('Please enter a title for your deck.', 'error'); return; }
        
        const cards = Array.from(document.querySelectorAll('#editorView .flashcard-item')).map(el => {
            const cardType = el.querySelector('.card-type-selector').value;
            const baseCard = {
                id: Date.now() + Math.random(),
                archetype: cardType,
                isNew: true
            };
            
            if (cardType === 'SEQUENCE') {
                const sequenceText = el.querySelector('.sequence-items')?.value.trim() || '';
                const items = sequenceText.split('\n')
                    .map(item => item.trim())
                    .filter(item => item.length > 0);
                return {
                    ...baseCard,
                    content: { items }
                };
            }
            
            return {
                ...baseCard,
                content: {
                    question: el.querySelector('.question-input').value.trim(),
                    answer: el.querySelector('.solution-input').value.trim(),
                    questionImage: el.querySelector('.question-image-input')?.value.trim(),
                    answerImage: el.querySelector('.answer-image-input')?.value.trim()
                }
            };
        }).filter(c => {
            if (c.archetype === 'SEQUENCE') {
                return c.content.items.length > 0;
            }
            return c.content.question || c.content.questionImage;
        });

        if (cards.length === 0) { showToast('Please add at least one complete flashcard.', 'error'); return; }


        if (cards.length === 0) { showToast('Please add at least one complete flashcard.', 'error'); return; }
        
        if (currentDeckId) {
            const deck = decks[currentDeckId];
            deck.name = name;
            deck.category = category;
            deck.cards = cards;
            deck.notes = notes;
            deck.learnState = {
                buckets: [[...cards], ...Array.from({length: deck.settings.maxBuckets - 1}, () => [])],
                currentRound: 1, maxBuckets: deck.settings.maxBuckets
            };
            deck.reviewState = { stillLearning: [...cards], correct: [], currentRound: 1, lastRoundIncorrect: [] };
            await saveDataToDB('decks', deck);
        } else {
            await createNewDeck(name, category, cards, notes);
        }
        document.getElementById('deckTitle').value = '';
        document.getElementById('flashcardsContainer').innerHTML = '';
        backToDashboard();
    }
    
    async function checkName() {
        if (!globalSettings.username) {
            document.getElementById('nameModal').classList.add('show');
        } else {
            document.getElementById('welcomeMessage').textContent = `Welcome back, ${globalSettings.username}!`;
        }
    }

    async function saveName(e) {
        e.preventDefault();
        const nameInput = document.getElementById('nameInput');
        const username = nameInput.value.trim();
        document.getElementById('newCategoryInput').focus();
        if (username) {
            globalSettings.username = username;
            await saveDataToDB('appData', { key: 'userSettings', ...globalSettings });
            document.getElementById('welcomeMessage').textContent = `Welcome, ${username}!`;
            closeNameModal();
        }
    }
    
    async function saveUsername() {
        const username = document.getElementById('usernameInput').value.trim();
        if (username) {
            globalSettings.username = username;
            await saveDataToDB('appData', { key: 'userSettings', ...globalSettings });
            document.getElementById('welcomeMessage').textContent = `Welcome back, ${username}!`;
            showToast('Name saved!');
        } else showToast('Name cannot be empty.', 'error');
    }
    
    async function saveStudySettings() {
        globalSettings.enableInStudyEditing = document.getElementById('enableInStudyEditing').checked;
        globalSettings.newCardsPerDay = parseInt(document.getElementById('newCardsPerDay').value) || 20;
        globalSettings.spacedLearningFeedbackStyle = document.querySelector('input[name="spacedFeedbackStyle"]:checked').value;
        await saveDataToDB('appData', { key: 'userSettings', ...globalSettings });
        showToast('Settings saved!');
    }

    function closeNameModal() { document.getElementById('nameModal').classList.remove('show'); }
    
    async function toggleDarkMode() {
        document.body.classList.toggle('dark-mode');
        globalSettings.darkMode = document.body.classList.contains('dark-mode');
        await saveDataToDB('appData', { key: 'userSettings', ...globalSettings });
        }
        
        async function clearAllDecks() {
            showConfirmModal('Are you sure you want to delete all decks? This is irreversible.', async () => {
                decks = {};
                await clearStoreInDB('decks');
                updateDashboard();
                backToDashboard();
            });
        }

        function populateCategoryDropdowns() {
            const dropdowns = [document.getElementById('deckCategory'), document.getElementById('aiDeckCategory')];
            dropdowns.forEach(dropdown => {
                const currentValue = dropdown.value;
                dropdown.innerHTML = '';
                categories.forEach(cat => dropdown.innerHTML += `<option value="${cat}">${cat}</option>`);
                dropdown.innerHTML += `<option value="add_new_category" style="font-style: italic;">+ Add New Category...</option>`;
                dropdown.value = currentValue;
            });
            const aiPromptDropdown = document.getElementById('aiPromptSelection');
            aiPromptDropdown.innerHTML = `<option value="default">Default Prompt</option><option value="custom">Custom Prompt...</option>`;
        }
        
        function handleCategoryChange(event) {
            if (event.target.value === 'add_new_category') openAddCategoryModal();
        }

        function openAddCategoryModal() { 
            document.getElementById('addCategoryModal').classList.add('show'); 
            document.getElementById('newCategoryInput').focus();
        }
        function closeAddCategoryModal() { 
            populateCategoryDropdowns();
            document.getElementById('addCategoryModal').classList.remove('show'); 
        }

        async function saveNewCategory() {
            const newCatInput = document.getElementById('newCategoryInput');
            let newCat = newCatInput.value.trim();
            if (newCat) {
                newCat = newCat.charAt(0).toUpperCase() + newCat.slice(1);
                if (!categories.includes(newCat)) {
                    categories.push(newCat);
                    await saveDataToDB('appData', { key: 'categories', data: categories });
                    populateCategoryDropdowns();
                    document.getElementById('deckCategory').value = newCat;
                    document.getElementById('aiDeckCategory').value = newCat;
                }
                newCatInput.value = '';
                closeAddCategoryModal();
            } else showToast('Category name cannot be empty.', 'error');
        }
        
        function setupAiGenerator() {
            const fileInput = document.getElementById('file-input'), selectFileBtn = document.getElementById('select-file-btn'), dropZone = document.getElementById('file-drop-zone'), addTextBtn = document.getElementById('add-text-btn');
            selectFileBtn.addEventListener('click', () => fileInput.click());
            dropZone.addEventListener('click', (e) => { if (e.target === dropZone || e.target.tagName === 'P') fileInput.click(); });
            addTextBtn.addEventListener('click', handleTextInput);
            fileInput.addEventListener('change', (e) => handleFiles(e.target.files));
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => dropZone.addEventListener(eventName, (e) => { e.preventDefault(); e.stopPropagation(); }, false));
            ['dragenter', 'dragover'].forEach(eventName => dropZone.addEventListener(eventName, () => dropZone.classList.add('dragover'), false));
            ['dragleave', 'drop'].forEach(eventName => dropZone.addEventListener(eventName, () => dropZone.classList.remove('dragover'), false));
            dropZone.addEventListener('drop', (e) => handleFiles(e.dataTransfer.files));
            
            document.getElementById('document-list').addEventListener('click', (e) => {
                const removeBtn = e.target.closest('.remove-doc-btn');
                if (removeBtn) {
                    batchDocuments = batchDocuments.filter(doc => doc.id !== parseFloat(removeBtn.dataset.id));
                    updateAiGeneratorUI();
                }
            });
            
            document.getElementById('process-btn').addEventListener('click', processAllDocuments);
            document.getElementById('save-deck-btn').addEventListener('click', () => {
                document.getElementById('saveAiDeckModal').classList.add('show');
                document.getElementById('aiDeckName').focus();
            });
            document.getElementById('flashcard-list').addEventListener('click', (e) => {
                const editBtn = e.target.closest('.generated-card-action-btn.edit'), deleteBtn = e.target.closest('.generated-card-action-btn.delete');
                if (editBtn) editGeneratedCard(parseInt(editBtn.dataset.index));
                else if (deleteBtn) deleteGeneratedCard(parseInt(deleteBtn.dataset.index));
            });
        }
        
        function handlePromptSelection(event) {
            const editBtn = document.getElementById('editPromptBtn');
            if (event.target.value === 'custom') {
                openCustomPromptModal();
                if (customAiPrompt) editBtn.classList.remove('hidden');
            } else {
                editBtn.classList.add('hidden');
            }
        }

        function openCustomPromptModal() {
            document.getElementById('customPromptTextarea').value = customAiPrompt;
            document.getElementById('customPromptModal').classList.add('show');
        }

        function closeCustomPromptModal() {
            if (!customAiPrompt) document.getElementById('aiPromptSelection').value = 'default';
            document.getElementById('customPromptModal').classList.remove('show');
        }
        
        function saveCustomPrompt() {
            let userPrompt = document.getElementById('customPromptTextarea').value.trim();
            const editBtn = document.getElementById('editPromptBtn');
            if (userPrompt) {
                const exportInstruction = "\n\nExport the flashcards in this way: Question<TAB>Answer";
                customAiPrompt = userPrompt + exportInstruction;
                showToast('Custom prompt saved for this session.');
                document.getElementById('aiPromptSelection').value = 'custom';
                editBtn.classList.remove('hidden');
                closeCustomPromptModal();
            } else {
                showToast('Prompt cannot be empty.', 'error');
                document.getElementById('aiPromptSelection').value = 'default';
                editBtn.classList.add('hidden');
            }
        }


        function editGeneratedCard(cardIndex) {
            const card = allFlashcards[cardIndex];
            if (!card) return;
            aiCardToEditIndex = cardIndex;
            document.getElementById('editAiCardQuestion').value = card.question;
            document.getElementById('editAiCardAnswer').value = card.answer;
            document.getElementById('editAiCardModal').classList.add('show');
        }

        function closeEditAiCardModal() {
            document.getElementById('editAiCardModal').classList.remove('show');
            aiCardToEditIndex = null;
        }
        
        function saveAiEditedCard() {
            if (aiCardToEditIndex === null) return;
            const newQuestion = document.getElementById('editAiCardQuestion').value.trim(), newAnswer = document.getElementById('editAiCardAnswer').value.trim();
            if (newQuestion && newAnswer) {
                allFlashcards[aiCardToEditIndex].question = newQuestion;
                allFlashcards[aiCardToEditIndex].answer = newAnswer;
                updateAiGeneratorUI();
                closeEditAiCardModal();
            } else showToast("Question and Answer cannot be empty.", 'error');
        }

        function deleteGeneratedCard(cardIndex) {
            showConfirmModal('Are you sure you want to delete this flashcard?', () => {
                allFlashcards.splice(cardIndex, 1);
                updateAiGeneratorUI();
            });
        }
        
        function switchAiTab(tabName) {
            document.getElementById('aiContentInput').classList.toggle('hidden', tabName !== 'input');
            document.getElementById('aiContentCustomise').classList.toggle('hidden', tabName !== 'customise');
            document.getElementById('aiTabInput').classList.toggle('active', tabName === 'input');
            document.getElementById('aiTabCustomise').classList.toggle('active', tabName === 'customise');
        }
        
        function handleTextInput() {
            const textInput = document.getElementById('ai-text-input');
            const content = textInput.value.trim();
            if (content) {
                 batchDocuments.push({ 
                    id: Date.now() + Math.random(), 
                    title: `Pasted Text - ${new Date().toLocaleTimeString()}`, 
                    type: 'text', 
                    content, 
                    status: 'pending', 
                    flashcards: [] 
                });
                textInput.value = '';
                updateAiGeneratorUI();
            } else {
                showToast('Please paste text here.', 'error');
            }
        }

        async function handleFiles(files) {
            for (const file of files) {
                const isPdf = file.type === 'application/pdf';
                const isDocx = file.type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document';
                const fileType = isPdf ? 'pdf' : (isDocx ? 'docx' : file.type.split('/')[0]);

                if (!['text', 'image', 'pdf', 'docx'].includes(fileType)) { 
                    showToast(`Unsupported file type: ${file.name}`, 'error'); 
                    continue; 
                }

                const reader = new FileReader();
                reader.onload = async (e) => {
                    let content = e.target.result;
                    let textContent = '';

                    try {
                        if (isPdf) {
                            const pdf = await pdfjsLib.getDocument(content).promise;
                            for (let i = 1; i <= pdf.numPages; i++) {
                                const page = await pdf.getPage(i);
                                const pageText = await page.getTextContent();
                                textContent += pageText.items.map(item => item.str).join(' ') + '\n';
                            }
                        } else if (isDocx) {
                            const result = await mammoth.extractRawText({ arrayBuffer: content });
                            textContent = result.value;
                        } else if (fileType === 'text') {
                            textContent = content;
                        }

                        batchDocuments.push({ 
                            id: Date.now() + Math.random(), 
                            title: file.name, 
                            type: fileType, 
                            content: fileType === 'image' ? content : textContent, 
                            status: 'pending', 
                            flashcards: [] 
                        });
                        updateAiGeneratorUI();
                    } catch (error) {
                        showToast(`Failed to parse ${file.name}: ${error.message}`, 'error');
                    }
                };

                reader.onerror = () => showToast(`Failed to read file: ${file.name}`, 'error');

                if (fileType === 'text' || fileType === 'image') {
                    reader.readAsDataURL(file); 
                } else if (fileType === 'pdf' || fileType === 'docx') {
                    reader.readAsArrayBuffer(file);
                }
            }
        }
        
        function updateAiGeneratorUI() {
            const docCount = batchDocuments.length, cardCount = allFlashcards.length, docListContainer = document.getElementById('document-list'), flashcardListContainer = document.getElementById('flashcard-list');
            document.getElementById('doc-count-title').textContent = `Batch Process (${docCount} document${docCount === 1 ? '' : 's'})`;
            document.getElementById('doc-list-count').textContent = `Documents (${docCount})`;
            document.getElementById('flashcard-count').textContent = `Generated Flashcards (${cardCount})`;
            document.getElementById('process-btn').disabled = isProcessing || docCount === 0;
            document.getElementById('flashcard-summary').classList.toggle('hidden', cardCount === 0);

            const getStatusIcon = (status) => ({
                completed: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="color: #38a169;"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg>`,
                processing: `<div class="spinner" style="border-top-color: var(--primary-color); border-left-color: var(--primary-color); border-width: 2px;"></div>`,
                error: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="color: #e53e3e;"><path stroke-linecap="round" stroke-linejoin="round" d="m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg>`,
                pending: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="color: var(--secondary-text);"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" /></svg>`
            })[status] || this.pending;

            docListContainer.innerHTML = docCount > 0 ? batchDocuments.map(doc => `<div class="document-item">
                    <div class="document-item-header">
                        <span class="document-name" title="${doc.title}"><span class="document-status-icon">${getStatusIcon(doc.status)}</span> ${doc.title}</span>
                        <button class="remove-doc-btn" data-id="${doc.id}"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" /></svg></button>
                    </div>
                    ${doc.status === 'completed' ? `<div class="document-info" style="color: #38a169;">${doc.flashcards.length} cards generated</div>` : ''}
                    ${doc.status === 'error' ? `<div class="document-info" style="color: #e53e3e;">Error: ${doc.error}</div>` : ''}
                </div>`).join('') : `<div id="empty-doc-list" class="list-empty-state"><div class="list-empty-state-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" /></svg></div><p>Your uploaded documents will appear here.</p></div>`;
            flashcardListContainer.innerHTML = cardCount > 0 ? allFlashcards.map((card, index) => `<div class="generated-card">
                    <div class="question">${card.question}</div>
                    <div class="answer">${card.answer}</div>
                    <div class="generated-card-actions">
                        <button class="generated-card-action-btn edit" data-index="${index}" title="Edit Card"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="16" height="16"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" /></svg></button>
                        <button class="generated-card-action-btn delete" data-index="${index}" title="Delete Card"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="16" height="16"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" /></svg></button>
                    </div>
                </div>`).join('') : `<div id="empty-flashcard-list" class="list-empty-state"><div class="list-empty-state-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" /></svg></div><p>Generated cards will appear here after processing.</p></div>`;
        }

        function setProcessingState(processing, current = 0, total = 0) {
            isProcessing = processing;
            document.getElementById('processing-status').classList.toggle('hidden', !processing);
            document.getElementById('process-icon').classList.toggle('hidden', processing);
            document.getElementById('loader-icon').classList.toggle('hidden', !processing);
            document.getElementById('process-text').textContent = processing ? 'Processing...' : 'Process All';
            if (processing) {
                document.getElementById('progress-current').textContent = current;
                document.getElementById('progress-total').textContent = total;
                document.getElementById('progress-bar').style.width = total > 0 ? `${(current / total) * 100}%` : '0%';
            }
            updateAiGeneratorUI();
        }
        
        async function processAllDocuments() {
            if (isProcessing || batchDocuments.length === 0) return;
            setProcessingState(true, 0, batchDocuments.length);
            allFlashcards = [];
            const { value: count } = document.getElementById('flashcard-count-setting');
            const { value: language } = document.getElementById('language-setting');
            const { value: generationSource } = document.getElementById('aiGenerationSource');
            const promptType = document.getElementById('aiPromptSelection').value;

            for (let i = 0; i < batchDocuments.length; i++) {
                const doc = batchDocuments[i];
                doc.status = 'processing';
                updateAiGeneratorUI();
                setProcessingState(true, i + 1, batchDocuments.length);
                try {
                    let prompt;
                    if (promptType === 'custom' && customAiPrompt) {
                        prompt = customAiPrompt;
                    } else {
                        const basePrompt = `You are an expert exam coach converting input into high-quality flashcards. Generate concise, reusable, and exam-relevant flashcards.\n\nCUSTOMISATION:\n- Language: ${language}\n- Max Count: ${count}\n\nRULES:\n- Extract meaningful knowledge.\n- Ignore irrelevant meta-information.\n- Each card must be self-contained.\n- Use clear, student-friendly phrasing.\n- Export in this format: Question<TAB>Answer\n- Adapt vocabulary to the source's complexity.\n\n`;
                        switch(generationSource) {
                            case 'text':
                                prompt = basePrompt + 'TASK: Generate flashcards based ONLY on the provided text content below.';
                                break;
                            case 'topic':
                                prompt = basePrompt + 'TASK: Generate flashcards based ONLY on the provided topic/title. Expand on the topic to create a comprehensive set of cards.';
                                break;
                            case 'mixture':
                            default:
                                prompt = basePrompt + 'TASK: Generate flashcards using the topic/title as context and the text content for specific details.';
                                break;
                        }
                    }
                    
                    let contentForApi = "";
                    if (generationSource === 'mixture') {
                        contentForApi = `TOPIC: ${doc.title}\n\nTEXT:\n${(doc.type !== 'image') ? doc.content : '(Image content provided)'}`;
                    } else if (generationSource === 'text') {
                        contentForApi = `TEXT:\n${(doc.type !== 'image') ? doc.content : '(Image content provided)'}`;
                    } else { 
                        contentForApi = `TOPIC: ${doc.title}`;
                    }
                    
                    let contentParts = (doc.type !== 'image' || generationSource === 'topic') ?
                        [{ text: `${prompt}\n\nINPUT:\n${contentForApi}` }] :
                        [{ text: `${prompt}\n\nINPUT:\n${contentForApi}` }, { inlineData: { mimeType: doc.content.split(';')[0].split(':')[1], data: doc.content.split(',')[1] } }];

                    const flashcardText = await callGenerativeApi(contentParts);
                    const cards = flashcardText.split('\n').map(line => {
                        const parts = line.split('\t');
                        return parts.length === 2 && parts[0].trim() && parts[1].trim() ? { id: Date.now() + Math.random(), question: parts[0].trim(), answer: parts[1].trim(), isNew: true } : null;
                    }).filter(Boolean);

                    if (cards.length === 0) throw new Error("AI returned 0 cards. Please try again.");
                    allFlashcards.push(...cards);
                    doc.flashcards = cards;
                    doc.status = 'completed';
                } catch (err) { doc.status = 'error'; doc.error = err.message.slice(0, 50); } 
                finally { updateAiGeneratorUI(); }
            }
            setProcessingState(false);
        }

        async function callGenerativeApi(contentParts, maxRetries = 3) {
        for (let attempt = 1; attempt <= maxRetries; attempt++) {
            try {
            const response = await fetch('/.netlify/functions/getAiCompletion', {
                method: 'POST',
                body: JSON.stringify({ contentParts: contentParts })
            });

            if (!response.ok) {
                throw new Error(`Server function error: ${response.status}`);
            }

            const result = await response.json();
            
            if (!result.flashcardText) {
                throw new Error('Server function returned empty response.');
            }
            
            return result.flashcardText;

            } catch (error) {
            console.error(`API call attempt ${attempt} failed:`, error);
            if (attempt === maxRetries) throw error;
            await new Promise(res => setTimeout(res, 1000 * attempt));
            }
        }
        }
        
        function closeSaveAiDeckModal() { document.getElementById('saveAiDeckModal').classList.remove('show'); }

        async function saveAiGeneratedDeck() {
            const name = document.getElementById('aiDeckName').value.trim(), category = document.getElementById('aiDeckCategory').value;
            if (!name) { showToast('Please enter a name for the deck.', 'error'); return; }
            if (allFlashcards.length === 0) { showToast('No flashcards were generated to save.', 'error'); return; }
            document.getElementById('newCategoryInput').focus();
            await createNewDeck(name, category, allFlashcards);
            batchDocuments = [];
            allFlashcards = [];
            updateAiGeneratorUI();
            closeSaveAiDeckModal();
            backToDashboard();
        }
        
        function configureStudy(mode, deckId) {
            currentDeckId = deckId || currentViewingDeckId;
            if (!currentDeckId) return;
            const deck = decks[currentDeckId];
            // Detect sequence deck archetype
            if (deck.cards && deck.cards.length > 0 && deck.cards[0].archetype === 'SEQUENCE') {
                // Always launch sequence mode and hide other modes
                document.getElementById('progressView').classList.add('hidden');
                document.getElementById('cardView').classList.add('hidden');
                document.getElementById('sequenceView').classList.remove('hidden');
                document.getElementById('completeView').classList.add('hidden');
                startSequenceMode(currentDeckId);
                // Optionally hide mode switch buttons if present
                document.getElementById('switchStudyModeBtn').classList.add('hidden');
                return;
            }
            // Otherwise, normal modes
            if (mode === 'learn') {
                startLearnMode(currentDeckId);
            } else if (mode === 'review') {
                startReviewMode(currentDeckId);
            } else if (mode === 'spaced') {
                startSpacedLearning(currentDeckId);
            } else if (mode === 'sequence') {
                startSequenceMode(currentDeckId);
            }
        }

        async function startLearnMode(deckId) {
            document.getElementById('progressView').classList.add('hidden');
            document.getElementById('cardView').classList.add('hidden');
            document.getElementById('completeView').classList.add('hidden');
            currentMode = 'learn';
            currentDeckId = deckId;
            const deck = decks[deckId];
            deck.settings = {...DEFAULT_DECK_SETTINGS, ...(deck.settings || {})};
            
            if (deck.learnState.maxBuckets !== deck.settings.maxBuckets) {
                const allCards = deck.learnState.buckets.flat();
                deck.learnState.buckets = [[...allCards]];
                while (deck.learnState.buckets.length < deck.settings.maxBuckets) deck.learnState.buckets.push([]);
                deck.learnState.maxBuckets = deck.settings.maxBuckets;
                deck.learnState.currentRound = 1;
                await saveDataToDB('decks', deck);
            }
            studyState.settings = deck.settings;
            studyState.buckets = JSON.parse(JSON.stringify(deck.learnState.buckets || []));
            studyState.currentRound = deck.learnState.currentRound || 1;
            studyState.startTime = new Date();
            showView('studyMode');
            document.getElementById('studyTitle').textContent = 'Learning Mode';
            document.getElementById('studySubtitle').textContent = deck.name;
            showProgress();
        }

        async function startSequenceMode(deckId) {
            document.getElementById('progressView').classList.add('hidden');
            document.getElementById('cardView').classList.add('hidden');
            document.getElementById('sequenceView').classList.remove('hidden');
            document.getElementById('completeView').classList.add('hidden');
            currentMode = 'sequence';
            currentDeckId = deckId;
            const deck = decks[deckId];
            deck.settings = {...DEFAULT_DECK_SETTINGS, ...(deck.settings || {})};
            await saveDataToDB('decks', deck);
            
            // Initialize study state for sequence learning
            studyState.settings = deck.settings;
            studyState.currentCard = deck.cards[0];  // Start with first sequence card
            studyState.currentChunkSize = deck.settings.chunkSize || 7;  // Default to 7 items per chunk
            studyState.currentChunkIndex = deck.sequenceState?.currentChunkIndex || 0;
            studyState.currentItemIndex = deck.sequenceState?.currentItemIndex || 0;
            studyState.totalChunks = Math.ceil(studyState.currentCard.content.items.length / studyState.currentChunkSize);
            studyState.chunksComplete = deck.sequenceState?.chunksComplete || [];
            studyState.currentRound = deck.sequenceState?.currentRound || 1;
            studyState.startTime = new Date();
            
            showView('studyMode');
            document.getElementById('studyTitle').textContent = 'Sequence Learning';
            document.getElementById('studySubtitle').textContent = deck.name;
            
            if (studyState.chunksComplete.length === studyState.totalChunks) {
                showComplete();
            } else {
                startChunk(studyState.currentChunkIndex);
            }
        }

        function startChunk(chunkIndex) {
            if (chunkIndex >= studyState.totalChunks) {
                showComplete();
                return;
            }
            studyState.currentChunkIndex = chunkIndex;
            studyState.currentItemIndex = 0;
            displayPrompt(0);
            saveSequenceProgress();
        }

        function checkAnswer(userInput) {
            const currentChunk = getCurrentChunk();
            const expectedAnswer = currentChunk[studyState.currentItemIndex + 1];  // Next item is the answer
            
            if (userInput.trim().toLowerCase() === expectedAnswer.trim().toLowerCase()) {
                handleCorrectAnswer();
            } else {
                handleIncorrectAnswer(expectedAnswer);
            }
        }

        function handleCorrectAnswer() {
            const feedback = document.getElementById('sequenceFeedback');
            feedback.textContent = 'Correct!';
            feedback.classList.remove('hidden');
            feedback.style.color = 'var(--success-color)';
            
            studyState.currentItemIndex++;
            if (studyState.currentItemIndex >= getCurrentChunk().length - 1) {
                // -1 because we don't test the last item of the sequence
                setTimeout(() => completeChunk(), 1500);
            } else {
                setTimeout(() => {
                    displayPrompt(studyState.currentItemIndex);
                    document.getElementById('sequenceFeedback').classList.add('hidden');
                    document.getElementById('sequenceInput').value = '';
                }, 1500);
            }
            saveSequenceProgress();
        }

        function handleIncorrectAnswer(correctAnswer) {
            const feedback = document.getElementById('sequenceFeedback');
            feedback.textContent = `Incorrect. The correct answer is: ${correctAnswer}`;
            feedback.classList.remove('hidden');
            feedback.style.color = 'var(--danger-color)';
            
            setTimeout(() => {
                displayPrompt(studyState.currentItemIndex);  // Stay on same item
                document.getElementById('sequenceFeedback').classList.add('hidden');
                document.getElementById('sequenceInput').value = '';
            }, 3000);
        }

        function getCurrentChunk() {
            const startIdx = studyState.currentChunkIndex * studyState.currentChunkSize;
            const endIdx = Math.min(startIdx + studyState.currentChunkSize, studyState.currentCard.content.items.length);
            return studyState.currentCard.content.items.slice(startIdx, endIdx);
        }

        function displayPrompt(itemIndex) {
            const currentChunk = getCurrentChunk();
            const promptText = currentChunk[itemIndex];
            const totalInChunk = currentChunk.length - 1;  // -1 because we don't test the last item
            
            // Update progress display
            document.getElementById('sequenceProgress').textContent = 
                `Item ${itemIndex + 1} of ${totalInChunk}`;
            
            // If last item, set progress bar to 100%
            if (itemIndex >= totalInChunk) {
                document.getElementById('sequenceProgressBar').style.width = '100%';
            } else {
                document.getElementById('sequenceProgressBar').style.width = `${(itemIndex / totalInChunk) * 100}%`;
            }

            // Update prompt
            document.getElementById('sequencePrompt').textContent = 
                `${itemIndex + 1}. ${promptText}`;
            
            // Show the Check Answer button for the new question
            document.getElementById('checkSequenceBtn').classList.remove('hidden');
            // Clear and focus input
            const input = document.getElementById('sequenceInput');
            input.value = '';
            input.focus();

            // Clear any previous feedback
            document.getElementById('sequenceFeedback').classList.add('hidden');
        }
        
        async function saveSequenceProgress() {
            const deck = decks[currentDeckId];
            deck.sequenceState = {
                currentChunkIndex: studyState.currentChunkIndex,
                currentItemIndex: studyState.currentItemIndex,
                chunksComplete: studyState.chunksComplete,
                currentRound: studyState.currentRound
            };
            await saveDataToDB('decks', deck);
        }

        async function completeChunk() {
            // Mark current chunk as mastered
            const chunkIndex = studyState.currentChunkIndex;
            studyState.chunkStates[chunkIndex] = 'mastered';
            if (!studyState.chunksComplete.includes(chunkIndex)) {
                studyState.chunksComplete.push(chunkIndex);
            }

            const feedback = document.getElementById('sequenceFeedback');
            feedback.style.color = 'var(--success-color)';
            feedback.textContent = 'Chunk completed!';
            feedback.classList.remove('hidden');

            await saveSequenceProgress();

            setTimeout(() => {
                const nextChunkIndex = chunkIndex + 1;
                // If all chunks mastered, end sequence session
                if (studyState.chunkStates.every(state => state === 'mastered')) {
                    endSequenceSession();
                } else if (nextChunkIndex < studyState.chunks.length) {
                    studyState.currentChunkIndex = nextChunkIndex;
                    startChunk(nextChunkIndex);
                } else {
                    // If no more chunks, but not all mastered, restart
                    studyState.currentRound++;
                    startChunk(0);
                }
            }, 2000);
        }
        // Enable Enter key to submit answer in Sequence Learning
        document.addEventListener('DOMContentLoaded', function() {
            const sequenceInput = document.getElementById('sequenceInput');
            if (sequenceInput) {
                sequenceInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey && !sequenceInput.disabled) {
                        e.preventDefault();
                        document.getElementById('checkSequenceBtn').click();
                    }
                });
            }
        });
        // Show Sequence Complete message and go to Session Progress
        function endSequenceSession() {
            const feedback = document.getElementById('sequenceFeedback');
            feedback.style.color = 'var(--success-color)';
            feedback.textContent = 'Sequence Complete!';
            feedback.classList.remove('hidden');
            setTimeout(() => {
                showComplete(); // Navigate to Session Progress screen
            }, 2000);
        }

        async function startSpacedLearning(deckId) {
            document.getElementById('progressView').classList.add('hidden');
            document.getElementById('cardView').classList.add('hidden');
            document.getElementById('completeView').classList.add('hidden');
            currentMode = 'spaced';
            currentDeckId = deckId;
            const deck = decks[deckId];

            const feedbackStyle = globalSettings.spacedLearningFeedbackStyle || 'simple';

            deck.settings = {...DEFAULT_DECK_SETTINGS, ...(deck.settings || {}), feedbackStyle: feedbackStyle };
            await saveDataToDB('decks', deck);

            const now = new Date();
            const allCards = [...deck.cards];
            const dueCards = allCards.filter(c => new Date(c.sm2Data.dueDate) <= now && c.sm2Data.repetition > 0);
            const newCards = allCards.filter(c => c.sm2Data.repetition === 0);
            
            const newCardsForSession = shuffleArray(newCards).slice(0, globalSettings.newCardsPerDay);
            
            studyState.roundCards = shuffleArray([...dueCards, ...newCardsForSession]);
            studyState.settings = deck.settings;
            studyState.currentRound = 1;
            studyState.currentCardIndex = 0;
            studyState.startTime = new Date();

            showView('studyMode');
            document.getElementById('studyTitle').textContent = 'Spaced Learning';
            document.getElementById('studySubtitle').textContent = deck.name;
            
            if (studyState.roundCards.length > 0) {
                transitionSubView(document.getElementById('progressView'), document.getElementById('cardView'));
                showNextCard();
            } else {
                showProgress();
                showToast("No cards are due for review right now!");
            }
        }

        async function startReviewMode(deckId) {
            document.getElementById('progressView').classList.add('hidden');
            document.getElementById('cardView').classList.add('hidden');
            document.getElementById('completeView').classList.add('hidden');
            currentMode = 'review';
            currentDeckId = deckId;
            const deck = decks[deckId];
            deck.settings = {...DEFAULT_DECK_SETTINGS, ...(deck.settings || {})};
            await saveDataToDB('decks', deck);

            studyState.settings = deck.settings;
            studyState.stillLearning = [...(deck.reviewState?.stillLearning || deck.cards)];
            studyState.correct = [...(deck.reviewState?.correct || [])];
            studyState.currentRound = deck.reviewState?.currentRound || 1;
            studyState.lastRoundIncorrect = [...(deck.reviewState?.lastRoundIncorrect || [])];
            studyState.startTime = new Date();
            showView('studyMode');
            document.getElementById('studyTitle').textContent = 'Review Mode';
            document.getElementById('studySubtitle').textContent = deck.name;
            if (studyState.stillLearning.length === 0) showComplete();
            else showProgress();
        }


        async function saveStudyProgress() {
            if (!currentDeckId) return;
            const deck = decks[currentDeckId];
            if (!deck) return;
            if (currentMode === 'learn') {
                deck.learnState = { buckets: studyState.buckets, currentRound: studyState.currentRound, maxBuckets: studyState.settings.maxBuckets };
            } else if (currentMode === 'review') {
                deck.reviewState = { stillLearning: studyState.stillLearning, correct: studyState.correct, currentRound: studyState.currentRound, lastRoundIncorrect: studyState.lastRoundIncorrect };
            }
            await saveDataToDB('decks', deck);
            updateDashboard();
        }
        
        function showProgress() {
            const cardView = document.getElementById('cardView');
            const progressView = document.getElementById('progressView');
            transitionSubView(cardView, progressView);
            document.getElementById('switchStudyModeBtn').classList.add('hidden');

            const continueBtn = document.getElementById('continueBtn');
            if(studyState.currentRound === 1) {
                continueBtn.textContent = 'Start Round';
                continueBtn.classList.add('btn-prominent');
            } else {
                continueBtn.textContent = 'Continue Round';
                continueBtn.classList.remove('btn-prominent');
            }
            if(currentMode === 'learn') updateLearnProgress();
            else if (currentMode === 'review') updateReviewProgress();
            else if (currentMode === 'spaced') updateSpacedProgress();
        }
        
        function getBucketName(index, totalBuckets) {
            const names = {
                3: ["New", "Reviewing", "Mastered"],
                4: ["New", "Learning", "Reviewing", "Mastered"],
                5: ["New", "Learning", "Reviewing", "Mastered", "Legendary"]
            };
            return (names[totalBuckets] && names[totalBuckets][index]) || `Bucket ${index + 1}`;
        }

        function updateLearnProgress() {
            const deck = decks[currentDeckId];
            const maxBuckets = studyState.settings.maxBuckets;
            const mastered = studyState.buckets[maxBuckets - 1]?.length || 0;
            const total = deck.cards.length;
            
            const notesContainer = document.getElementById('deckNotesDisplay');
            if (deck.notes && studyState.currentRound === 1) {
                notesContainer.innerHTML = `<h3>Notes:</h3><div>${deck.notes}</div>`;
                notesContainer.classList.remove('hidden');
            } else {
                notesContainer.classList.add('hidden');
            }

            if (mastered === total && total > 0) { 
                document.getElementById('progressTitle').textContent = 'Deck Mastered!';
                const continueBtn = document.getElementById('continueBtn');
                continueBtn.textContent = 'Finish';
                continueBtn.classList.remove('btn-prominent')
                continueBtn.classList.add('btn-success');
                continueBtn.onclick = showComplete;
                return;
             }
            document.getElementById('progressTitle').textContent = 'Learning Progress';
            document.getElementById('roundInfo').textContent = `Round ${studyState.currentRound}`;
            document.getElementById('bucketsContainer').innerHTML = Array.from({length: maxBuckets}, (_, i) => `<div class="bucket"><div class="bucket-number">${getBucketName(i, maxBuckets)}</div><div class="bucket-count">${studyState.buckets[i]?.length || 0}</div></div>`).join('');
            
            let currentProgressPoints = 0;
            studyState.buckets.forEach((bucket, i) => {
                currentProgressPoints += bucket.length * i;
            });
            const maxProgressPoints = total > 0 ? total * (maxBuckets - 1) : 0;
            const progress = maxProgressPoints > 0 ? (currentProgressPoints / maxProgressPoints) * 100 : 0;

            document.getElementById('progressBarFill').style.width = `${progress}%`;
            document.getElementById('statsContainer').innerHTML = `<div class="stat"><div class="stat-value">${mastered}</div><div class="stat-label">Mastered</div></div><div class="stat"><div class="stat-value">${total - mastered}</div><div class="stat-label">Remaining</div></div>`;
        }

        function updateReviewProgress() {
            const deck = decks[currentDeckId];
            const mastered = studyState.correct.length, remaining = studyState.stillLearning.length, total = deck.cards.length;

            const notesContainer = document.getElementById('deckNotesDisplay');
            if (deck.notes && studyState.currentRound === 1) {
                notesContainer.innerHTML = `<h3>Notes for this deck:</h3><div>${deck.notes}</div>`;
                notesContainer.classList.remove('hidden');
            } else {
                notesContainer.classList.add('hidden');
            }

            if (remaining === 0 && total > 0) {
                document.getElementById('progressTitle').textContent = 'Deck Mastered!';
                const continueBtn = document.getElementById('continueBtn');
                continueBtn.textContent = 'Finish';
                continueBtn.classList.remove('btn-prominent');
                continueBtn.classList.add('btn-success');
                continueBtn.onclick = showComplete;
                return;
            }
            document.getElementById('progressTitle').textContent = 'Review Progress';
            document.getElementById('roundInfo').textContent = `Round ${studyState.currentRound}`;
            document.getElementById('bucketsContainer').innerHTML = `<div class="bucket"><div class="bucket-number">Still Learning</div><div class="bucket-count">${remaining}</div></div><div class="bucket"><div class="bucket-number">Correct</div><div class="bucket-count">${mastered}</div></div>`;
            const progress = total > 0 ? (mastered / total) * 100 : 0;
            document.getElementById('progressBarFill').style.width = `${progress}%`;
            document.getElementById('statsContainer').innerHTML = `<div class="stat"><div class='stat-value'>${mastered}</div><div class='stat-label'>Total Mastered</div></div><div class='stat'><div class='stat-value'>${remaining}</div><div class='stat-label'>Remaining</div></div>`;
        }
        
        function updateSpacedProgress() {
            const deck = decks[currentDeckId];
            const now = new Date();
            const dueCards = deck.cards.filter(c => new Date(c.sm2Data.dueDate) <= now);
            const total = deck.cards.length;

            document.getElementById('progressTitle').textContent = 'Spaced Learning';
            document.getElementById('roundInfo').textContent = `${studyState.roundCards.length} cards in this session`;
            document.getElementById('bucketsContainer').innerHTML = ''; 
            document.getElementById('progressBarFill').style.width = total > 0 ? `${((total - dueCards.length) / total) * 100}%` : '0%';
            document.getElementById('statsContainer').innerHTML = `<div class="stat"><div class="stat-value">${dueCards.length}</div><div class="stat-label">Cards Due</div></div><div class="stat"><div class="stat-value">${total}</div><div class="stat-label">Total Cards</div></div>`;
            
            if (studyState.roundCards.length === 0) {
                document.getElementById('continueBtn').textContent = 'Finish';
                document.getElementById('continueBtn').onclick = endSession;
            } else {
                document.getElementById('continueBtn').textContent = 'Start Round';
                 document.getElementById('continueBtn').onclick = continueStudy;
            }
        }

        function continueStudy() {
            if (currentMode === 'learn') {
                const cardsPerRound = studyState.settings.cardsPerRound === 'all' ? 999 : parseInt(studyState.settings.cardsPerRound);
                const availableCards = studyState.buckets.slice(0, -1).flat();
                
                const newCards = availableCards.filter(c => c.sm2Data.repetition === 0);
                const reviewCards = availableCards.filter(c => c.sm2Data.repetition > 0)
                                                 .sort((a, b) => new Date(a.sm2Data.dueDate) - new Date(b.sm2Data.dueDate));
                
                const newCardsCount = Math.min(newCards.length, Math.floor(cardsPerRound / 2));
                const reviewCardsCount = cardsPerRound - newCardsCount;

                const roundNewCards = shuffleArray(newCards).slice(0, newCardsCount);
                const roundReviewCards = reviewCards.slice(0, reviewCardsCount);
                
                studyState.roundCards = shuffleArray([...roundNewCards, ...roundReviewCards]);

            } else if (currentMode === 'review') {
                let prioritized = [];
                let others = [];

                if (studyState.lastRoundIncorrect && studyState.lastRoundIncorrect.length > 0) {
                    const incorrectIds = new Set(studyState.lastRoundIncorrect.map(c => c.id));
                    studyState.stillLearning.forEach(card => {
                        if (incorrectIds.has(card.id)) prioritized.push(card);
                        else others.push(card);
                    });
                } else {
                    others = [...studyState.stillLearning];
                }
                studyState.lastRoundIncorrect = []; 

                let sortedCards;
                if (studyState.settings.reviewOrder === 'alphabetical') {
                    prioritized.sort((a, b) => a.question.localeCompare(b.question));
                    others.sort((a, b) => a.question.localeCompare(b.question));
                    sortedCards = prioritized.concat(others);
                } else { 
                    sortedCards = shuffleArray(prioritized).concat(shuffleArray(others));
                }
                studyState.roundCards = sortedCards;
            } else if (currentMode === 'spaced') {
                
            }

            studyState.currentCardIndex = 0;
            if(studyState.roundCards.length > 0) {
                transitionSubView(document.getElementById('progressView'), document.getElementById('cardView'));
                showNextCard();
            }
            else { showProgress(); showToast("No cards available to study in this round."); }
        }

        function showNextCard() {
            if (studyState.currentCardIndex >= studyState.roundCards.length) {
                studyState.currentRound++;
                saveStudyProgress();
                showProgress();
                return;
            }
            window.scrollTo(0, 0);
            const card = studyState.roundCards[studyState.currentCardIndex];
            const flashcardElem = document.querySelector('#cardView .flashcard');
            flashcardElem.classList.remove('is-flipped');
            
            document.getElementById('cardRoundInfo').textContent = `Round ${studyState.currentRound} - Card ${studyState.currentCardIndex + 1} of ${studyState.roundCards.length}`;
            
            document.getElementById('cardQuestion').innerHTML = card.question;
            const questionContent = document.getElementById('cardQuestionContent');
            const existingQImg = questionContent.querySelector('.card-image');
            if(existingQImg) existingQImg.remove();
            if(card.questionImage) questionContent.innerHTML += `<img src="${card.questionImage}" class="card-image" style="margin: 15px auto 0 auto; display: block;">`;

            document.getElementById('cardAnswer').innerHTML = card.answer;
            const answerContent = document.getElementById('cardAnswerContent');
             const existingAImg = answerContent.querySelector('#cardAnswer .card-image');
            if(existingAImg) existingAImg.remove();
            if(card.answerImage) document.getElementById('cardAnswer').innerHTML += `<img src="${card.answerImage}" class="card-image" style="margin: 15px auto 0 auto; display: block;">`;
            
            document.getElementById('cardAnswerContent').classList.add('hidden');
            document.getElementById('simpleAnswerButtons').classList.remove('hidden');
            document.getElementById('advancedAnswerButtons').classList.add('hidden');
            document.getElementById('correctBtn').classList.add('hidden');
            document.getElementById('incorrectBtn').classList.add('hidden');
            document.getElementById('showQuestionBtn').classList.add('hidden');
            document.getElementById('userAnswerDisplay').classList.add('hidden');
            
            const writeInput = document.getElementById('writeAnswerInput');
            writeInput.classList.remove('correct', 'incorrect');
            const accentToggleBtn = document.getElementById('accentToggleBtn');
            const switchStudyModeBtn = document.getElementById('switchStudyModeBtn');
            const editStudyCardBtn = document.getElementById('editStudyCardBtn');

            const isWriteMode = (currentMode === 'learn' && studyState.settings.learnMode === 'write') || (currentMode === 'review' && studyState.settings.reviewMode === 'write');

            if (isWriteMode) {
                startInteractionLog(card.id);

                document.getElementById('showAnswerBtn').classList.add('hidden');
                document.getElementById('checkAnswerBtn').classList.remove('hidden');
                writeInput.value = '';
                writeInput.classList.remove('hidden');
                writeInput.disabled = false;
                setTimeout(() => writeInput.focus(), 100);
                accentToggleBtn.classList.remove('hidden');
                updateAccentButtonsVisibility();
            } else {
                document.getElementById('showAnswerBtn').classList.remove('hidden');
                document.getElementById('checkAnswerBtn').classList.add('hidden');
                writeInput.classList.add('hidden');
                accentToggleBtn.classList.add('hidden');
                document.getElementById('accentButtonsContainer').classList.add('hidden');
            }

            switchStudyModeBtn.classList.toggle('hidden', currentMode !== 'learn');
            editStudyCardBtn.classList.toggle('hidden', !globalSettings.enableInStudyEditing);

            const bucketInfo = document.getElementById('cardBucketInfo');
            if (currentMode === 'learn' || currentMode === 'spaced') {
                let bucketName = 'Unknown';
                if (currentMode === 'spaced') {
                    const now = new Date();
                    const dueDate = new Date(card.sm2Data.dueDate);
                    if (card.sm2Data.repetition === 0) {
                        bucketName = 'New Card';
                    } else if (dueDate <= now) {
                        bucketName = 'Due for Review';
                    } else {
                        const daysUntil = Math.ceil((dueDate - now) / (1000 * 60 * 60 * 24));
                        bucketName = `Due in ${daysUntil} day${daysUntil > 1 ? 's' : ''}`;
                    }
                } else {
                    for (let i = 0; i < studyState.buckets.length; i++) {
                        if (studyState.buckets[i].some(c => c.id === card.id)) {
                            bucketName = getBucketName(i, studyState.settings.maxBuckets);
                            break;
                        }
                    }
                }
                bucketInfo.textContent = `${bucketName}`;
                bucketInfo.style.display = 'block';
            } else {
                bucketInfo.style.display = 'none';
            }
        }

        function showAnswer() {
            document.querySelector('#cardView .flashcard').classList.add('is-flipped');
            document.getElementById('cardAnswerContent').classList.remove('hidden');
            document.getElementById('showAnswerBtn').classList.add('hidden');
            document.getElementById('checkAnswerBtn').classList.add('hidden');
            
            const isForgivingMode = studyState.settings.forgivingAutomarking && 
                                    (studyState.settings.learnMode === 'write' || studyState.settings.reviewMode === 'write');

            // If we are in forgiving auto-marking mode, don't show the manual grading buttons
            if (!isForgivingMode) {
                if (currentMode === 'spaced' && studyState.settings.feedbackStyle === 'advanced') {
                    document.getElementById('simpleAnswerButtons').classList.add('hidden');
                    document.getElementById('advancedAnswerButtons').classList.remove('hidden');
                } else {
                    document.getElementById('correctBtn').classList.remove('hidden');
                    document.getElementById('incorrectBtn').classList.remove('hidden');
                }
            }
            
            document.getElementById('showQuestionBtn').classList.remove('hidden');
        }
        
        function showQuestion() {
            document.querySelector('#cardView .flashcard').classList.remove('is-flipped');
            document.getElementById('showQuestionBtn').classList.add('hidden');
            document.getElementById('showAnswerBtn').classList.remove('hidden');
            document.getElementById('correctBtn').classList.add('hidden');
            document.getElementById('incorrectBtn').classList.add('hidden');
            document.getElementById('advancedAnswerButtons').classList.add('hidden');
        }

        function autoCheckAnswer() {
            const userInput = document.getElementById('writeAnswerInput');
            const card = studyState.roundCards[studyState.currentCardIndex];
            if (!card || userInput.value.trim() === '') return;

            const submissionTime = performance.now();
            
            const recallLatency = currentInteractionLog.firstKeyPressTime 
                ? Math.round(currentInteractionLog.firstKeyPressTime - currentInteractionLog.questionLoadTime) 
                : null; 
            let answerFluency = 0;
            if (currentInteractionLog.firstKeyPressTime) {
                const typingDuration = submissionTime - currentInteractionLog.firstKeyPressTime;
                if (typingDuration > 0) {
                    const charCount = userInput.value.trim().length;
                    answerFluency = parseFloat((charCount / (charCount / (typingDuration / 1000))).toFixed(2));
                }
            }
            
            let isCorrect;
            const userAnswer = userInput.value.trim();
            const correctAnswer = card.answer.trim();

            const isForgivingMode = studyState.settings.forgivingAutomarking;

            if (isForgivingMode) {
                const distance = levenshteinDistance(userAnswer, correctAnswer);
                const tolerance = Math.max(1, Math.floor(correctAnswer.length * 0.1));
                isCorrect = distance <= tolerance;
            } else {
                let processedUserAnswer = userAnswer;
                let processedCorrectAnswer = correctAnswer;
                if (!studyState.settings.caseSensitive) {
                    processedUserAnswer = processedUserAnswer.toLowerCase();
                    processedCorrectAnswer = processedCorrectAnswer.toLowerCase();
                }
                if (!studyState.settings.punctuation) {
                    const punc = /[.,/#!$%^&*;:{}=\-_`~()]/g;
                    processedUserAnswer = processedUserAnswer.replace(punc, "");
                    processedCorrectAnswer = processedCorrectAnswer.replace(punc, "");
                }
                isCorrect = processedUserAnswer === processedCorrectAnswer;
            }

            if (!studyState.isRetypingIncorrect) {
                 const finalLog = {
                    cardID: currentInteractionLog.cardID,
                    wasCorrect: isCorrect,
                    recallLatency: recallLatency,
                    answerFluency: answerFluency,
                    totalCorrections: currentInteractionLog.backspaceCount + currentInteractionLog.deleteCount,
                    attemptCount: currentInteractionLog.attemptCount,
                    userAnswer: userAnswer
                };
                logInteraction(finalLog);
            }
            if (studyState.isRetypingIncorrect) {
                if (isCorrect) {
                    studyState.isRetypingIncorrect = false;
                    
                    userInput.classList.add('correct');
                    userInput.disabled = true;

                    setTimeout(() => {
                        moveCard(card, false); 
                    }, 400); 
                    
                    return; 
                } else {
                    showToast("That's not quite right. Please type the answer exactly as shown.", "error");
                    userInput.value = ''; 
                    userInput.focus();
                    return; 
                }
            }

            userInput.classList.toggle('correct', isCorrect);
            userInput.classList.toggle('incorrect', !isCorrect);
            userInput.disabled = true;

            showAnswer();

            if (isForgivingMode) {
                setTimeout(() => {
                    if (isCorrect) {
                        markCorrect(true);
                    } else {
                        markIncorrect(true);
                    }
                }, 1800);
            }
        }

        async function moveCard(card, correct) {
            const cardInDeck = decks[currentDeckId].cards.find(c => c.id === card.id);
            if(cardInDeck) cardInDeck.isNew = false;
            
            const sm2 = new SM2Algorithm();
            const quality = correct ? 4 : 1; 
            cardInDeck.sm2Data = sm2.calculateNextReview(cardInDeck)(quality);

            if (currentMode === 'learn') {
                for (let i = 0; i < studyState.settings.maxBuckets; i++) {
                    const index = studyState.buckets[i]?.findIndex(c => c.id === card.id);
                    if (index > -1) {
                        studyState.buckets[i].splice(index, 1);
                        let targetBucket;
                        if (correct) {
                            targetBucket = Math.min(i + 1, studyState.settings.maxBuckets - 1);
                        } else {
                            if (studyState.settings.maxBuckets > 3 && i > 0) {
                                targetBucket = 1; 
                            } else {
                                targetBucket = 0;
                            }
                        }
                        studyState.buckets[targetBucket].push(card);
                        break;
                    }
                }
            } else if (currentMode === 'review') {
                if (correct) {
                    const index = studyState.stillLearning.findIndex(c => c.id === card.id);
                    if (index > -1) {
                        studyState.stillLearning.splice(index, 1);
                        studyState.correct.push(card);
                    }
                } else {
                     if (!studyState.lastRoundIncorrect.some(c => c.id === card.id)) {
                        studyState.lastRoundIncorrect.push(card);
                    }
                }
            }
            await saveDataToDB('decks', decks[currentDeckId]);
            studyState.currentCardIndex++;
            showNextCard();
        }
        
        async function markSpaced(quality) {
            if (!isActionAllowed()) return;
            const card = studyState.roundCards[studyState.currentCardIndex];
            const cardInDeck = decks[currentDeckId].cards.find(c => c.id === card.id);
            if (cardInDeck) {
                const sm2 = new SM2Algorithm();
                cardInDeck.sm2Data = sm2.calculateNextReview(cardInDeck)(quality);
                await saveDataToDB('decks', decks[currentDeckId]);
            }
            studyState.currentCardIndex++;
            showNextCard();
        }

        function markCorrect(isAutomated = false) {
            if (!isAutomated && !isActionAllowed()) return;

            const btn = document.getElementById('correctBtn');
            btn.classList.add('feedback-correct');
            setTimeout(() => {
                btn.classList.remove('feedback-correct');
                if (currentMode === 'spaced') {
                    markSpaced(4);
                } else {
                    moveCard(studyState.roundCards[studyState.currentCardIndex], true);
                }
            }, 200);
        }
        function markIncorrect(isAutomated = false) {
            if (!isAutomated && !isActionAllowed() && document.getElementById('writeAnswerInput').value.trim() !== '') return;

            const isWriteMode = (currentMode === 'learn' && studyState.settings.learnMode === 'write') || (currentMode === 'review' && studyState.settings.reviewMode === 'write');

            if (!isAutomated && isWriteMode && studyState.settings.retypeIncorrect) {
                studyState.isRetypingIncorrect = true;
                const writeInput = document.getElementById('writeAnswerInput');
                writeInput.value = '';
                writeInput.disabled = false;
                writeInput.focus();
                document.getElementById('correctBtn').classList.add('hidden');
                document.getElementById('incorrectBtn').classList.add('hidden');
                document.getElementById('checkAnswerBtn').classList.remove('hidden');
                showToast("Type the correct answer to continue.", "error");
                return;
            }

            const btn = document.getElementById('incorrectBtn');
            btn.classList.add('feedback-incorrect');
            setTimeout(() => {
                btn.classList.remove('feedback-incorrect');
                if (currentMode === 'spaced') {
                    markSpaced(1);
                } else {
                    moveCard(studyState.roundCards[studyState.currentCardIndex], false);
                }
            }, 200);
        }
        
        function populateAccentButtons() {
            const accents = ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', ''];
            const container = document.getElementById('accentButtonsContainer');
            container.innerHTML = accents.map(char => `<button onclick="insertAccent('${char}', 'writeAnswerInput')">${char}</button>`).join('');
        }

        function insertAccent(char, targetId) {
            const textarea = document.getElementById(targetId);
            if (!textarea) return; // Exit if the textarea isn't on the page
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            textarea.value = textarea.value.substring(0, start) + char + textarea.value.substring(end);
            textarea.selectionStart = textarea.selectionEnd = start + 1;
            textarea.focus();
        }

        async function toggleAccentButtons() {
            globalSettings.showAccents = !globalSettings.showAccents;
            await saveDataToDB('appData', { key: 'userSettings', ...globalSettings });
            updateAccentButtonsVisibility();
        }

        function updateAccentButtonsVisibility() {
            const container = document.getElementById('accentButtonsContainer');
            if (globalSettings.showAccents) {
                populateAccentButtons();
                container.classList.remove('hidden');
            } else {
                container.classList.add('hidden');
            }
        }

        function populateTestAccentButtons() {
            const accents = ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', ''];
            const container = document.getElementById('testAccentButtonsContainer');
            container.innerHTML = accents.map(char => `<button onclick="insertAccent('${char}', 'testAnswerInput')">${char}</button>`).join('');
        }

        async function toggleTestAccentButtons() {
            globalSettings.showAccents = !globalSettings.showAccents;
            await saveDataToDB('appData', { key: 'userSettings', ...globalSettings });
            updateTestAccentButtonsVisibility();
        }

        function updateTestAccentButtonsVisibility() {
            const container = document.getElementById('testAccentButtonsContainer');
            if (globalSettings.showAccents) {
                populateTestAccentButtons();
                container.classList.remove('hidden');
            } else {
                container.classList.add('hidden');
            }
        }

        function showComplete() {
            const currentSubView = document.querySelector('#studyMode .sub-view:not(.hidden)');
            const completeView = document.getElementById('completeView');
            transitionSubView(currentSubView, completeView);
            document.getElementById('finalStats').innerHTML = `<div class="stat"><div class="stat-value">${studyState.currentRound}</div><div class="stat-label">Total Rounds</div></div><div class="stat"><div class="stat-value">${decks[currentDeckId].cards.length}</div><div class="stat-label">Cards Mastered</div></div>`;
        }

        async function endSession() {
            if (studyState.startTime) {
                const duration = Math.round((new Date() - studyState.startTime) / 1000);
                analyticsData.totalStudyTime += duration;
                analyticsData.sessions.unshift({
                    date: new Date().toISOString(),
                    deckName: decks[currentDeckId].name,
                    mode: currentMode,
                    duration: duration
                });
                if (analyticsData.sessions.length > 50) analyticsData.sessions.pop();
                await saveDataToDB('appData', { key: 'analytics', ...analyticsData });
            }
            saveStudyProgress();
            backToDashboard();
        }

        function resetProgress() {
            showConfirmModal('Are you sure you want to reset your progress for this deck?', () => restartStudy());
        }
        
        async function restartStudy() {
            const deck = decks[currentDeckId];
            if (currentMode === 'learn') {
                deck.learnState.buckets = [[...deck.cards]];
                while(deck.learnState.buckets.length < deck.settings.maxBuckets) deck.learnState.buckets.push([]);
                deck.learnState.currentRound = 1;
                await saveDataToDB('decks', deck);
                startLearnMode(currentDeckId);
            } else if (currentMode === 'review') {
                deck.reviewState = { stillLearning: [...deck.cards], correct: [], currentRound: 1, lastRoundIncorrect: [] };
                await saveDataToDB('decks', deck);
                startReviewMode(currentDeckId);
            } else if (currentMode === 'spaced') {
                const sm2 = new SM2Algorithm();
                deck.cards.forEach(card => card.sm2Data = sm2.calculateNextReview({})(3));
                await saveDataToDB('decks', deck);
                configureStudy('spaced', currentDeckId);
            }
        }
        
        function isActionAllowed() {
            if (activeView !== 'studyMode' || document.getElementById('cardView').classList.contains('hidden')) {
                return false;
            }
            const correctBtnHidden = document.getElementById('correctBtn').classList.contains('hidden');
            const advancedBtnsHidden = document.getElementById('advancedAnswerButtons').classList.contains('hidden');
            return !correctBtnHidden || !advancedBtnsHidden;
        }

        function setupKeyboardControls() {
            document.addEventListener('keydown', (e) => {
                if (document.querySelector('.modal.show')) return; // Ignore shortcuts if a modal is open

                // --- Progress Screen Shortcut ---
                if (activeView === 'studyMode' && !document.getElementById('progressView').classList.contains('hidden')) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        document.getElementById('continueBtn').click(); // Clicks the button to start/continue
                    }
                    return;
                }

                // --- Card View Shortcuts (only if we're in the card view) ---
                if (activeView !== 'studyMode' || document.getElementById('cardView').classList.contains('hidden')) return;

                const advancedButtons = document.getElementById('advancedAnswerButtons');
                const simpleCorrectBtn = document.getElementById('correctBtn');
                const showAnswerBtn = document.getElementById('showAnswerBtn');

                // PRIORITY 1: Spaced Learning Shortcuts are active
                if (!advancedButtons.classList.contains('hidden')) {
                    e.preventDefault(); // Prevent default browser actions for number keys
                    switch (e.key) {
                        case '1': markSpaced(1); break; // Again
                        case '2': markSpaced(2); break; // Hard
                        case '3': markSpaced(3); break; // Good
                        case '4': markSpaced(4); break; // Easy
                    }
                    return; // Action was handled, so we exit
                }

                // PRIORITY 2: Simple Feedback Shortcuts are active
                if (!simpleCorrectBtn.classList.contains('hidden')) {
                    e.preventDefault();
                    if (e.key === 'ArrowLeft' || e.key === '1') {
                        markIncorrect();
                    } else if (e.key === 'ArrowRight' || e.key === '2') {
                        markCorrect();
                    }
                    return; // Action was handled, so we exit
                }

                // PRIORITY 3: "Show Answer" button is active
                if (!showAnswerBtn.classList.contains('hidden')) {
                    if (document.activeElement.tagName === 'TEXTAREA') return; // Don't interfere with typing
                    if (e.key === ' ' || e.key === 'Enter') {
                        e.preventDefault();
                        showAnswer();
                    }
                }
            });
        }

    async function toggleStudyMode() {
        if (currentMode !== 'learn') return;
        const deck = decks[currentDeckId];
        if (!deck) return;

        studyState.settings.learnMode = studyState.settings.learnMode === 'write' ? 'flashcard' : 'write';
        deck.settings.learnMode = studyState.settings.learnMode;
        
        await saveDataToDB('decks', deck);
        showToast(`Switched to ${studyState.settings.learnMode} mode.`);
        
        showNextCard();
    }
        
    function shuffleArray(array) {
        const newArray = [...array];
        for (let i = newArray.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [newArray[i], newArray[j]] = [newArray[j], newArray[i]]; }
            return newArray;
        }

        function openDeckSettingsModal(deckId) {
            const deck = decks[deckId];
            if (!deck) return;
            const settings = {...DEFAULT_DECK_SETTINGS, ...(deck.settings || {})};
            document.getElementById('caseSensitiveToggle').checked = settings.caseSensitive;
            document.getElementById('punctuationToggle').checked = settings.punctuation;
            document.getElementById('retypeIncorrectToggle').checked = settings.retypeIncorrect;
            document.getElementById('reviewOrder').value = settings.reviewOrder;
            document.getElementById('bucketCount').value = settings.maxBuckets;
            document.querySelector(`input[name="deckSettingsStudyMode"][value="${settings.learnMode}"]`).checked = true;
            document.getElementById('deckSettingsCardsPerRound').value = settings.cardsPerRound;
            document.getElementById('deckSettingsModal').classList.add('show');
            document.getElementById('forgivingAutomarkingToggle').checked = settings.forgivingAutomarking;
            setupRadioCardSelection('deckSettingsStudyMode');
        }

        function closeDeckSettingsModal() { document.getElementById('deckSettingsModal').classList.remove('show'); }

        async function saveDeckSettings() {
            const deck = decks[currentViewingDeckId];
            if (!deck) return;
            const newBucketCount = parseInt(document.getElementById('bucketCount').value);

            if (deck.settings.maxBuckets !== newBucketCount) {
                showConfirmModal("Changing the number of buckets will reset this deck's learning progress. Are you sure?", async () => {
                    deck.settings.maxBuckets = newBucketCount;
                    deck.learnState = {
                        buckets: [[...deck.cards]],
                        currentRound: 1, 
                        maxBuckets: newBucketCount
                    };
                    while(deck.learnState.buckets.length < newBucketCount) deck.learnState.buckets.push([]);
                    await completeSaveDeckSettings(deck);
                });
            } else {
                 await completeSaveDeckSettings(deck);
            }
        }
        
        async function completeSaveDeckSettings(deck) {
            deck.settings.caseSensitive = document.getElementById('caseSensitiveToggle').checked;
            deck.settings.punctuation = document.getElementById('punctuationToggle').checked;
            deck.settings.retypeIncorrect = document.getElementById('retypeIncorrectToggle').checked;
            deck.settings.reviewOrder = document.getElementById('reviewOrder').value;
            deck.settings.learnMode = document.querySelector('input[name="deckSettingsStudyMode"]:checked').value;
            deck.settings.cardsPerRound = document.getElementById('deckSettingsCardsPerRound').value;
            deck.settings.forgivingAutomarking = document.getElementById('forgivingAutomarkingToggle').checked;
            await saveDataToDB('decks', deck);
            updateDashboard();
            closeDeckSettingsModal();
            showToast('Settings saved!');
        }

        function showImportModal() { document.getElementById('importModal').classList.add('show'); }
        function closeImportModal() { document.getElementById('importModal').classList.remove('show'); }
        function switchImportTab(tabName) {
            document.getElementById('importContentPaste').classList.toggle('hidden', tabName !== 'paste');
            document.getElementById('importContentFile').classList.toggle('hidden', tabName !== 'file');
            document.getElementById('importTabPaste').classList.toggle('active', tabName === 'paste');
            document.getElementById('importTabFile').classList.toggle('active', tabName === 'file');
        }
        function importData() {
            const name = document.getElementById('importDeckName').value.trim();
            if(!name) { showToast('Please provide a name for the new deck.', 'error'); return; }

            const fileInput = document.getElementById('importFileInput');
            const pastedText = document.getElementById('importPastedText').value;

            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                const reader = new FileReader();
                reader.onload = async function(e) {
                    try {
                        if (file.name.endsWith('.json')) {
                            const importedDeck = JSON.parse(e.target.result);
                            if (!importedDeck.name || !Array.isArray(importedDeck.cards)) throw new Error('Invalid JSON format.');
                            
                            const deckId = Date.now().toString();
                            const newDeck = { ...importedDeck, id: deckId, name: name, created: new Date().toISOString() };
                            
                            const oldIdToNewCardMap = new Map();
                            newDeck.cards = newDeck.cards.map(oldCard => {
                                const newCard = { ...oldCard, id: Date.now() + Math.random() };
                                oldIdToNewCardMap.set(oldCard.id, newCard);
                                return newCard;
                            });

                            if (newDeck.learnState && newDeck.learnState.buckets) {
                                newDeck.learnState.buckets = newDeck.learnState.buckets.map(bucket => 
                                    bucket.map(c => oldIdToNewCardMap.get(c.id)).filter(Boolean)
                                );
                            }
                            if (newDeck.reviewState) {
                                if (newDeck.reviewState.stillLearning) newDeck.reviewState.stillLearning = newDeck.reviewState.stillLearning.map(c => oldIdToNewCardMap.get(c.id)).filter(Boolean);
                                if (newDeck.reviewState.correct) newDeck.reviewState.correct = newDeck.reviewState.correct.map(c => oldIdToNewCardMap.get(c.id)).filter(Boolean);
                                if (newDeck.reviewState.lastRoundIncorrect) newDeck.reviewState.lastRoundIncorrect = newDeck.reviewState.lastRoundIncorrect.map(c => oldIdToNewCardMap.get(c.id)).filter(Boolean);
                            }

                            decks[deckId] = newDeck;
                            await saveDataToDB('decks', newDeck);
                            showToast(`Deck "${name}" imported successfully with ${newDeck.cards.length} cards!`);
                        } else if (file.name.endsWith('.csv') || file.name.endsWith('.txt')) {
                            const cards = parseTextData(e.target.result, file.name.endsWith('.csv') ? ',' : '\t');
                             if (cards.length > 0) {
                                await createNewDeck(name, importedDeck.category || 'Other', cards);
                                showToast(`Deck "${name}" imported successfully with ${cards.length} cards!`);
                            } else { throw new Error('No valid cards found in file.'); }
                        }
                        closeImportModal();
                        updateDashboard();
                    } catch (error) { showToast(`Error importing file: ${error.message}`, 'error'); }
                };
                reader.readAsText(file);
            } else if (pastedText.trim()) {
                 try {
                    const cards = parseTextData(pastedText.trim(), '\t');
                    if (cards.length > 0) {
                        createNewDeck(name, 'Other', cards);
                        showToast(`Deck "${name}" created successfully with ${cards.length} cards!`);
                        closeImportModal();
                        updateDashboard();
                    } else { throw new Error('No valid cards found in text.'); }
                 } catch (error) { showToast(`Error parsing text: ${error.message}`, 'error'); }
            } else {
                showToast('Please select a file or paste text to import.', 'error');
            }
        }
        function parseTextData(text, separator) {
            return text.split('\n').map(line => {
                const parts = line.split(separator);
                if (parts.length >= 2 && parts[0].trim() && parts[1].trim()) {
                    return { id: Date.now() + Math.random(), question: parts[0].trim(), answer: parts[1].trim(), isNew: true };
                }
                return null;
            }).filter(Boolean);
        }

        async function compressImage(dataUrl, maxSizeMB = 1) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);

                    let quality = 0.9;
                    let compressedDataUrl = canvas.toDataURL('image/jpeg', quality);
                    
                    while (compressedDataUrl.length > maxSizeMB * 1024 * 1024 && quality > 0.1) {
                        quality -= 0.1;
                        compressedDataUrl = canvas.toDataURL('image/jpeg', quality);
                    }
                    resolve(compressedDataUrl);
                };
                img.onerror = () => resolve(dataUrl); 
                img.src = dataUrl;
            });
        }

        function showConfirmModal(text, onConfirm, title = "Confirm Action") {
            const modal = document.getElementById('confirmActionModal');
            document.getElementById('confirmActionTitle').textContent = title;
            document.getElementById('confirmActionText').textContent = text;
            
            const confirmBtn = document.getElementById('confirmActionConfirmBtn');
            const newConfirmBtn = confirmBtn.cloneNode(true);
            confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);

            newConfirmBtn.addEventListener('click', () => {
                onConfirm();
                cancelAction();
            });
            
            modal.classList.add('show');
        }

        function cancelAction() {
            document.getElementById('confirmActionModal').classList.remove('show');
        }

        function openPracticeTestModal(deckId) {
            practiceTestState.deckId = deckId;
            document.getElementById('numQuestions').max = decks[deckId].cards.length;
            document.getElementById('numQuestions').value = Math.min(10, decks[deckId].cards.length);
            document.getElementById('practiceTestModal').classList.add('show');
        }

        function closePracticeTestModal() {
            document.getElementById('practiceTestModal').classList.remove('show');
        }

        function startPracticeTest() {
            const deckId = practiceTestState.deckId;
            const deck = decks[deckId];
            const testType = document.getElementById('testType').value;
            const numQuestions = parseInt(document.getElementById('numQuestions').value);
            
            if (numQuestions > deck.cards.length) {
                showToast("Not enough cards in deck", "error");
                return;
            }
            
            practiceTestState.cards = shuffleArray([...deck.cards]).slice(0, numQuestions);
            practiceTestState.testType = testType;
            practiceTestState.numQuestions = numQuestions;
            practiceTestState.currentCardIndex = 0;
            practiceTestState.correctCount = 0;
            practiceTestState.incorrectCount = 0;
            practiceTestState.startTime = new Date();
            
            closePracticeTestModal();
            
            showView('practiceTestView');
            document.getElementById('testSubtitle').textContent = deck.name;
            
            updateTestProgress();
            document.getElementById('testProgressView').classList.remove('hidden');
            document.getElementById('testCardView').classList.add('hidden');
            document.getElementById('testCompleteView').classList.add('hidden');
        }

        function updateTestProgress() {
            const total = practiceTestState.numQuestions;
            const current = practiceTestState.currentCardIndex;
            const correct = practiceTestState.correctCount;
            const incorrect = practiceTestState.incorrectCount;
            
            document.getElementById('testInfo').textContent = `${current} of ${total} questions`;
            document.getElementById('testProgressBar').style.width = total > 0 ? `${(current / total) * 100}%` : '0%';
            document.getElementById('testCorrectCount').textContent = correct;
            document.getElementById('testIncorrectCount').textContent = incorrect;
        }

        function startTest() {
            transitionSubView(
                document.getElementById('testProgressView'), 
                document.getElementById('testCardView')
            );
            showNextTestQuestion();
        }

        function showNextTestQuestion() {
            if (practiceTestState.currentCardIndex >= practiceTestState.cards.length) {
                finishTest();
                return;
            }

            const card = practiceTestState.cards[practiceTestState.currentCardIndex];
            const testType = practiceTestState.testType;
            let currentTestType = testType;
            if (testType === 'mixed') {
                currentTestType = Math.random() > 0.5 ? 'multiple_choice' : 'type';
            }

            document.querySelector('#testCardView .flashcard').classList.remove('is-flipped');
            document.getElementById('testQuestion').innerHTML = card.question;
            document.getElementById('testAnswer').innerHTML = card.answer;
            document.getElementById('testAnswerContent').classList.add('hidden');
            document.getElementById('testOptions').classList.add('hidden');
            document.getElementById('testAnswerInput').classList.add('hidden');
            document.getElementById('testShowAnswerBtn').classList.add('hidden');
            document.getElementById('testCheckAnswerBtn').classList.add('hidden');
            document.getElementById('testCorrectBtn').classList.add('hidden');
            document.getElementById('testIncorrectBtn').classList.add('hidden');
            document.getElementById('testNextBtn').classList.add('hidden');
            document.getElementById('testAccentToggleBtn').classList.add('hidden'); 
            testAnswerInput.classList.remove('correct', 'incorrect');
            document.getElementById('testCardInfo').textContent =
                `Question ${practiceTestState.currentCardIndex + 1} of ${practiceTestState.numQuestions}`;

            if (currentTestType === 'multiple_choice') {
                const options = generateMultipleChoiceOptions(card, practiceTestState.cards);
                displayMultipleChoiceOptions(options);
            } else if (currentTestType === 'type') {
                document.getElementById('testAnswerInput').classList.remove('hidden');
                document.getElementById('testAnswerInput').value = '';
                document.getElementById('testAnswerInput').disabled = false;
                document.getElementById('testCheckAnswerBtn').classList.remove('hidden');
                document.getElementById('testAnswerInput').focus();

                // --- ADD THESE TWO LINES TO SHOW ACCENT FEATURES ---
                document.getElementById('testAccentToggleBtn').classList.remove('hidden');
                updateTestAccentButtonsVisibility(); // Check if buttons should be shown

            } else {
                document.getElementById('testShowAnswerBtn').classList.remove('hidden');
            }
        }

        function generateMultipleChoiceOptions(correctCard, allCards) {
            const options = new Set([correctCard.answer]);
            const wrongAnswers = shuffleArray(allCards.filter(card => card.id !== correctCard.id));
            
            for (const wrongCard of wrongAnswers) {
                if (options.size < 4) {
                    options.add(wrongCard.answer);
                } else {
                    break;
                }
            }
            return shuffleArray(Array.from(options));
        }

        function displayMultipleChoiceOptions(options) {
            const optionsContainer = document.getElementById('testOptions');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('hidden');
            
            options.forEach((option) => {
                const button = document.createElement('button');
                button.className = 'btn btn-secondary';
                button.textContent = option;
                button.onclick = () => {
                    checkTestAnswer(option);
                    document.querySelectorAll('#testOptions button').forEach(btn => btn.disabled = true);
                };
                optionsContainer.appendChild(button);
            });
        }

        function checkTestAnswer(selectedOption = null) {
            const card = practiceTestState.cards[practiceTestState.currentCardIndex];
            const isMultipleChoice = selectedOption !== null;
            
            const userInput = isMultipleChoice ? selectedOption : document.getElementById('testAnswerInput').value.trim();
            const correctAnswer = card.answer.trim();
            
            const isCorrect = userInput.toLowerCase() === correctAnswer.toLowerCase();
            
            if (isMultipleChoice) {
                document.querySelectorAll('#testOptions button').forEach(btn => {
                    if (btn.textContent === selectedOption) {
                        btn.className = isCorrect ? 'btn btn-success' : 'btn btn-danger';
                    }
                    if (btn.textContent === correctAnswer && !isCorrect) {
                        btn.className = 'btn btn-success';
                    }
                });
            } else {
                document.getElementById('testAnswerInput').classList.toggle('correct', isCorrect);
                document.getElementById('testAnswerInput').classList.toggle('incorrect', !isCorrect);
                document.getElementById('testAnswerInput').disabled = true;
            }
            
            document.getElementById('testCheckAnswerBtn').classList.add('hidden');
            document.getElementById('testAnswerContent').classList.remove('hidden');
            document.querySelector('#testCardView .flashcard').classList.add('is-flipped');
            document.getElementById('testNextBtn').classList.remove('hidden');
            
            if (isCorrect) practiceTestState.correctCount++;
            else practiceTestState.incorrectCount++;
        }

        function showTestAnswer() {
            document.querySelector('#testCardView .flashcard').classList.add('is-flipped');
            document.getElementById('testAnswerContent').classList.remove('hidden');
            document.getElementById('testShowAnswerBtn').classList.add('hidden');
            document.getElementById('testCorrectBtn').classList.remove('hidden');
            document.getElementById('testIncorrectBtn').classList.remove('hidden');
        }

        function markTestCorrect() {
            practiceTestState.correctCount++;
            nextTestQuestion();
        }

        function markTestIncorrect() {
            practiceTestState.incorrectCount++;
            nextTestQuestion();
        }

        function nextTestQuestion() {
            practiceTestState.currentCardIndex++;
            updateTestProgress();
            showNextTestQuestion();
        }

        async function finishTest() {
            const endTime = new Date();
            const timeTaken = Math.round((endTime - practiceTestState.startTime) / 1000);
            const totalAnswered = practiceTestState.correctCount + practiceTestState.incorrectCount;
            const accuracy = totalAnswered > 0 ? Math.round((practiceTestState.correctCount / totalAnswered) * 100) : 0;
            const score = practiceTestState.numQuestions > 0 ? Math.round((practiceTestState.correctCount / practiceTestState.numQuestions) * 100) : 0;
            
            document.getElementById('testScore').textContent = score;
            document.getElementById('testCorrectFinal').textContent = practiceTestState.correctCount;
            document.getElementById('testTotalFinal').textContent = practiceTestState.numQuestions;
            document.getElementById('testTime').textContent = `${timeTaken}s`;
            document.getElementById('testAccuracy').textContent = `${accuracy}%`;
            
            analyticsData.totalStudyTime += timeTaken;
            analyticsData.sessions.unshift({
                date: new Date().toISOString(),
                deckName: decks[practiceTestState.deckId].name,
                mode: 'Practice Test',
                duration: timeTaken,
                accuracy: accuracy
            });
             if (analyticsData.sessions.length > 50) analyticsData.sessions.pop();
            await saveDataToDB('appData', { key: 'analytics', ...analyticsData });
            
            transitionSubView(
                document.getElementById('testCardView'), 
                document.getElementById('testCompleteView')
            );
        }

        function restartTest() {
            practiceTestState.currentCardIndex = 0;
            practiceTestState.correctCount = 0;
            practiceTestState.incorrectCount = 0;
            practiceTestState.startTime = new Date();
            
            transitionSubView(
                document.getElementById('testCompleteView'), 
                document.getElementById('testProgressView')
            );
        }

        function endTest() {
            showView('dashboard');
        }
        
        async function updateStreak() {
            const today = new Date().setHours(0, 0, 0, 0);
            const lastUsedDate = analyticsData.lastUsed ? new Date(analyticsData.lastUsed).setHours(0, 0, 0, 0) : null;

            if (lastUsedDate) {
                const yesterday = new Date(today);
                yesterday.setDate(yesterday.getDate() - 1);

                if (lastUsedDate === yesterday.getTime()) {
                    analyticsData.streak++;
                } else if (lastUsedDate < yesterday.getTime()) {
                    analyticsData.streak = 1;
                }
            } else {
                analyticsData.streak = 1;
            }

            analyticsData.lastUsed = new Date(today).toISOString();
            await saveDataToDB('appData', { key: 'analytics', ...analyticsData });
        }

        function showAnalyticsModal() {
            document.getElementById('analyticsStreak').textContent = `${analyticsData.streak} day${analyticsData.streak === 1 ? '' : 's'}`;
            const totalMinutes = Math.round(analyticsData.totalStudyTime / 60);
            document.getElementById('analyticsTotalTime').textContent = `${totalMinutes}m`;

            const sessionList = document.getElementById('analyticsSessionList');
            if (analyticsData.sessions.length > 0) {
                sessionList.innerHTML = analyticsData.sessions.map(s => {
                    const date = new Date(s.date).toLocaleString();
                    const duration = `${Math.round(s.duration / 60)}m`;
                    const accuracyText = s.accuracy !== undefined ? ` - ${s.accuracy}% acc` : '';
                    return `<div class="deck-card-item">${date}: Studied "${s.deckName}" (${s.mode}) for ${duration}${accuracyText}</div>`;
                }).join('');
            } else {
                sessionList.innerHTML = '<p style="color: var(--secondary-text); text-align: center;">No study sessions recorded yet.</p>';
            }

            document.getElementById('analyticsModal').classList.add('show');
        }

        window.onclick = function(event) {
            document.querySelectorAll('.modal').forEach(modal => { if (event.target === modal) modal.classList.remove('show'); });
        }
        function levenshteinDistance(s1, s2) {
            s1 = s1.toLowerCase();
            s2 = s2.toLowerCase();

            const costs = [];
            for (let i = 0; i <= s1.length; i++) {
                let lastValue = i;
                for (let j = 0; j <= s2.length; j++) {
                    if (i === 0) {
                        costs[j] = j;
                    } else {
                        if (j > 0) {
                            let newValue = costs[j - 1];
                            if (s1.charAt(i - 1) !== s2.charAt(j - 1)) {
                                newValue = Math.min(Math.min(newValue, lastValue), costs[j]) + 1;
                            }
                            costs[j - 1] = lastValue;
                            lastValue = newValue;
                        }
                    }
                }
                if (i > 0) costs[s2.length] = lastValue;
            }
            return costs[s2.length];
        }

        function setupRadioCardSelection(radioGroupName) {
            const radioInputs = document.querySelectorAll(`input[name="${radioGroupName}"]`);
            
            function updateSelection() {
                radioInputs.forEach(input => {
                    const parentCard = input.closest('.checkbox-group');
                    if (parentCard) {
                        parentCard.classList.toggle('is-selected', input.checked);
                    }
                });
            }

            radioInputs.forEach(input => {
                input.addEventListener('change', updateSelection);
                const parentCard = input.closest('.checkbox-group');
                if (parentCard) {
                    parentCard.addEventListener('click', () => {
                        if (!input.checked) {
                            input.checked = true;
                            input.dispatchEvent(new Event('change'));
                        }
                    });
                }
            });
            
            updateSelection();
        }

        function calculateIQS(logData, userBaseline = { latency: 1500, fluency: 10 }) {
            const v_latency = 1 - (Math.min(logData.recallLatency / userBaseline.latency, 2) / 2);

            const v_fluency = Math.min(logData.answerFluency / userBaseline.fluency, 1.5) / 1.5;

            const v_corrections = 1 / (1 + logData.totalCorrections);
            
            const v_attempts = 1 / logData.attemptCount;

            const W_latency = 0.30;
            const W_fluency = 0.20;
            const W_corrections = 0.25;
            const W_attempts = 0.25;

            const iqs = (W_latency * v_latency) + (W_fluency * v_fluency) + (W_corrections * v_corrections) + (W_attempts * v_attempts);

            return Math.max(0, Math.min(1, iqs));
        }
        async function fetchLatestDownloads() {
            const repo = 'TJ7755/Lagiote-Revise';
            const apiUrl = `https://api.github.com/repos/${repo}/releases`;
            const container = document.getElementById('download-buttons-container');

            container.innerHTML = `<p style="color: var(--secondary-text);">Loading latest downloads...</p>`;


            try {
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error(`GitHub API error: ${response.status}`);
                const data = await response.json();

                if (!Array.isArray(data) || data.length === 0) {
                    container.innerHTML = `<p style="color: var(--secondary-text);">No releases found for this repository.</p>`;
                    return;
                }
                const latestRelease = data[0];
                
                if (latestRelease && latestRelease.assets && latestRelease.assets.length > 0) {
                    container.innerHTML = ''; 
                    
                    const winAsset = latestRelease.assets.find(a => a.name.endsWith('.exe'));
                    const macAsset = latestRelease.assets.find(a => a.name.endsWith('.dmg'));

                    if (winAsset) {
                        const winBtn = document.createElement('a');
                        winBtn.href = winAsset.browser_download_url;
                        winBtn.className = 'btn';
                        winBtn.innerHTML = `Download for Windows`;
                        container.appendChild(winBtn);
                    }
                    
                    if (macAsset) {
                        const macBtn = document.createElement('a');
                        macBtn.href = macAsset.browser_download_url;
                        macBtn.className = 'btn';
                        macBtn.innerHTML = `Download for Mac`;
                        container.appendChild(macBtn);
                    }

                    if (!winAsset && !macAsset) {
                        container.innerHTML = `<p style="color: var(--secondary-text);">No compatible downloads found in the latest release.</p>`;
                    }
                    
                } else {
                    container.innerHTML = `<p style="color: var(--secondary-text);">Could not find any download files in the latest release.</p>`;
                }
            } catch (error) {
                console.error('Failed to fetch downloads:', error);
                container.innerHTML = `<p style="color: var(--secondary-text);">Failed to load downloads. Please try again later.</p>`;
            }
        }
        
        function showDownloadsModal() {
            document.getElementById('downloadsModal').classList.add('show');
            fetchLatestDownloads();
        }
    </script>

    <style>
  [data-custom-class='body'], [data-custom-class='body'] * {
          background: transparent !important;
        }
[data-custom-class='title'], [data-custom-class='title'] * {
          font-family: Arial !important;
font-size: 26px !important;
color: #000000 !important;
        }
[data-custom-class='subtitle'], [data-custom-class='subtitle'] * {
          font-family: Arial !important;
color: #595959 !important;
font-size: 14px !important;
        }
[data-custom-class='heading_1'], [data-custom-class='heading_1'] * {
          font-family: Arial !important;
font-size: 19px !important;
color: #000000 !important;
        }
[data-custom-class='heading_2'], [data-custom-class='heading_2'] * {
          font-family: Arial !important;
font-size: 17px !important;
color: #000000 !important;
        }
[data-custom-class='body_text'], [data-custom-class='body_text'] * {
          color: #595959 !important;
font-size: 14px !important;
font-family: Arial !important;
        }
[data-custom-class='link'], [data-custom-class='link'] * {
          color: #3030F1 !important;
font-size: 14px !important;
font-family: Arial !important;
word-break: break-word !important;
        }
</style>
      <span style="display: block;margin: 0 auto 3.125rem;width: 11.125rem;height: 2.375rem;background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNzgiIGhlaWdodD0iMzgiIHZpZXdCb3g9IjAgMCAxNzggMzgiPgogICAgPGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8cGF0aCBmaWxsPSIjRDFEMUQxIiBkPSJNNC4yODMgMjQuMTA3Yy0uNzA1IDAtMS4yNTgtLjI1Ni0xLjY2LS43NjhoLS4wODVjLjA1Ny41MDIuMDg2Ljc5Mi4wODYuODd2Mi40MzRILjk4NXYtOC42NDhoMS4zMzJsLjIzMS43NzloLjA3NmMuMzgzLS41OTQuOTUtLjg5MiAxLjcwMi0uODkyLjcxIDAgMS4yNjQuMjc0IDEuNjY1LjgyMi40MDEuNTQ4LjYwMiAxLjMwOS42MDIgMi4yODMgMCAuNjQtLjA5NCAxLjE5OC0uMjgyIDEuNjctLjE4OC40NzMtLjQ1Ni44MzMtLjgwMyAxLjA4LS4zNDcuMjQ3LS43NTYuMzctMS4yMjUuMzd6TTMuOCAxOS4xOTNjLS40MDUgMC0uNy4xMjQtLjg4Ni4zNzMtLjE4Ny4yNDktLjI4My42Ni0uMjkgMS4yMzN2LjE3N2MwIC42NDUuMDk1IDEuMTA3LjI4NyAxLjM4Ni4xOTIuMjguNDk1LjQxOS45MS40MTkuNzM0IDAgMS4xMDEtLjYwNSAxLjEwMS0xLjgxNiAwLS41OS0uMDktMS4wMzQtLjI3LTEuMzI5LS4xODItLjI5NS0uNDY1LS40NDMtLjg1Mi0uNDQzem01LjU3IDEuNzk0YzAgLjU5NC4wOTggMS4wNDQuMjkzIDEuMzQ4LjE5Ni4zMDQuNTEzLjQ1Ny45NTQuNDU3LjQzNyAwIC43NS0uMTUyLjk0Mi0uNDU0LjE5Mi0uMzAzLjI4OC0uNzUzLjI4OC0xLjM1MSAwLS41OTUtLjA5Ny0xLjA0LS4yOS0xLjMzOC0uMTk0LS4yOTctLjUxLS40NDUtLjk1LS40NDUtLjQzOCAwLS43NTMuMTQ3LS45NDYuNDQzLS4xOTQuMjk1LS4yOS43NDItLjI5IDEuMzR6bTQuMTUzIDBjMCAuOTc3LS4yNTggMS43NDItLjc3NCAyLjI5My0uNTE1LjU1Mi0xLjIzMy44MjctMi4xNTQuODI3LS41NzYgMC0xLjA4NS0uMTI2LTEuNTI1LS4zNzhhMi41MiAyLjUyIDAgMCAxLTEuMDE1LTEuMDg4Yy0uMjM3LS40NzMtLjM1NS0xLjAyNC0uMzU1LTEuNjU0IDAtLjk4MS4yNTYtMS43NDQuNzY4LTIuMjg4LjUxMi0uNTQ1IDEuMjMyLS44MTcgMi4xNi0uODE3LjU3NiAwIDEuMDg1LjEyNiAxLjUyNS4zNzYuNDQuMjUxLjc3OS42MSAxLjAxNSAxLjA4LjIzNi40NjkuMzU1IDEuMDE5LjM1NSAxLjY0OXpNMTkuNzEgMjRsLS40NjItMi4xLS42MjMtMi42NTNoLS4wMzdMMTcuNDkzIDI0SDE1LjczbC0xLjcwOC02LjAwNWgxLjYzM2wuNjkzIDIuNjU5Yy4xMS40NzYuMjI0IDEuMTMzLjMzOCAxLjk3MWguMDMyYy4wMTUtLjI3Mi4wNzctLjcwNC4xODgtMS4yOTRsLjA4Ni0uNDU3Ljc0Mi0yLjg3OWgxLjgwNGwuNzA0IDIuODc5Yy4wMTQuMDc5LjAzNy4xOTUuMDY3LjM1YTIwLjk5OCAyMC45OTggMCAwIDEgLjE2NyAxLjAwMmMuMDIzLjE2NS4wMzYuMjk5LjA0LjM5OWguMDMyYy4wMzItLjI1OC4wOS0uNjExLjE3Mi0xLjA2LjA4Mi0uNDUuMTQxLS43NTQuMTc3LS45MTFsLjcyLTIuNjU5aDEuNjA2TDIxLjQ5NCAyNGgtMS43ODN6bTcuMDg2LTQuOTUyYy0uMzQ4IDAtLjYyLjExLS44MTcuMzMtLjE5Ny4yMi0uMzEuNTMzLS4zMzguOTM3aDIuMjk5Yy0uMDA4LS40MDQtLjExMy0uNzE3LS4zMTctLjkzNy0uMjA0LS4yMi0uNDgtLjMzLS44MjctLjMzem0uMjMgNS4wNmMtLjk2NiAwLTEuNzIyLS4yNjctMi4yNjYtLjgtLjU0NC0uNTM0LS44MTYtMS4yOS0uODE2LTIuMjY3IDAtMS4wMDcuMjUxLTEuNzg1Ljc1NC0yLjMzNC41MDMtLjU1IDEuMTk5LS44MjUgMi4wODctLjgyNS44NDggMCAxLjUxLjI0MiAxLjk4Mi43MjUuNDcyLjQ4NC43MDkgMS4xNTIuNzA5IDIuMDA0di43OTVoLTMuODczYy4wMTguNDY1LjE1Ni44MjkuNDE0IDEuMDkuMjU4LjI2MS42Mi4zOTIgMS4wODUuMzkyLjM2MSAwIC43MDMtLjAzNyAxLjAyNi0uMTEzYTUuMTMzIDUuMTMzIDAgMCAwIDEuMDEtLjM2djEuMjY4Yy0uMjg3LjE0My0uNTkzLjI1LS45Mi4zMmE1Ljc5IDUuNzkgMCAwIDEtMS4xOTEuMTA0em03LjI1My02LjIyNmMuMjIyIDAgLjQwNi4wMTYuNTUzLjA0OWwtLjEyNCAxLjUzNmExLjg3NyAxLjg3NyAwIDAgMC0uNDgzLS4wNTRjLS41MjMgMC0uOTMuMTM0LTEuMjIyLjQwMy0uMjkyLjI2OC0uNDM4LjY0NC0uNDM4IDEuMTI4VjI0aC0xLjYzOHYtNi4wMDVoMS4yNGwuMjQyIDEuMDFoLjA4Yy4xODctLjMzNy40MzktLjYwOC43NTYtLjgxNGExLjg2IDEuODYgMCAwIDEgMS4wMzQtLjMwOXptNC4wMjkgMS4xNjZjLS4zNDcgMC0uNjIuMTEtLjgxNy4zMy0uMTk3LjIyLS4zMS41MzMtLjMzOC45MzdoMi4yOTljLS4wMDctLjQwNC0uMTEzLS43MTctLjMxNy0uOTM3LS4yMDQtLjIyLS40OC0uMzMtLjgyNy0uMzN6bS4yMyA1LjA2Yy0uOTY2IDAtMS43MjItLjI2Ny0yLjI2Ni0uOC0uNTQ0LS41MzQtLjgxNi0xLjI5LS44MTYtMi4yNjcgMC0xLjAwNy4yNTEtMS43ODUuNzU0LTIuMzM0LjUwNC0uNTUgMS4yLS44MjUgMi4wODctLjgyNS44NDkgMCAxLjUxLjI0MiAxLjk4Mi43MjUuNDczLjQ4NC43MDkgMS4xNTIuNzA5IDIuMDA0di43OTVoLTMuODczYy4wMTguNDY1LjE1Ni44MjkuNDE0IDEuMDkuMjU4LjI2MS42Mi4zOTIgMS4wODUuMzkyLjM2MiAwIC43MDQtLjAzNyAxLjAyNi0uMTEzYTUuMTMzIDUuMTMzIDAgMCAwIDEuMDEtLjM2djEuMjY4Yy0uMjg3LjE0My0uNTkzLjI1LS45MTkuMzJhNS43OSA1Ljc5IDAgMCAxLTEuMTkyLjEwNHptNS44MDMgMGMtLjcwNiAwLTEuMjYtLjI3NS0xLjY2My0uODIyLS40MDMtLjU0OC0uNjA0LTEuMzA3LS42MDQtMi4yNzggMC0uOTg0LjIwNS0xLjc1Mi42MTUtMi4zMDEuNDEtLjU1Ljk3NS0uODI1IDEuNjk1LS44MjUuNzU1IDAgMS4zMzIuMjk0IDEuNzI5Ljg4MWguMDU0YTYuNjk3IDYuNjk3IDAgMCAxLS4xMjQtMS4xOTh2LTEuOTIyaDEuNjQ0VjI0SDQ2LjQzbC0uMzE3LS43NzloLS4wN2MtLjM3Mi41OTEtLjk0Ljg4Ni0xLjcwMi44ODZ6bS41NzQtMS4zMDZjLjQyIDAgLjcyNi0uMTIxLjkyMS0uMzY1LjE5Ni0uMjQzLjMwMi0uNjU3LjMyLTEuMjR2LS4xNzhjMC0uNjQ0LS4xLTEuMTA2LS4yOTgtMS4zODYtLjE5OS0uMjc5LS41MjItLjQxOS0uOTctLjQxOWEuOTYyLjk2MiAwIDAgMC0uODUuNDY1Yy0uMjAzLjMxLS4zMDQuNzYtLjMwNCAxLjM1IDAgLjU5Mi4xMDIgMS4wMzUuMzA2IDEuMzMuMjA0LjI5Ni40OTYuNDQzLjg3NS40NDN6bTEwLjkyMi00LjkyYy43MDkgMCAxLjI2NC4yNzcgMS42NjUuODMuNC41NTMuNjAxIDEuMzEyLjYwMSAyLjI3NSAwIC45OTItLjIwNiAxLjc2LS42MiAyLjMwNC0uNDE0LjU0NC0uOTc3LjgxNi0xLjY5LjgxNi0uNzA1IDAtMS4yNTgtLjI1Ni0xLjY1OS0uNzY4aC0uMTEzbC0uMjc0LjY2MWgtMS4yNTF2LTguMzU3aDEuNjM4djEuOTQ0YzAgLjI0Ny0uMDIxLjY0My0uMDY0IDEuMTg3aC4wNjRjLjM4My0uNTk0Ljk1LS44OTIgMS43MDMtLjg5MnptLS41MjcgMS4zMWMtLjQwNCAwLS43LjEyNS0uODg2LjM3NC0uMTg2LjI0OS0uMjgzLjY2LS4yOSAxLjIzM3YuMTc3YzAgLjY0NS4wOTYgMS4xMDcuMjg3IDEuMzg2LjE5Mi4yOC40OTUuNDE5LjkxLjQxOS4zMzcgMCAuNjA1LS4xNTUuODA0LS40NjUuMTk5LS4zMS4yOTgtLjc2LjI5OC0xLjM1IDAtLjU5MS0uMS0xLjAzNS0uMy0xLjMzYS45NDMuOTQzIDAgMCAwLS44MjMtLjQ0M3ptMy4xODYtMS4xOTdoMS43OTRsMS4xMzQgMy4zNzljLjA5Ni4yOTMuMTYzLjY0LjE5OCAxLjA0MmguMDMzYy4wMzktLjM3LjExNi0uNzE3LjIzLTEuMDQybDEuMTEyLTMuMzc5aDEuNzU3bC0yLjU0IDYuNzczYy0uMjM0LjYyNy0uNTY2IDEuMDk2LS45OTcgMS40MDctLjQzMi4zMTItLjkzNi40NjgtMS41MTIuNDY4LS4yODMgMC0uNTYtLjAzLS44MzMtLjA5MnYtMS4zYTIuOCAyLjggMCAwIDAgLjY0NS4wN2MuMjkgMCAuNTQzLS4wODguNzYtLjI2Ni4yMTctLjE3Ny4zODYtLjQ0NC41MDgtLjgwM2wuMDk2LS4yOTUtMi4zODUtNS45NjJ6Ii8+CiAgICAgICAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNzMpIj4KICAgICAgICAgICAgPGNpcmNsZSBjeD0iMTkiIGN5PSIxOSIgcj0iMTkiIGZpbGw9IiNFMEUwRTAiLz4KICAgICAgICAgICAgPHBhdGggZmlsbD0iI0ZGRiIgZD0iTTIyLjQ3NCAxNS40NDNoNS4xNjJMMTIuNDM2IDMwLjRWMTAuMzYzaDE1LjJsLTUuMTYyIDUuMDh6Ii8+CiAgICAgICAgPC9nPgogICAgICAgIDxwYXRoIGZpbGw9IiNEMkQyRDIiIGQ9Ik0xMjEuNTQ0IDE0LjU2di0xLjcyOGg4LjI3MnYxLjcyOGgtMy4wMjRWMjRoLTIuMjR2LTkuNDRoLTMuMDA4em0xMy43NDQgOS41NjhjLTEuMjkgMC0yLjM0MS0uNDE5LTMuMTUyLTEuMjU2LS44MS0uODM3LTEuMjE2LTEuOTQ0LTEuMjE2LTMuMzJzLjQwOC0yLjQ3NyAxLjIyNC0zLjMwNGMuODE2LS44MjcgMS44NzItMS4yNCAzLjE2OC0xLjI0czIuMzYuNDAzIDMuMTkyIDEuMjA4Yy44MzIuODA1IDEuMjQ4IDEuODggMS4yNDggMy4yMjQgMCAuMzEtLjAyMS41OTctLjA2NC44NjRoLTYuNDY0Yy4wNTMuNTc2LjI2NyAxLjA0LjY0IDEuMzkyLjM3My4zNTIuODQ4LjUyOCAxLjQyNC41MjguNzc5IDAgMS4zNTUtLjMyIDEuNzI4LS45NmgyLjQzMmEzLjg5MSAzLjg5MSAwIDAgMS0xLjQ4OCAyLjA2NGMtLjczNi41MzMtMS42MjcuOC0yLjY3Mi44em0xLjQ4LTYuNjg4Yy0uNC0uMzUyLS44ODMtLjUyOC0xLjQ0OC0uNTI4cy0xLjAzNy4xNzYtMS40MTYuNTI4Yy0uMzc5LjM1Mi0uNjA1LjgyMS0uNjggMS40MDhoNC4xOTJjLS4wMzItLjU4Ny0uMjQ4LTEuMDU2LS42NDgtMS40MDh6bTcuMDE2LTIuMzA0djEuNTY4Yy41OTctMS4xMyAxLjQ2MS0xLjY5NiAyLjU5Mi0xLjY5NnYyLjMwNGgtLjU2Yy0uNjcyIDAtMS4xNzkuMTY4LTEuNTIuNTA0LS4zNDEuMzM2LS41MTIuOTE1LS41MTIgMS43MzZWMjRoLTIuMjU2di04Ljg2NGgyLjI1NnptNi40NDggMHYxLjMyOGMuNTY1LS45NyAxLjQ4My0xLjQ1NiAyLjc1Mi0xLjQ1Ni42NzIgMCAxLjI3Mi4xNTUgMS44LjQ2NC41MjguMzEuOTM2Ljc1MiAxLjIyNCAxLjMyOC4zMS0uNTU1LjczMy0uOTkyIDEuMjcyLTEuMzEyYTMuNDg4IDMuNDg4IDAgMCAxIDEuODE2LS40OGMxLjA1NiAwIDEuOTA3LjMzIDIuNTUyLjk5Mi42NDUuNjYxLjk2OCAxLjU5Ljk2OCAyLjc4NFYyNGgtMi4yNHYtNC44OTZjMC0uNjkzLS4xNzYtMS4yMjQtLjUyOC0xLjU5Mi0uMzUyLS4zNjgtLjgzMi0uNTUyLTEuNDQtLjU1MnMtMS4wOS4xODQtMS40NDguNTUyYy0uMzU3LjM2OC0uNTM2Ljg5OS0uNTM2IDEuNTkyVjI0aC0yLjI0di00Ljg5NmMwLS42OTMtLjE3Ni0xLjIyNC0uNTI4LTEuNTkyLS4zNTItLjM2OC0uODMyLS41NTItMS40NC0uNTUycy0xLjA5LjE4NC0xLjQ0OC41NTJjLS4zNTcuMzY4LS41MzYuODk5LS41MzYgMS41OTJWMjRoLTIuMjU2di04Ljg2NGgyLjI1NnpNMTY0LjkzNiAyNFYxMi4xNmgyLjI1NlYyNGgtMi4yNTZ6bTcuMDQtLjE2bC0zLjQ3Mi04LjcwNGgyLjUyOGwyLjI1NiA2LjMwNCAyLjM4NC02LjMwNGgyLjM1MmwtNS41MzYgMTMuMDU2aC0yLjM1MmwxLjg0LTQuMzUyeiIvPgogICAgPC9nPgo8L3N2Zz4K) center no-repeat;"></span>

      <div data-custom-class="body">
      <div><strong><span style="font-size: 26px;"><span data-custom-class="title"><bdt class="block-component"></bdt><bdt class="question"><h1>PRIVACY POLICY</h1></bdt><bdt class="statement-end-if-in-editor"></bdt></span></span></strong></div><div><span style="color: rgb(127, 127, 127);"><strong><span style="font-size: 15px;"><span data-custom-class="subtitle">Last updated <bdt class="question">October 18, 2025</bdt></span></span></strong></span></div><div><br></div><div><br></div><div><br></div><div style="line-height: 1.5;"><span style="color: rgb(127, 127, 127);"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span data-custom-class="body_text">This Privacy Notice for <bdt class="question noTranslate">Lagiote Revise</bdt><bdt class="block-component"></bdt></bdt> (<bdt class="block-component"></bdt>'<strong>we</strong>', '<strong>us</strong>', or '<strong>our</strong>'<bdt class="else-block"></bdt></span><span data-custom-class="body_text">), describes how and why we might access, collect, store, use, and/or share (<bdt class="block-component"></bdt>'<strong>process</strong>'<bdt class="else-block"></bdt>) your personal information when you use our services (<bdt class="block-component"></bdt>'<strong>Services</strong>'<bdt class="else-block"></bdt>), including when you:</span></span></span><span style="font-size: 15px;"><span style="color: rgb(127, 127, 127);"><span data-custom-class="body_text"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></span></span></span></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">Visit our website<bdt class="block-component"></bdt> at <span style="color: rgb(0, 58, 250);"><bdt class="question noTranslate"><a target="_blank" data-custom-class="link" href="http://lagiote-revise.netlify.app">http://lagiote-revise.netlify.app</a></bdt></span><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><bdt class="statement-end-if-in-editor"> or any website of ours that links to this Privacy Notice</bdt></span></span></span></span></span></span></span></span></li></ul><div><bdt class="block-component"><span style="font-size: 15px;"><span style="font-size: 15px;"><span style="color: rgb(127, 127, 127);"><span data-custom-class="body_text"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"></bdt></bdt></span></span></span></span></span></span></span></span></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"></span></bdt></li></ul><div style="line-height: 1.5;"><span style="font-size: 15px;"><span style="color: rgb(127, 127, 127);"><span data-custom-class="body_text"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></span></span></span></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">Engage with us in other related ways, including any sales, marketing, or events<span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><bdt class="statement-end-if-in-editor"></bdt></span></span></span></span></span></span></span></span></li></ul><div style="line-height: 1.5;"><span style="font-size: 15px;"><span style="color: rgb(127, 127, 127);"><span data-custom-class="body_text"><strong>Questions or concerns?</strong>Reading this Privacy Notice will help you understand your privacy rights and choices. We are responsible for making decisions about how your personal information is processed. If you do not agree with our policies and practices, please do not use our Services.<bdt class="block-component"></bdt> If you still have any questions or concerns, please contact us at <bdt class="question noTranslate"><a target="_blank" data-custom-class="link" href="mailto:secret-badge-sulk@duck.com">secret-badge-sulk@duck.com</a></bdt>.</span></span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><strong><span style="font-size: 15px;"><span data-custom-class="heading_1"><h2>SUMMARY OF KEY POINTS</h2></span></span></strong></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text"><strong><em>This summary provides key points from our Privacy Notice, but you can find out more details about any of these topics by clicking the link following each key point or by using our</em></strong></span></span><a data-custom-class="link" href="#toc"><span style="color: rgb(0, 58, 250); font-size: 15px;"><span data-custom-class="body_text"><strong><em>table of contents</em></strong></span></span></a><span style="font-size: 15px;"><span data-custom-class="body_text"><strong><em>below to find the section you are looking for.</em></strong></span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text"><strong>What personal information do we process?</strong> When you visit, use, or navigate our Services, we may process personal information depending on how you interact with us and the Services, the choices you make, and the products and features you use. Learn more about</span></span><a data-custom-class="link" href="#personalinfo"><span style="color: rgb(0, 58, 250); font-size: 15px;"><span data-custom-class="body_text">personal information you disclose to us</span></span></a><span data-custom-class="body_text">.</span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text"><strong>Do we process any sensitive personal information?</strong>Some of the information may be considered <bdt class="block-component"></bdt>'special' or 'sensitive'<bdt class="else-block"></bdt> in certain jurisdictions, for example your racial or ethnic origins, sexual orientation, and religious beliefs. <bdt class="block-component"></bdt>We do not process sensitive personal information.<bdt class="else-block"></bdt></span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text"><strong>Do we collect any information from third parties?</strong> <bdt class="block-component"></bdt>We do not collect any information from third parties.<bdt class="else-block"></bdt></span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text"><strong>How do we process your information?</strong> We process your information to provide, improve, and administer our Services, communicate with you, for security and fraud prevention, and to comply with law. We may also process your information for other purposes with your consent. We process your information only when we have a valid legal reason to do so. Learn more about</span></span><a data-custom-class="link" href="#infouse"><span style="color: rgb(0, 58, 250); font-size: 15px;"><span data-custom-class="body_text">how we process your information</span></span></a><span data-custom-class="body_text">.</span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text"><strong>In what situations and with which <bdt class="block-component"></bdt>types of <bdt class="statement-end-if-in-editor"></bdt>parties do we share personal information?</strong> We may share information in specific situations and with specific <bdt class="block-component"></bdt>categories of <bdt class="statement-end-if-in-editor"></bdt>third parties. Learn more about</span></span><a data-custom-class="link" href="#whoshare"><span style="color: rgb(0, 58, 250); font-size: 15px;"><span data-custom-class="body_text">when and with whom we share your personal information</span></span></a><span style="font-size: 15px;"><span data-custom-class="body_text">.<bdt class="block-component"></bdt></span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text"><strong>What are your rights?</strong> Depending on where you are located geographically, the applicable privacy law may mean you have certain rights regarding your personal information. Learn more about</span></span><a data-custom-class="link" href="#privacyrights"><span style="color: rgb(0, 58, 250); font-size: 15px;"><span data-custom-class="body_text">your privacy rights</span></span></a><span data-custom-class="body_text">.</span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text"><strong>How do you exercise your rights?</strong> The easiest way to exercise your rights is by <bdt class="block-component"></bdt>visiting <span style="color: rgb(0, 58, 250);"><bdt class="question"><a target="_blank" data-custom-class="link" href="mailto:secret-badge-sulk@duck.com">secret-badge-sulk@duck.com</a></bdt></span><bdt class="else-block"></bdt>, or by contacting us. We will consider and act upon any request in accordance with applicable data protection laws.</span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text">Want to learn more about what we do with any information we collect?</span></span><a data-custom-class="link" href="#toc"><span style="color: rgb(0, 58, 250); font-size: 15px;"><span data-custom-class="body_text">Review the Privacy Notice in full</span></span></a><span style="font-size: 15px;"><span data-custom-class="body_text">.</span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><br></div><div id="toc" style="line-height: 1.5;"><span style="font-size: 15px;"><span style="color: rgb(127, 127, 127);"><span style="color: rgb(0, 0, 0);"><strong><span data-custom-class="heading_1"><h2>TABLE OF CONTENTS</h2></span></strong></span></span></span></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><a data-custom-class="link" href="#infocollect"><span style="color: rgb(0, 58, 250);">1. WHAT INFORMATION DO WE COLLECT?</span></a></span></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><a data-custom-class="link" href="#infouse"><span style="color: rgb(0, 58, 250);">2. HOW DO WE PROCESS YOUR INFORMATION?<bdt class="block-component"></bdt></span></a></span></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><a data-custom-class="link" href="#legalbases"><span style="color: rgb(0, 58, 250);">3. <span style="font-size: 15px;"><span style="color: rgb(0, 58, 250);">WHAT LEGAL BASES DO WE RELY ON TO PROCESS YOUR PERSONAL INFORMATION?</span></span><bdt class="statement-end-if-in-editor"></bdt></span></a></span></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><span style="color: rgb(0, 58, 250);"><a data-custom-class="link" href="#whoshare">4. WHEN AND WITH WHOM DO WE SHARE YOUR PERSONAL INFORMATION?</a></span><span data-custom-class="body_text"><bdt class="block-component"></bdt></a><span style="color: rgb(127, 127, 127);"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="color: rgb(89, 89, 89);"><bdt class="block-component"></bdt></span></span></span></span></span></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><a data-custom-class="link" href="#cookies"><span style="color: rgb(0, 58, 250);">5. DO WE USE COOKIES AND OTHER TRACKING TECHNOLOGIES?</span></a><span style="color: rgb(127, 127, 127);"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="color: rgb(89, 89, 89);"><bdt class="statement-end-if-in-editor"></bdt></span></span></span></span><bdt class="block-component"></bdt></span></div><div style="line-height: 1.5;"><a data-custom-class="link" href="#ai"><span style="color: rgb (0, 58, 250);">6. DO WE OFFER ARTIFICIAL INTELLIGENCE-BASED PRODUCTS?</span></a><span style="font-size: 15px;"><bdt class="statement-end-if-in-editor"></bdt></span></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><span style="color: rgb(127, 127, 127);"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="color: rgb(89, 89, 89);"><span style="color: rgb(89, 89, 89);"><span style="color: rgb(89, 89, 89);"><bdt class="block-component"></bdt></span></span></span></span></span></span></span></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><a data-custom-class="link" href="#sociallogins"><span style="color: rgb(0, 58, 250);"><span style="color: rgb(0, 58, 250);"><span style="color: rgb(0, 58, 250);">7. HOW DO WE HANDLE YOUR SOCIAL LOGINS?</span></span></span></a><span style="color: rgb(127, 127, 127);"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="color: rgb(89, 89, 89);"><span style="color: rgb(89, 89, 89);"><span style="color: rgb(89, 89, 89);"><bdt class="statement-end-if-in-editor"></bdt></span></span><bdt class="block-component"></bdt></span></span></span></span></span></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><a data-custom-class="link" href="#inforetain"><span style="color: rgb(0, 58, 250);">8. HOW LONG DO WE KEEP YOUR INFORMATION?</span></a><span style="color: rgb(127, 127, 127);"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="color: rgb(89, 89, 89);"><span style="color: rgb(89, 89, 89);"><bdt class="block-component"></bdt><bdt class="block-component"></bdt></span></span></span></span></span></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><span style="color: rgb(0, 58, 250);"><a data-custom-class="link" href="#privacyrights">9. WHAT ARE YOUR PRIVACY RIGHTS?</a></span></span></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><a data-custom-class="link" href="#DNT"><span style="color: rgb(0, 58, 250);">10. CONTROLS FOR DO-NOT-TRACK FEATURES<bdt class="block-component"></bdt></span></a></span></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><a data-custom-class="link" href="#uslaws"><span style="color: rgb(0, 58, 250);">11. DO UNITED STATES RESIDENTS HAVE SPECIFIC PRIVACY RIGHTS?</span></a></span><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></bdt></span></div><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"></bdt><bdt class="block-component"></bdt><bdt class="block-component"></bdt><bdt class="block-component"></bdt><bdt class="block-component"></bdt><bdt class="block-component"></bdt><bdt class="block-component"></bdt><bdt class="block-component"></bdt><bdt class="block-component"></bdt><bdt class="block-component"></span></bdt></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><a data-custom-class="link" href="#policyupdates"><span style="color: rgb(0, 58, 250);">12. DO WE MAKE UPDATES TO THIS NOTICE?</span></a></span></div><div style="line-height: 1.5;"><a data-custom-class="link" href="#contact"><span style="color: rgb(0, 58, 250); font-size: 15px;">13. HOW CAN YOU CONTACT US ABOUT THIS NOTICE?</span></a></div><div style="line-height: 1.5;"><a data-custom-class="link" href="#request"><span style="color: rgb(0, 58, 250);">14. HOW CAN YOU REVIEW, UPDATE, OR DELETE THE DATA WE COLLECT FROM YOU?</span></a></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><br></div><div id="infocollect" style="line-height: 1.5;"><span style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0); font-size: 15px;"><span style="font-size: 15px; color: rgb(0, 0, 0);"><span style="font-size: 15px; color: rgb(0, 0, 0);"><span id="control" style="color: rgb(0, 0, 0);"><strong><span data-custom-class="heading_1"><h2>1. WHAT INFORMATION DO WE COLLECT?</h2></span></strong></span></span></span></span></span><span data-custom-class="heading_2" id="personalinfo" style="color: rgb(0, 0, 0);"><span style="font-size: 15px;"><strong><h3>Personal information you disclose to us</h3></strong></span></span><span style="color: rgb(127, 127, 127);"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span data-custom-class="body_text"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><strong><em>In Short:</em></strong></span></span></span></span><span data-custom-class="body_text"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><strong><em></em></strong><em>We collect personal information that you provide to us.</em></span></span></span></span></span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">We collect personal information that you voluntarily provide to us when you <span style="font-size: 15px;"><bdt class="block-component"></bdt></span>register on the Services,</span><span style="font-size: 15px;"><span data-custom-class="body_text"><span style="font-size: 15px;"><bdt class="statement-end-if-in-editor"></bdt></span></span><span data-custom-class="body_text">express an interest in obtaining information about us or our products and Services, when you participate in activities on the Services, or otherwise when you contact us.</span></span></span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="font-size: 15px;"><bdt class="block-component"></bdt></span></span></span></span></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><strong>Personal Information Provided by You.</strong> The personal information that we collect depends on the context of your interactions with us and the Services, the choices you make, and the products and features you use. The personal information we collect may include the following:<span style="font-size: 15px;"><span data-custom-class="body_text"><bdt class="forloop-component"></bdt></span></span></span></span></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="font-size: 15px;"><span data-custom-class="body_text"><bdt class="question">names</bdt></span></span></span></span></span></li></ul><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="font-size: 15px;"><span data-custom-class="body_text"><bdt class="forloop-component"></bdt></span></span></span></span></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="font-size: 15px;"><span data-custom-class="body_text"><bdt class="question">email addresses</bdt></span></span></span></span></span></li></ul><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="font-size: 15px;"><span data-custom-class="body_text"><bdt class="forloop-component"></bdt></span></span></span></span></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="font-size: 15px;"><span data-custom-class="body_text"><bdt class="question">usernames</bdt></span></span></span></span></span></li></ul><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="font-size: 15px;"><span data-custom-class="body_text"><bdt class="forloop-component"></bdt></span></span></span></span></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="font-size: 15px;"><span data-custom-class="body_text"><bdt class="question">passwords</bdt></span></span></span></span></span></li></ul><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="font-size: 15px;"><span data-custom-class="body_text"><bdt class="forloop-component"></bdt></span><span data-custom-class="body_text"><bdt class="statement-end-if-in-editor"></bdt></span></span></span></span></span></div><div id="sensitiveinfo" style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text"><strong>Sensitive Information.</strong> <bdt class="block-component"></bdt>We do not process sensitive information.</span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text"><bdt class="else-block"></bdt></span></span><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="font-size: 15px;"><span data-custom-class="body_text"><bdt class="block-component"><bdt class="block-component"></bdt></bdt></span></span></span></span></span></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><strong>Social Media Login Data.</strong>We may provide you with the option to register with us using your existing social media account details, like your Facebook, X, or other social media account. If you choose to register in this way, we will collect certain profile information about you from the social media provider, as described in the section called <bdt class="block-component"></bdt>'<bdt class="else-block"></bdt><span style="font-size: 15px;"><span data-custom-class="body_text"><span style="font-size: 15px;"><span style="color: rgb(0, 58, 250);"><a data-custom-class="link" href="#sociallogins">HOW DO WE HANDLE YOUR SOCIAL LOGINS?</a></span></span></span></span><bdt class="block-component"></bdt>'<bdt class="else-block"></bdt> below.</span></span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="font-size: 15px;"><bdt class="statement-end-if-in-editor"><bdt class="statement-end-if-in-editor"></bdt></bdt></span></span></span></span><bdt class="block-component"></span></span></bdt></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">All personal information that you provide to us must be true, complete, and accurate, and you must notify us of any changes to such personal information.</span></span></span></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></span></span><span data-custom-class="heading_2" style="color: rgb(0, 0, 0);"><span style="font-size: 15px;"><strong><h3>Information automatically collected</h3></strong></span></span><span style="color: rgb(127, 127, 127);"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span data-custom-class="body_text"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><strong><em>In Short:</em></strong></span></span></span></span><span data-custom-class="body_text"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><strong><em></em></strong><em>Some information  such as your Internet Protocol (IP) address and/or browser and device characteristics  is collected automatically when you visit our Services.</em></span></span></span></span></span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">We automatically collect certain information when you visit, use, or navigate the Services. This information does not reveal your specific identity (like your name or contact information) but may include device and usage information, such as your IP address, browser and device characteristics, operating system, language preferences, referring URLs, device name, country, location, information about how and when you use our Services, and other technical information. This information is primarily needed to maintain the security and operation of our Services, and for our internal analytics and reporting purposes.</span></span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></span></span></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">Like many businesses, we also collect information through cookies and similar technologies. <bdt class="block-component"></bdt><bdt class="block-component"></bdt></span></span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="statement-end-if-in-editor"><span data-custom-class="body_text"></span></bdt></span><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></span></span></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">The information we collect includes:<bdt class="block-component"></bdt></span></span></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><em>Log and Usage Data.</em> Log and usage data is service-related, diagnostic, usage, and performance information our servers automatically collect when you access or use our Services and which we record in log files. Depending on how you interact with us, this log data may include your IP address, device information, browser type, and settings and information about your activity in the Services<span style="font-size: 15px;"></span>(such as the date/time stamps associated with your usage, pages and files viewed, searches, and other actions you take such as which features you use), device event information (such as system activity, error reports (sometimes called <bdt class="block-component"></bdt>'crash dumps'<bdt class="else-block"></bdt>), and hardware settings).<span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><bdt class="statement-end-if-in-editor"></bdt></span></span></span></span></span></span></span></span></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><em>Device Data.</em> We collect device data such as information about your computer, phone, tablet, or other device you use to access the Services. Depending on the device used, this device data may include information such as your IP address (or proxy server), device and application identification numbers, location, browser type, hardware model, Internet service provider and/or mobile carrier, operating system, and system configuration information.<span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><bdt class="statement-end-if-in-editor"></bdt></span></span></span></span></span></span></span></span></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><em>Location Data.</em> We collect location data such as information about your device's location, which can be either precise or imprecise. How much information we collect depends on the type and settings of the device you use to access the Services. For example, we may use GPS and other technologies to collect geolocation data that tells us your current location (based on your IP address). You can opt out of allowing us to collect this information either by refusing access to the information or by disabling your Location setting on your device. However, if you choose to opt out, you may not be able to use certain aspects of the Services.<span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><bdt class="statement-end-if-in-editor"></bdt></span></span></span></span></span></span></span></span></li></ul><div><bdt class="block-component"><span style="font-size: 15px;"></bdt></bdt><bdt class="statement-end-if-in-editor"></bdt></bdt></span></span></span><bdt class="block-component"><span style="font-size: 15px;"></span></bdt></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><strong><span data-custom-class="heading_2"><h3>Google API</h3></span></strong><span data-custom-class="body_text">Our use of information received from Google APIs will adhere to</span></span><a data-custom-class="link" href="https://developers.google.com/terms/api-services-user-data-policy" rel="noopener noreferrer" target="_blank"><span style="color: rgb(0, 58, 250); font-size: 15px;"><span data-custom-class="body_text">Google API Services User Data Policy</span></span></a><span style="font-size: 15px;"><span data-custom-class="body_text">, including the</span></span><a data-custom-class="link" href="https://developers.google.com/terms/api-services-user-data-policy#limited-use" rel="noopener noreferrer" target="_blank"><span style="color: rgb(0, 58, 250); font-size: 15px;"><span data-custom-class="body_text">Limited Use requirements</span></span></a><span style="font-size: 15px;"><span data-custom-class="body_text">.</span><br></span></div><div><span style="font-size: 15px;"><br></span></div><div style="line-height: 1.5;"><bdt class="statement-end-if-in-editor"><span style="font-size: 15px;"></span></bdt><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span data-custom-class="body_text"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span data-custom-class="body_text"><bdt class="statement-end-if-in-editor"><bdt class="block-component"></bdt></bdt></span></span></span></span></bdt></span></span></span></span></span></span></span></span><span style="font-size: 15px;"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></span></div><div style="line-height: 1.5;"><br></div><div id="infouse" style="line-height: 1.5;"><span style="color: rgb(127, 127, 127);"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span id="control" style="color: rgb(0, 0, 0);"><strong><span data-custom-class="heading_1"><h2>2. HOW DO WE PROCESS YOUR INFORMATION?</h2></span></strong></span></span></span><span data-custom-class="body_text"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><strong><em>In Short:</em></strong><em>We process your information to provide, improve, and administer our Services, communicate with you, for security and fraud prevention, and to comply with law.<bdt class="block-component"></bdt> We process the personal information for the following purposes listed below.<bdt class="statement-end-if-in-editor"></bdt> We may also process your information for other purposes <bdt class="block-component"></bdt>only with your prior explicit<bdt class="else-block"></bdt> consent.</em></span></span></span></span></span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><strong>We process your personal information for a variety of reasons, depending on how you interact with our Services, including:</strong><bdt class="block-component"></bdt></span></span></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><strong>To facilitate account creation and authentication and otherwise manage user accounts.</strong>We may process your information so you can create and log in to your account, as well as keep your account in working order.<span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="statement-end-if-in-editor"></bdt></span></span></span></span></span></span></span></span></span></span></span></span></li></ul><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></li></ul><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></span></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><strong>To deliver and facilitate delivery of services to the user.</strong>We may process your information to provide you with the requested service.<span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="statement-end-if-in-editor"></bdt></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></li></ul><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></span></span></span></span></span></span></span></span></span></span></span></li></ul><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></span></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><strong>To respond to user inquiries/offer support to users.</strong>We may process your information to respond to your inquiries and solve any potential issues you might have with the requested service.<bdt class="statement-end-if-in-editor"></bdt></span></span></span></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"></bdt></span></span></span></span></span></span></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"></bdt></span></span></span></span></span></span></span></span></span></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"></bdt></span></span></span></span></span></span></span></span></span></span></span></span></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt></li></ul><p style="font-size: 15px; line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"></bdt></span></span></span></span></span></span></span></span></span></span></span></li></ul><p style="font-size: 15px; line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"></bdt></span></span></span></span></span></span></span></span></span></span></span></li></ul><p style="font-size: 15px; line-height: 1.5;"><bdt class="block-component"></bdt></span></span></span></span></span></span></span></span></span></span></span></li></ul><p style="font-size: 15px; line-height: 1.5;"><bdt class="block-component"></bdt></p><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><strong>To request feedback.</strong>We may process your information when necessary to request feedback and to contact you about your use of our Services.<span style="color: rgb(89, 89, 89);"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="statement-end-if-in-editor"></bdt></span></span></span></span></span></span></span></span></span></span></span></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></bdt></span></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"></bdt></span></span></span></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"></bdt></span></span></span></li></ul><div style="line-height: 1.5;"><span style="font-size: 15px;"><bdt class="block-component"><span data-custom-class="body_text"></bdt></span></span></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></bdt></span></span></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;"><strong>To protect our Services.</strong> We may process your information as part of our efforts to keep our Services safe and secure, including fraud monitoring and prevention.</span></span><bdt class="statement-end-if-in-editor"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;"><strong>To identify usage trends.</strong> We may process information about how you use our Services to better understand how they are being used so we can improve them.</span></span><bdt class="statement-end-if-in-editor"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></bdt></span></span></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></bdt></span></span></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></bdt></span></span></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;"><strong>To save or protect an individual's vital interest.</strong> We may process your information when necessary to save or protect an individuals vital interest, such as to prevent harm.</span></span><bdt class="statement-end-if-in-editor"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></bdt></span></span><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt></div><div style="line-height: 1.5;"><br></div><div id="legalbases" style="line-height: 1.5;"><strong><span style="font-size: 15px;"><span data-custom-class="heading_1"><h2>3. WHAT LEGAL BASES DO WE RELY ON TO PROCESS YOUR INFORMATION?</h2></span></span></strong><em><span style="font-size: 15px;"><span data-custom-class="body_text"><strong>In Short:</strong>We only process your personal information when we believe it is necessary and we have a valid legal reason (i.e.<bdt class="block-component"></bdt> legal basis) to do so under applicable law, like with your consent, to comply with laws, to provide you with services to enter into or <bdt class="block-component"></bdt>fulfil<bdt class="else-block"></bdt> our contractual obligations, to protect your rights, or to <bdt class="block-component"></bdt>fulfil<bdt class="else-block"></bdt> our legitimate business interests.</span></span></em></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><em><span style="font-size: 15px;"><span data-custom-class="body_text"><strong><u>If you are located in the EU or UK, this section applies to you.</u></strong></span></span></em></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text"><bdt class="statement-end-if-in-editor"></bdt></span></span></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text">The General Data Protection Regulation (GDPR) and UK GDPR require us to explain the valid legal bases we rely on in order to process your personal information. As such, we may rely on the following legal bases to process your personal information:</span></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text"><strong>Consent.</strong>We may process your information if you have given us permission (i.e.<bdt class="block-component"></bdt> consent) to use your personal information for a specific purpose. You can withdraw your consent at any time. Learn more about</span></span><a data-custom-class="link" href="#withdrawconsent"><span style="color: rgb(0, 58, 250); font-size: 15px;"><span data-custom-class="body_text">withdrawing your consent</span></span></a><span data-custom-class="body_text">.</span></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;"><strong>Performance of a Contract.</strong> We may process your personal information when we believe it is necessary to <bdt class="block-component"></bdt>fulfil<bdt class="else-block"></bdt> our contractual obligations to you, including providing our Services or at your request prior to entering into a contract with you.</span></span><bdt class="statement-end-if-in-editor"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;"><strong>Legitimate Interests.</strong> We may process your information when we believe it is reasonably necessary to achieve our legitimate business interests and those interests do not outweigh your interests and fundamental rights and freedoms. For example, we may process your personal information for some of the purposes described in order to:</span></span></li></ul><div style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;"><bdt class="block-component"></bdt></span></span></li></ul><div style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;"><bdt class="block-component"></bdt></span></span></li></ul><div style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;"><bdt class="block-component"></bdt></span></span></div><ul style="margin-left: 40px;"><li data-custom-class="body_text" style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;"><bdt class="block-component"></bdt>Analyse<bdt class="else-block"></bdt> how our Services are used so we can improve them to engage and retain users<bdt class="statement-end-if-in-editor"></bdt></span></span></li></ul><div style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;"><bdt class="block-component"></bdt></span></span></li></ul><div style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;"><bdt class="block-component"></bdt></span></span></div><ul style="margin-left: 40px;"><li data-custom-class="body_text" style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;">Diagnose problems and/or prevent fraudulent activities<bdt class="statement-end-if-in-editor"></bdt></span></span></li></ul><div style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;"><bdt class="block-component"></bdt></span></span></div><ul style="margin-left: 40px;"><li data-custom-class="body_text" style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;">Understand how our users use our products and services so we can improve user experience<bdt class="statement-end-if-in-editor"></bdt></span></span></li></ul><div style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;"><bdt class="block-component"></bdt></span></span><bdt class="statement-end-if-in-editor"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;"><strong>Legal Obligations.</strong> We may process your information where we believe it is necessary for compliance with our legal obligations, such as to cooperate with a law enforcement body or regulatory agency, exercise or defend our legal rights, or disclose your information as evidence in litigation in which we are involved.<bdt class="statement-end-if-in-editor"></bdt><br></span></span></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;"><strong>Vital Interests.</strong> We may process your information where we believe it is necessary to protect your vital interests or the vital interests of a third party, such as situations involving potential threats to the safety of any person.</span></span><bdt class="statement-end-if-in-editor"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt><span data-custom-class="body_text"><span style="font-size: 15px;"><bdt class="block-component"><bdt class="block-component"></bdt></bdt></span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;"><strong><u><em>If you are located in Canada, this section applies to you.</em></u></strong></span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;"><bdt class="statement-end-if-in-editor"></bdt></span></span></div><div style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;">We may process your information if you have given us specific permission (i.e.<bdt class="block-component"></bdt> express consent) to use your personal information for a specific purpose, or in situations where your permission can be inferred (i.e.<bdt class="block-component"></bdt> implied consent). You can</span></span><a data-custom-class="link" href="#withdrawconsent"><span data-custom-class="body_text"><span style="color: rgb(0, 58, 250); font-size: 15px;">withdraw your consent</span></span></a><span data-custom-class="body_text"><span style="font-size: 15px;">at any time.</span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;">In some exceptional cases, we may be legally permitted under applicable law to process your information without your consent, including, for example:</span></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;">If collection is clearly in the interests of an individual and consent cannot be obtained in a timely way</span></span></li></ul><div style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;"><bdt class="block-component"></bdt></span></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;">For investigations and fraud detection and prevention<bdt class="statement-end-if-in-editor"></bdt></span></span></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;">For business transactions provided certain conditions are met</span></span><bdt class="statement-end-if-in-editor"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;">If it is contained in a witness statement and the collection is necessary to assess, process, or settle an insurance claim</span></span><bdt class="statement-end-if-in-editor"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;">For identifying injured, ill, or deceased persons and communicating with next of kin</span></span><bdt class="statement-end-if-in-editor"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt></li></ul><div style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;"><bdt class="block-component"></bdt></span></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;">If we have reasonable grounds to believe an individual has been, is, or may be victim of financial abuse<bdt class="statement-end-if-in-editor"></bdt></span></span></li></ul><div style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;"><bdt class="block-component"></bdt></span></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;">If it is reasonable to expect collection and use with consent would compromise the availability or the accuracy of the information and the collection is reasonable for purposes related to investigating a breach of an agreement or a contravention of the laws of Canada or a province<bdt class="statement-end-if-in-editor"></bdt></span></span></li></ul><div style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;"><bdt class="block-component"></bdt></span></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;">If disclosure is required to comply with a subpoena, warrant, court order, or rules of the court relating to the production of records<bdt class="statement-end-if-in-editor"></bdt></span></span></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text">If it was produced by an individual in the course of their employment, business, or profession and the collection is consistent with the purposes for which the information was produced<bdt class="statement-end-if-in-editor"></bdt></span></span></li></ul><div style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text">If the collection is solely for journalistic, artistic, or literary purposes<bdt class="statement-end-if-in-editor"></bdt></span></span></li></ul><div style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text">If the information is publicly available and is specified by the regulations</span><bdt class="statement-end-if-in-editor"><span data-custom-class="body_text"></span></bdt></span></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"></span></bdt></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px;">We may disclose de-identified information for approved research or statistics projects, subject to ethics oversight and confidentiality commitments<bdt class="statement-end-if-in-editor"></bdt></span></li></ul><div style="line-height: 1.5;"><bdt class="statement-end-if-in-editor"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt><bdt class="statement-end-if-in-editor"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt></div><div style="line-height: 1.5;"><br></div><div id="whoshare" style="line-height: 1.5;"><span style="color: rgb(127, 127, 127);"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span id="control" style="color: rgb(0, 0, 0);"><strong><span data-custom-class="heading_1"><h2>4. WHEN AND WITH WHOM DO WE SHARE YOUR PERSONAL INFORMATION?</h2></span></strong></span></span></span></span></span><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><strong><em>In Short:</em></strong><em>We may share information in specific situations described in this section and/or with the following <bdt class="block-component"></bdt>categories of <bdt class="statement-end-if-in-editor"></bdt>third parties.</em></span></span></span></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text"><strong>Vendors, Consultants, and Other Third-Party Service Providers.</strong> We may share your data with third-party vendors, service providers, contractors, or agents (<bdt class="block-component"></bdt>'<strong>third parties</strong>'<bdt class="else-block"></bdt>) who perform services for us or on our behalf and require access to such information to do that work. <bdt class="block-component"></bdt>We have contracts in place with our third parties, which are designed to help safeguard your personal information. This means that they cannot do anything with your personal information unless we have instructed them to do it. They will also not share your personal information with any <bdt class="block-component"></bdt>organisation<bdt class="else-block"></bdt> apart from us. They also commit to pr</span><span data-custom-class="body_text">otect the data they hold on our behalf and to retain it for the period we instruct. <bdt class="statement-end-if-in-editor"></bdt></span><bdt class="block-component"></bdt></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text">The <bdt class="block-component"></bdt>categories of <bdt class="statement-end-if-in-editor"></bdt>third parties we may share personal information with are as follows:</span></span><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"></bdt><bdt class="forloop-component"></bdt></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="question">Website Hosting Service Providers</bdt></span></span></span></li></ul><div><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><bdt class="block-component"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="forloop-component"></bdt></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="question">User Account Registration & Authentication Services</bdt></span></span></span></li></ul><div><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><bdt class="block-component"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="forloop-component"></bdt></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="question">Data Analytics Services</bdt></span></span></span></li></ul><div><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><bdt class="block-component"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="forloop-component"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><bdt class="statement-end-if-in-editor"></bdt></span></span></span></span></span></span></span></span></span></span></span></span></bdt></span></span></span></bdt></span></span></span></span></span></span><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></span></span></span></span></span></span></span><bdt class="block-component"></bdt></span></span></span></span></span></span></span></span><span style="font-size: 15px;"><bdt class="block-component"></bdt></span><bdt class="block-component"></bdt></span></span></span></span></span></span></span></span><bdt class="block-component"></bdt></span></span></span></span></span></span></span></span><bdt class="block-component"></bdt></span></span></span></span></span></span></span></span><bdt class="block-component"></bdt></span></span></span></span></span></span></span></span><bdt class="block-component"></bdt></span></span></span></span></span></span></span></span><bdt class="block-component"></bdt></span></span></span></span></span></span></span></span><bdt class="block-component"></bdt></span></span></span></span></span></span></span></span><bdt class="block-component"></bdt></span></span></span></span></span></span></span></span><bdt class="block-component"></bdt></span></span></span></span></span></span></span></span><bdt class="block-component"></bdt></span></span></span></span></span></span></span></span><bdt class="block-component"></bdt></span></span></span></span></span></span></span></span><bdt class="block-component"></bdt></span></span></span></span></span></span></span></span><bdt class="block-component"></bdt></span></span></span></span></span></span></span></span><bdt class="block-component"></bdt></span></span></span></span></span></span></span></span><bdt class="block-component"></bdt></span></span></span></span></span></span></span></span><span data-custom-class="body_text"></span><span data-custom-class="body_text"></span><span data-custom-class="body_text"></span><span data-custom-class="body_text"></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text">We <bdt class="block-component"></bdt>also <bdt class="statement-end-if-in-editor"></bdt>may need to share your personal information in the following situations:</span></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text"><strong>Business Transfers.</strong> We may share or transfer your information in connection with, or during negotiations of, any merger, sale of company assets, financing, or acquisition of all or a portion of our business to another company.</span></span></li></ul><div style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></span></li></ul><div style="line-height: 1.5;"><span style="font-size: 15px;"><bdt class="block-component"><span data-custom-class="body_text"></span></bdt></span></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></bdt></span></span></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt><span style="color: rgb(89, 89, 89); font-size: 15px;"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><bdt class="block-component"><span data-custom-class="heading_1"><bdt class="block-component"></bdt></span></bdt></span></span></span></span></span></div><div style="line-height: 1.5;"><br></div><div id="cookies" style="line-height: 1.5;"><span style="color: rgb(127, 127, 127);"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span id="control" style="color: rgb(0, 0, 0);"><strong><span data-custom-class="heading_1"><h2>5. DO WE USE COOKIES AND OTHER TRACKING TECHNOLOGIES?</h2></span></strong></span></span></span></span></span><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><strong><em>In Short:</em></strong><em>We may use cookies and other tracking technologies to collect and store your information.</em></span></span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">We may use cookies and similar tracking technologies (like web beacons and pixels) to gather information when you interact with our Services. Some online tracking technologies help us maintain the security of our Services<bdt class="block-component"></bdt> and your account<bdt class="statement-end-if-in-editor"></bdt>, prevent crashes, fix bugs, save your preferences, and assist with basic site functions.</span></span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">We also permit third parties and service providers to use online tracking technologies on our Services for analytics and advertising, including to help manage and display advertisements, to tailor advertisements to your interests, or to send abandoned shopping cart reminders (depending on your communication preferences). The third parties and service providers use their technology to provide advertising about products and services tailored to your interests which may appear either on our Services or on other websites.</span></span></span><bdt class="block-component"><span style="font-size: 15px;"></span></bdt></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><br></span></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text">To the extent these online tracking technologies are deemed to be a <bdt class="block-component"></bdt>'sale'/'sharing'<bdt class="else-block"></bdt> (which includes targeted advertising, as defined under the applicable laws) under applicable US state laws, you can opt out of these online tracking technologies by submitting a request as described below under section <bdt class="block-component"></bdt>'<bdt class="else-block"></bdt></span></span><span data-custom-class="body_text"><a data-custom-class="link" href="#uslaws"><span style="color: rgb(0, 58, 250); font-size: 15px;">DO UNITED STATES RESIDENTS HAVE SPECIFIC PRIVACY RIGHTS?</span></a></span><span style="font-size: 15px;"><span data-custom-class="body_text"><bdt class="block-component"></bdt>'<bdt class="else-block"></bdt></span><bdt class="statement-end-if-in-editor"></bdt></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">Specific information about how we use such technologies and how you can refuse certain cookies is set out in our Cookie Notice<span style="color: rgb(89, 89, 89); font-size: 15px;"><span data-custom-class="body_text"><bdt class="block-component"></bdt>.</span></span></span></span></span><bdt class="block-component"><span style="font-size: 15px;"></span></bdt><span style="font-size: 15px;"><strong><span data-custom-class="heading_2"><h3>Google Analytics</h3></span></strong> <span data-custom-class="body_text">We may share your information with Google Analytics to track and <bdt class="block-component"></bdt>analyse<bdt class="else-block"></bdt> the use of the Services.<bdt class="block-component"></bdt> To opt out of being tracked by Google Analytics across the Services, visit <span style="color: rgb(0, 58, 250);"><a data-custom-class="link" href="https://tools.google.com/dlpage/gaoptout" rel="noopener noreferrer" target="_blank">https://tools.google.com/dlpage/gaoptout</a>.</span><bdt class="block-component"></bdt> For more information on the privacy practices of Google, please visit the <span style="color: rgb(0, 58, 250);"><a data-custom-class="link" href="https://policies.google.com/privacy" rel="noopener noreferrer" target="_blank">Google Privacy & Terms page</a></span>.</span></span><bdt class="statement-end-if-in-editor"><span style="font-size: 15px;"></span></bdt><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="statement-end-if-in-editor"></bdt></span></span></span></span></span></span></span></span></span></span><span style="font-size: 15px;"><bdt class="block-component"></bdt></span></div><div style="line-height: 1.5;"><br></div><div id="ai" style="line-height: 1.5;"><span style="font-size: 15px;"><strong><span data-custom-class="heading_1"><h2>6. DO WE OFFER ARTIFICIAL INTELLIGENCE-BASED PRODUCTS?</h2></span></strong><strong><em><span data-custom-class="body_text">In Short:</span></em></strong><em><span data-custom-class="body_text">We offer products, features, or tools powered by artificial intelligence, machine learning, or similar technologies.</span></em></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text">As part of our Services, we offer products, features, or tools powered by artificial intelligence, machine learning, or similar technologies (collectively, <bdt class="block-component"></bdt>'<bdt class="else-block"></bdt>AI Products<bdt class="block-component"></bdt>'<bdt class="else-block"></bdt>). These tools are designed to enhance your experience and provide you with innovative solutions. The terms in this Privacy Notice govern your use of the AI Products within our Services.</span><bdt class="block-component"></bdt></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><strong><span data-custom-class="body_text">Use of AI Technologies</span></strong></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text">We provide the AI Products through third-party service providers (<bdt class="block-component"></bdt>'<bdt class="else-block"></bdt>AI Service Providers<bdt class="block-component"></bdt>'<bdt class="else-block"></bdt>), including <bdt class="forloop-component"></bdt><bdt class="block-component"></bdt><bdt class="question">Google Cloud AI</bdt><bdt class="block-component"></bdt><bdt class="forloop-component"></bdt>. As outlined in this Privacy Notice, your input, output, and personal information will be shared with and processed by these AI Service Providers to enable your use of our AI Products for purposes outlined in <bdt class="block-component"></bdt>'<bdt class="else-block"></bdt><bdt class="block-component"></bdt></span></span><span data-custom-class="body_text"><a data-custom-class="link" href="#legalbases"><span style="color: rgb(0, 58, 250); font-size: 15px;">WHAT LEGAL BASES DO WE RELY ON TO PROCESS YOUR PERSONAL INFORMATION?</span></a><span style="font-size: 15px;"><bdt class="else-block"></bdt><bdt class="block-component"></bdt>'<bdt class="else-block"></bdt> You must not use the AI Products in any way that violates the terms or policies of any AI Service Provider.</span><bdt class="statement-end-if-in-editor"></bdt></span></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><br></span></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><strong><span data-custom-class="body_text">Our AI Products</span></strong></span></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><br></span></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text">Our AI Products are designed for the following functions:</span><bdt class="forloop-component"></bdt></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px;"><bdt class="question"><span data-custom-class="body_text">AI automation</span></bdt></span></li></ul><div><span style="font-size: 15px;"><bdt class="forloop-component"></bdt><br></span></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><strong><span data-custom-class="body_text">How We Process Your Data Using AI</span></strong></span></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><br></span></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text">All personal information processed using our AI Products is handled in line with our Privacy Notice and our agreement with third parties. This ensures high security and safeguards your personal information throughout the process, giving you peace of mind about your data's safety.</span><bdt class="block-component"></bdt><bdt class="statement-end-if-in-editor"></bdt></span><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></span></span></span></span></span></span></span></span></span></span></div><div style="line-height: 1.5;"><br></div><div id="sociallogins" style="line-height: 1.5;"><span style="color: rgb(127, 127, 127);"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span id="control" style="color: rgb(0, 0, 0);"><strong><span data-custom-class="heading_1"><h2>7. HOW DO WE HANDLE YOUR SOCIAL LOGINS?</h2></span></strong></span></span></span></span></span><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><strong><em>In Short:</em></strong><em>If you choose to register or log in to our Services using a social media account, we may have access to certain information about you.</em></span></span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">Our Services offer you the ability to register and log in using your third-party social media account details (like your Facebook or X logins). Where you choose to do this, we will receive certain profile information about you from your social media provider. The profile information we receive may vary depending on the social media provider concerned, but will often include your name, email address, friends list, and profile picture, as well as other information you choose to make public on such a social media platform.<span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></span></span></span></span></span></span></span></span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">We will use the information we receive only for the purposes that are described in this Privacy Notice or that are otherwise made clear to you on the relevant Services. Please note that we do not control, and are not responsible for, other uses of your personal information by your third-party social media provider. We recommend that you review their privacy notice to understand how they collect, use, and share your personal information, and how you can set your privacy preferences on their sites and apps.<span style="color: rgb(89, 89, 89); font-size: 15px;"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="statement-end-if-in-editor"></bdt></span><bdt class="block-component"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></span></span></span></span></span></span></span></span></span></span></span></span></div><div style="line-height: 1.5;"><br></div><div id="inforetain" style="line-height: 1.5;"><span style="color: rgb(127, 127, 127);"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span id="control" style="color: rgb(0, 0, 0);"><strong><span data-custom-class="heading_1"><h2>8. HOW LONG DO WE KEEP YOUR INFORMATION?</h2></span></strong></span></span></span></span></span><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><strong><em>In Short:</em></strong><em>We keep your information for as long as necessary to <bdt class="block-component"></bdt>fulfil<bdt class="else-block"></bdt> the purposes outlined in this Privacy Notice unless otherwise required by law.</em></span></span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">We will only keep your personal information for as long as it is necessary for the purposes set out in this Privacy Notice, unless a longer retention period is required or permitted by law (such as tax, accounting, or other legal requirements).<bdt class="block-component"></bdt> No purpose in this notice will require us keeping your personal information for longer than <span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></span></span><bdt class="block-component"></bdt>the period of time in which users have an account with us<bdt class="block-component"></bdt><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="else-block"></bdt></span></span></span>.</span></span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">When we have no ongoing legitimate business need to process your personal information, we will either delete or <bdt class="block-component"></bdt>anonymise<bdt class="else-block"></bdt> such information, or, if this is not possible (for example, because your personal information has been stored in backup archives), then we will securely store your personal information and isolate it from any further processing until deletion is possible.<span style="color: rgb(89, 89, 89);"><bdt class="block-component"></bdt></span><span style="color: rgb(89, 89, 89); font-size: 15px;"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></span></span></span></span></span></div><div style="line-height: 1.5;"><br></div><div id="privacyrights" style="line-height: 1.5;"><span style="color: rgb(127, 127, 127);"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span id="control" style="color: rgb(0, 0, 0);"><strong><span data-custom-class="heading_1"><h2>9. WHAT ARE YOUR PRIVACY RIGHTS?</h2></span></strong></span></span></span></span></span><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><strong><em>In Short:</em></strong><em><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span data-custom-class="body_text"><em><bdt class="block-component"></bdt></em></span></span></span><bdt class="block-component"></bdt>Depending on your state of residence in the US or in <bdt class="else-block"></bdt>some regions, such as <bdt class="block-component"></bdt>the European Economic Area (EEA), United Kingdom (UK), Switzerland, and Canada<bdt class="block-component"></bdt>, you have rights that allow you greater access to and control over your personal information.<span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span data-custom-class="body_text"><em><bdt class="statement-end-if-in-editor"></bdt></em></span></span></span>You may review, change, or terminate your account at any time, depending on your country, province, or state of residence.</em><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><bdt class="block-component"></bdt></span></span></span></span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">In some regions (like <bdt class="block-component"></bdt>the EEA, UK, Switzerland, and Canada<bdt class="block-component"></bdt>), you have certain rights under applicable data protection laws. These may include the right (i) to request access and obtain a copy of your personal information, (ii) to request rectification or erasure; (iii) to restrict the processing of your personal information; (iv) if applicable, to data portability; and (v) not to be subject to automated decision-making.<bdt class="block-component"></bdt> If a decision that produces legal or similarly significant effects is made solely by automated means, we will inform you, explain the main factors, and offer a simple way to request human review.<bdt class="statement-end-if-in-editor"></bdt> In certain circumstances, you may also have the right to object to the processing of your personal information. You can make such a request by contacting us by using the contact details provided in the section <bdt class="block-component"></bdt>'<bdt class="else-block"></bdt></span></span></span><a data-custom-class="link" href="#contact"><span style="font-size: 15px; color: rgb(0, 58, 250);"><span style="font-size: 15px; color: rgb(0, 58, 250);"><span data-custom-class="body_text">HOW CAN YOU CONTACT US ABOUT THIS NOTICE?</span></span></span></a><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"></bdt>'<bdt class="else-block"></bdt> below.</span></span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">We will consider and act upon any request in accordance with applicable data protection laws.<bdt class="block-component"></bdt></span></span></span></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"></span></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">If you are located in the EEA or UK and you believe we are unlawfully processing your personal information, you also have the right to complain to your <span style="font-size: 15px;"><span style="color: rgb(0, 58, 250);"><span data-custom-class="body_text"><span style="color: rgb(0, 58, 250);"><span data-custom-class="body_text"><a data-custom-class="link" href="https://ec.europa.eu/justice/data-protection/bodies/authorities/index_en.htm" rel="noopener noreferrer" target="_blank"><span style="font-size: 15px;">Member State data protection authority</span></a></span></span></span></span></span> or</span></span></span><a data-custom-class="link" href="https://ico.org.uk/make-a-complaint/data-protection-complaints/data-protection-complaints/" rel="noopener noreferrer" target="_blank"><span style="font-size: 15px; color: rgb(0, 58, 250);"><span style="font-size: 15px; color: rgb(0, 58, 250);"><span data-custom-class="body_text">UK data protection authority</span></span></span></a><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">.</span></span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">If you are located in Switzerland, you may contact the <span style="font-size: 15px;"><span style="color: rgb(0, 58, 250);"><span data-custom-class="body_text"><span style="color: rgb(0, 58, 250);"><span data-custom-class="body_text"><span style="color: rgb(0, 58, 250); font-size: 15px;"><a data-custom-class="link" href="https://www.edoeb.admin.ch/edoeb/en/home.html" rel="noopener noreferrer" target="_blank">Federal Data Protection and Information Commissioner</a></span></span></span></span></span></span>.</span></span></span></div><div style="line-height: 1.5;"><br></div><div id="withdrawconsent" style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><strong><u>Withdrawing your consent:</u></strong> If we are relying on your consent to process your personal information,<bdt class="block-component"></bdt> which may be express and/or implied consent depending on the applicable law,<bdt class="statement-end-if-in-editor"></bdt> you have the right to withdraw your consent at any time. You can withdraw your consent at any time by contacting us by using the contact details provided in the section <bdt class="block-component"></bdt>'<bdt class="else-block"></bdt></span></span></span><a data-custom-class="link" href="#contact"><span style="font-size: 15px; color: rgb(0, 58, 250);"><span style="font-size: 15px; color: rgb(0, 58, 250);"><span data-custom-class="body_text">HOW CAN YOU CONTACT US ABOUT THIS NOTICE?</span></span></span></a><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"></bdt>'<bdt class="else-block"></bdt> below<bdt class="block-component"></bdt>.</span></span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text">However, please note that this will not affect the lawfulness of the processing before its withdrawal nor,<bdt class="block-component"></bdt> when applicable law allows,<bdt class="statement-end-if-in-editor"></bdt> will it affect the processing of your personal information conducted in reliance on lawful processing grounds other than consent.<bdt class="block-component"></bdt></span></span><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt><span style="font-size: 15px;"><span data-custom-class="heading_2"><strong><h3>Account Information</h3></strong></span></span><span data-custom-class="body_text"><span style="font-size: 15px;">If you would at any time like to review or change the information in your account or terminate your account, you can:<bdt class="forloop-component"></bdt></span></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;"><bdt class="question">Contact us using the contact information provided.</bdt></span></span></li></ul><div style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;"><bdt class="forloop-component"></bdt></span></span></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text">Upon your request to terminate your account, we will deactivate or delete your account and information from our active databases. However, we may retain some information in our files to prevent fraud, troubleshoot problems, assist with any investigations, enforce our legal terms and/or comply with applicable legal requirements.</span></span><bdt class="statement-end-if-in-editor"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><bdt class="block-component"></bdt></span></span></span></span></span></span></span></span></span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><strong><u>Cookies and similar technologies:</u></strong> Most Web browsers are set to accept cookies by default. If you prefer, you can usually choose to set your browser to remove cookies and to reject cookies. If you choose to remove cookies or reject cookies, this could affect certain features or services of our Services. <bdt class="block-component"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"></bdt><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><bdt class="statement-end-if-in-editor"></bdt></span></span></span></span></span></span></span></span></span></span></span></span><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span data-custom-class="body_text"><span style="font-size: 15px;">If you have questions or comments about your privacy rights, you may email us at <bdt class="question noTranslate"><a target="_blank" data-custom-class="link" href="mailto:secret-badge-sulk@duck.com">secret-badge-sulk@duck.com</a></bdt>.</span></span><bdt class="statement-end-if-in-editor"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt></div><div style="line-height: 1.5;"><br></div><div id="DNT" style="line-height: 1.5;"><span style="color: rgb(127, 127, 127);"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span id="control" style="color: rgb(0, 0, 0);"><strong><span data-custom-class="heading_1"><h2>10. CONTROLS FOR DO-NOT-TRACK FEATURES</h2></span></strong></span></span></span></span></span><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">Most web browsers and some mobile operating systems and mobile applications include a Do-Not-Track (<bdt class="block-component"></bdt>'DNT'<bdt class="else-block"></bdt>) feature or setting you can activate to signal your privacy preference not to have data about your online browsing activities monitored and collected. At this stage, no uniform technology standard for <bdt class="block-component"></bdt>recognising<bdt class="else-block"></bdt> and implementing DNT signals has been <bdt class="block-component"></bdt>finalised<bdt class="else-block"></bdt>. As such, we do not currently respond to DNT browser signals or any other mechanism that automatically communicates your choice not to be tracked online. If a standard for online tracking is adopted that we must follow in the future, we will inform you about that practice in a revised version of this Privacy Notice.</span></span></span><bdt class="block-component"><span style="font-size: 15px;"></span></bdt></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><br></span></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text">California law requires us to let you know how we respond to web browser DNT signals. Because there currently is not an industry or legal standard for <bdt class="block-component"></bdt>recognising<bdt class="else-block"></bdt> or <bdt class="block-component"></bdt>honouring<bdt class="else-block"></bdt> DNT signals, we do not respond to them at this time.</span></span><bdt class="statement-end-if-in-editor"><span style="font-size: 15px;"></span></bdt></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></span></span></div><div style="line-height: 1.5;"><br></div><div id="uslaws" style="line-height: 1.5;"><span style="color: rgb(127, 127, 127);"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span id="control" style="color: rgb(0, 0, 0);"><strong><span data-custom-class="heading_1"><h2>11. DO UNITED STATES RESIDENTS HAVE SPECIFIC PRIVACY RIGHTS?</h2></span></strong></span></span></span></span></span><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><strong><em>In Short:</em></strong><em>If you are a resident of<bdt class="block-component"></bdt> California, Colorado, Connecticut, Delaware, Florida, Indiana, Iowa, Kentucky, Maryland, Minnesota, Montana, Nebraska, New Hampshire, New Jersey, Oregon, Rhode Island, Tennessee, Texas, Utah, or Virginia<bdt class="else-block"></bdt>, you may have the right to request access to and receive details about the personal information we maintain about you and how we have processed it, correct inaccuracies, get a copy of, or delete your personal information. You may also have the right to withdraw your consent to our processing of your personal information. These rights may be limited in some circumstances by applicable law. More information is provided below.</em></span><strong><span data-custom-class="heading_2"><h3>Categories of Personal Information We Collect</h3></span></strong><span data-custom-class="body_text">The table below shows the categories of personal information we have collected in the past twelve (12) months. The table includes illustrative examples of each category and does not reflect the personal information we collect from you. For a comprehensive inventory of all personal information we process, please refer to the section <bdt class="block-component"></bdt>'<bdt class="else-block"></bdt></span></span></span><a data-custom-class="link" href="#infocollect"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(0, 58, 250);"><span data-custom-class="body_text"><span data-custom-class="link">WHAT INFORMATION DO WE COLLECT?</span></span></span></span></a><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"></bdt>'<bdt class="else-block"></bdt></span></span></span></div><div style="line-height: 1.5;"><br></div><table style="width: 100%;"><thead><tr><th style="width: 33.8274%; border-left: 1px solid black; border-right: 1px solid black; border-top: 1px solid black; text-align: left;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><strong>Category</strong></span></span></span></th><th style="width: 51.4385%; border-top: 1px solid black; border-right: 1px solid black; text-align: left;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><strong>Examples</strong></span></span></span></th><th style="width: 14.9084%; border-right: 1px solid black; border-top: 1px solid black; text-align: center; text-align: left;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><strong>Collected</strong></span></span></span></th></tr></thead><tbody><tr><td style="width: 33.8274%; border-left: 1px solid black; border-right: 1px solid black; border-top: 1px solid black;"><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">A. Identifiers</span></span></span></div></td><td style="width: 51.4385%; border-top: 1px solid black; border-right: 1px solid black;"><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">Contact details, such as real name, alias, postal address, telephone or mobile contact number, unique personal identifier, online identifier, Internet Protocol address, email address, and account name</span></span></span></div></td><td style="width: 14.9084%; text-align: center; vertical-align: middle; border-right: 1px solid black; border-top: 1px solid black;"><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"><bdt class="block-component"><bdt class="forloop-component"></bdt>YES<bdt class="forloop-component"></bdt><bdt class="block-component"></bdt><bdt class="statement-end-if-in-editor"></bdt></bdt></bdt></bdt></span><span data-custom-class="body_text"><bdt class="statement-end-if-in-editor"></bdt></span></span></span></div><div style="line-height: 1.5;"><br></div></td></tr></tbody></table><div style="line-height: 1.5;"><bdt class="block-component"></bdt></div><table style="width: 100%;"><tbody><tr><td style="width: 33.8274%; border-left: 1px solid black; border-right: 1px solid black; border-top: 1px solid black;"><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">B. Personal information as defined in the California Customer Records statute</span></span></span></div></td><td style="width: 51.4385%; border-right: 1px solid black; border-top: 1px solid black;"><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">Name, contact information, education, employment, employment history, and financial information</span></span></span></div></td><td style="width: 14.9084%; text-align: center; border-right: 1px solid black; border-top: 1px solid black;"><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="forloop-component"><bdt class="block-component"><bdt class="forloop-component"></bdt><bdt class="block-component">NO</bdt></bdt></bdt></span></span></span></div><div style="line-height: 1.5;"><br></div></td></tr></tbody></table><div style="line-height: 1.5;"><bdt class="block-component"></bdt></div><table style="width: 100%;"><tbody><tr><td style="width: 33.8274%; border-left: 1px solid black; border-right: 1px solid black; border-top: 1px solid black;"><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"></bdt>C<bdt class="else-block"></bdt>. Protected classification characteristics under state or federal law</span></span></span></div></td><td style="width: 51.4385%; border-right: 1px solid black; border-top: 1px solid black;"><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">Gender, age, date of birth, race and ethnicity, national origin, marital status, and other demographic data</span></span></span></div></td><td style="width: 14.9084%; text-align: center; border-right: 1px solid black; border-top: 1px solid black;"><div style="line-height: 1.5;"><br></div><div data-custom-class="body_text" style="line-height: 1.5;"><bdt class="forloop-component"><span data-custom-class="body_text"><bdt class="block-component"></bdt></bdt><bdt class="block-component"></bdt><bdt class="block-component"></bdt>NO</span><bdt class="statement-end-if-in-editor"><span data-custom-class="body_text"></span></bdt></div><div style="line-height: 1.5;"><br></div></td></tr><tr><td style="width: 33.8274%; border-left: 1px solid black; border-right: 1px solid black; border-top: 1px solid black;"><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"></bdt>D<bdt class="else-block"></bdt>. Commercial information</span></span></span></div></td><td style="width: 51.4385%; border-right: 1px solid black; border-top: 1px solid black;"><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">Transaction information, purchase history, financial details, and payment information</span></span></span></div></td><td style="width: 14.9084%; text-align: center; border-right: 1px solid black; border-top: 1px solid black;"><div style="line-height: 1.5;"><br></div><div data-custom-class="body_text" style="line-height: 1.5;"><bdt class="forloop-component"><span data-custom-class="body_text"><bdt class="block-component"></bdt></bdt></bdt><bdt class="block-component"></bdt><bdt class="block-component"></bdt>NO</span><bdt class="statement-end-if-in-editor"><span data-custom-class="body_text"></span></bdt></div><div style="line-height: 1.5;"><br></div></td></tr><tr><td style="width: 33.8274%; border-left: 1px solid black; border-right: 1px solid black; border-top: 1px solid black;"><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"></bdt>E<bdt class="else-block"></bdt>. Biometric information</span></span></span></div></td><td style="width: 51.4385%; border-right: 1px solid black; border-top: 1px solid black;"><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">Fingerprints and voiceprints</span></span></span></div></td><td style="width: 14.9084%; text-align: center; border-right: 1px solid black; border-top: 1px solid black;"><div style="line-height: 1.5;"><br></div><div data-custom-class="body_text" style="line-height: 1.5;"><bdt class="forloop-component"><span data-custom-class="body_text"><bdt class="block-component"></bdt></bdt></bdt></bdt><bdt class="block-component"></bdt><bdt class="block-component"></bdt>NO</span><bdt class="statement-end-if-in-editor"><span data-custom-class="body_text"></span></bdt></div><div style="line-height: 1.5;"><br></div></td></tr><tr><td style="width: 33.8274%; border-left: 1px solid black; border-right: 1px solid black; border-top: 1px solid black;"><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"></bdt>F<bdt class="else-block"></bdt>. Internet or other similar network activity</span></span></span></div></td><td style="width: 51.4385%; border-right: 1px solid black; border-top: 1px solid black;"><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">Browsing history, search history, online <bdt class="block-component"></bdt>behaviour<bdt class="else-block"></bdt>, interest data, and interactions with our and other websites, applications, systems, and advertisements</span></span></span></div></td><td style="width: 14.9084%; text-align: center; border-right: 1px solid black; border-top: 1px solid black;"><div style="line-height: 1.5;"><br></div><div data-custom-class="body_text" style="line-height: 1.5;"><bdt class="forloop-component"><span data-custom-class="body_text"><bdt class="block-component"></bdt></bdt></bdt><bdt class="block-component"></bdt><bdt class="block-component"></bdt>NO</span><bdt class="statement-end-if-in-editor"><span data-custom-class="body_text"></span></bdt></div><div style="line-height: 1.5;"><br></div></td></tr><tr><td style="width: 33.8274%; border-left: 1px solid black; border-right: 1px solid black; border-top: 1px solid black;"><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"></bdt>G<bdt class="else-block"></bdt>. Geolocation data</span></span></span></div></td><td style="width: 51.4385%; border-right: 1px solid black; border-top: 1px solid black;"><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">Device location</span></span></span></div></td><td style="width: 14.9084%; text-align: center; border-right: 1px solid black; border-top: 1px solid black;"><div style="line-height: 1.5;"><br></div><div data-custom-class="body_text" style="line-height: 1.5;"><bdt class="forloop-component"><span data-custom-class="body_text"><bdt class="block-component"></bdt></bdt></bdt><bdt class="block-component"></bdt><bdt class="block-component"></bdt>NO</span><bdt class="statement-end-if-in-editor"><span data-custom-class="body_text"></span></bdt></div><div style="line-height: 1.5;"><br></div></td></tr><tr><td style="width: 33.8274%; border-left: 1px solid black; border-right: 1px solid black; border-top: 1px solid black;"><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"></bdt>H<bdt class="else-block"></bdt>. Audio, electronic, sensory, or similar information</span></span></span></div></td><td style="width: 51.4385%; border-right: 1px solid black; border-top: 1px solid black;"><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">Images and audio, video or call recordings created in connection with our business activities</span></span></span></div></td><td style="width: 14.9084%; text-align: center; border-right: 1px solid black; border-top: 1px solid black;"><div style="line-height: 1.5;"><br></div><div data-custom-class="body_text" style="line-height: 1.5;"><bdt class="forloop-component"><span data-custom-class="body_text"><bdt class="block-component"></bdt></bdt></bdt></bdt><bdt class="block-component"></bdt><bdt class="block-component"></bdt>NO</span><bdt class="statement-end-if-in-editor"><span data-custom-class="body_text"></span></bdt></div><div style="line-height: 1.5;"><br></div></td></tr><tr><td style="width: 33.8274%; border-left: 1px solid black; border-right: 1px solid black; border-top: 1px solid black;"><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"></bdt>I<bdt class="else-block"></bdt>. Professional or employment-related information</span></span></span></div></td><td style="width: 51.4385%; border-right: 1px solid black; border-top: 1px solid black;"><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">Business contact details in order to provide you our Services at a business level or job title, work history, and professional qualifications if you apply for a job with us</span></span></span></div></td><td style="width: 14.9084%; text-align: center; border-right: 1px solid black; border-top: 1px solid black;"><div style="line-height: 1.5;"><br></div><div data-custom-class="body_text" style="line-height: 1.5;"><bdt class="forloop-component"><span data-custom-class="body_text"><bdt class="block-component"></bdt></bdt><bdt class="block-component"></bdt><bdt class="block-component"></bdt>NO</span><bdt class="statement-end-if-in-editor"><span data-custom-class="body_text"></span></bdt></div><div style="line-height: 1.5;"><br></div></td></tr><tr><td style="border-left: 1px solid black; border-right: 1px solid black; border-top: 1px solid black; width: 33.8274%;"><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"></bdt>J<bdt class="else-block"></bdt>. Education Information</span></span></span></div></td><td style="border-right: 1px solid black; border-top: 1px solid black; width: 51.4385%;"><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">Student records and directory information</span></span></span></div></td><td style="text-align: center; border-right: 1px solid black; border-top: 1px solid black; width: 14.9084%;"><div style="line-height: 1.5;"><br></div><div data-custom-class="body_text" style="line-height: 1.5;"><bdt class="forloop-component"><span data-custom-class="body_text"><bdt class="block-component"></bdt></bdt></bdt><bdt class="block-component"></bdt><bdt class="block-component"></bdt>NO</span><bdt class="statement-end-if-in-editor"><span data-custom-class="body_text"></span></bdt></div><div style="line-height: 1.5;"><br></div></td></tr><tr><td style="border-width: 1px; border-color: black; border-style: solid; width: 33.8274%;"><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"></bdt>K<bdt class="else-block"></bdt>. Inferences drawn from collected personal information</span></span></span></div></td><td style="border-bottom: 1px solid black; border-top: 1px solid black; border-right: 1px solid black; width: 51.4385%;"><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">Inferences drawn from any of the collected personal information listed above to create a profile or summary about, for example, an individuals preferences and characteristics</span></span></span></div></td><td style="text-align: center; border-right: 1px solid black; border-bottom: 1px solid black; border-top: 1px solid black; width: 14.9084%;"><div style="line-height: 1.5;"><br></div><div data-custom-class="body_text" style="line-height: 1.5;"><span data-custom-class="body_text"><bdt class="block-component"></bdt>NO<span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="statement-end-if-in-editor"></bdt></span></span></span></span></span></span></span></span></div><div style="line-height: 1.5;"><br></div></td></tr><tr><td style="border-left: 1px solid black; border-right: 1px solid black; border-bottom: 1px solid black; line-height: 1.5;"><span data-custom-class="body_text"><bdt class="block-component"></bdt>L<bdt class="else-block"></bdt>. Sensitive personal Information</span></td><td style="border-right: 1px solid black; border-bottom: 1px solid black; line-height: 1.5;"><bdt class="block-component"><span data-custom-class="body_text"></span></bdt></td><td style="border-right: 1px solid black; border-bottom: 1px solid black;"><div data-empty="true" style="text-align: center;"><br></div><div data-custom-class="body_text" data-empty="true" style="text-align: center; line-height: 1.5;"><bdt class="block-component"><span data-custom-class="body_text"></bdt>NO</span><bdt class="statement-end-if-in-editor"><span data-custom-class="body_text"></span></bdt></div><div data-empty="true" style="text-align: center;"><br></div></td></tr></tbody></table><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"></bdt></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text">We may also collect other personal information outside of these categories through instances where you interact with us in person, online, or by phone or mail in the context of:</span><bdt class="block-component"></bdt></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px;">Receiving help through our customer support channels;<bdt class="statement-end-if-in-editor"></bdt></span></li></ul><div><span style="font-size: 15px;"><bdt class="block-component"></bdt></span></div><ul><li data-custom-class="body_text"><span style="font-size: 15px;">Participation in customer surveys or contests; and<bdt class="statement-end-if-in-editor"></bdt></span></li></ul><div><span style="font-size: 15px;"><bdt class="block-component"></bdt></span></div><ul><li data-custom-class="body_text"><span style="font-size: 15px;">Facilitation in the delivery of our Services and to respond to your inquiries.</span><bdt class="statement-end-if-in-editor"><span style="font-size: 15px;"></span></bdt></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span data-custom-class="body_text"></span></bdt><span data-custom-class="body_text">We will use and retain the collected personal information as needed to provide the Services or for:<bdt class="block-component"></bdt></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span data-custom-class="body_text">Category A - <bdt class="question">As long as the user has an account with us</bdt><bdt class="statement-end-if-in-editor"></bdt></span></li></ul><div style="line-height: 1.5;"><span data-custom-class="body_text"><bdt class="block-component"><bdt class="block-component"></bdt></bdt></span></li></ul><div style="line-height: 1.5;"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></li></ul><div style="line-height: 1.5;"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></li></ul><div style="line-height: 1.5;"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></li></ul><div style="line-height: 1.5;"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></li></ul><div style="line-height: 1.5;"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></li></ul><div style="line-height: 1.5;"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></li></ul><div style="line-height: 1.5;"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></li></ul><div style="line-height: 1.5;"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></li></ul><div style="line-height: 1.5;"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></li></ul><div style="line-height: 1.5;"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span><bdt class="statement-end-if-in-editor"><span data-custom-class="body_text"></span></bdt></li></ul><div style="line-height: 1.5;"><strong><span style="font-size: 15px;"><span data-custom-class="heading_2"><h3>Sources of Personal Information</h3></span></span></strong><span style="font-size: 15px;"><span data-custom-class="body_text">Learn more about the sources of personal information we collect in <bdt class="block-component"></bdt>'<bdt class="else-block"></bdt></span></span><span style="color: rgb(0, 58, 250);"><span data-custom-class="body_text"><a data-custom-class="link" href="#infocollect"><span style="color: rgb (0, 58, 250); font-size: 15px;">WHAT INFORMATION DO WE COLLECT?</span></a></span></span><span style="font-size: 15px;"><span data-custom-class="body_text"><bdt class="block-component"></bdt>'<bdt class="else-block"></span></bdt></span><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><strong><span data-custom-class="heading_2"><h3>How We Use and Share Personal Information</h3></span></strong></span></span><span data-custom-class="body_text" style="font-size: 15px;"><bdt class="block-component"></bdt>Learn more about how we use your personal information in the section, <bdt class="block-component"></bdt>'<bdt class="else-block"></bdt></span><a data-custom-class="link" href="#infouse"><span style="color: rgb(0, 58, 250); font-size: 15px;">HOW DO WE PROCESS YOUR INFORMATION?</span></a><span data-custom-class="body_text" style="font-size: 15px;"><bdt class="block-component"></bdt>'<bdt class="else-block"></span></bdt></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span data-custom-class="body_text"><bdt class="block-component"></bdt><bdt class="block-component"></bdt></span></span></span></span></span></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">We collect and share your personal information through:<span style="color: rgb(89, 89, 89); font-size: 15px;"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></span></span></span></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">Targeting cookies/Marketing cookies<span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="statement-end-if-in-editor"></bdt></span></span></span></span></span></span></span></span></li></ul><div><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="statement-end-if-in-editor"><bdt class="block-component"></bdt></span></span></span></span></span></span></span></span></span></span></li></ul><div><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></span></span></span></span></span></span></span></span></span></span></span></li></ul><div><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></span></span></span></span></span></span></span></span></span></span></span></span></span></li></ul><div><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></li></ul><div><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="statement-end-if-in-editor"><bdt class="block-component"></bdt></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span data-custom-class="body_text"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="statement-end-if-in-editor"></bdt></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span data-custom-class="body_text"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="statement-end-if-in-editor"></bdt></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></bdt></bdt></span></span></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><strong>Will your information be shared with anyone else?</strong></span></span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">We may disclose your personal information with our service providers pursuant to a written contract between us and each service provider. Learn more about how we disclose personal information to in the section, <bdt class="block-component"></bdt>'<bdt class="else-block"></bdt></span></span></span><a data-custom-class="link" href="#whoshare"><span style="font-size: 15px; color: rgb(0, 58, 250);"><span style="font-size: 15px; color: rgb(0, 58, 250);">WHEN AND WITH WHOM DO WE SHARE YOUR PERSONAL INFORMATION?</span></span></a><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"></bdt>'<bdt class="else-block"></bdt></span></span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">We may use your personal information for our own business purposes, such as for undertaking internal research for technological development and demonstration. This is not considered to be <bdt class="block-component"></bdt>'selling'<bdt class="else-block"></bdt> of your personal information.<span style="color: rgb(89, 89, 89); font-size: 15px;"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></span></span></span><bdt class="block-component"></bdt></span></span></span></span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt><span data-custom-class="body_text"><span style="font-size: 15px;">We have not sold or shared any personal information to third parties for a business or commercial purpose in the preceding twelve (12) months.</span></span><bdt class="statement-end-if-in-editor"><span style="font-size: 15px;"><span data-custom-class="body_text"></span></span></bdt><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text">We have disclosed the following categories of personal information to third parties for a business or commercial purpose in the preceding twelve (12) months:<bdt class="forloop-component"></bdt></span></span></span></span></span></span></span></li></ul><p style="font-size: 15px;"><span style="font-size: 15px;"><bdt class="forloop-component"></bdt><bdt class="block-component"></bdt></span></span></span><span data-custom-class="body_text"><span style="color: rgb(89, 89, 89);"><bdt class="forloop-component"></bdt></span></span></span></span></span></span></span></li></ul><p style="font-size: 15px; line-height: 1.5;"><bdt class="forloop-component"><bdt class="block-component"></bdt></li></ul><p style="font-size: 15px; line-height: 1.5;"><bdt class="forloop-component"></li></ul><p style="font-size: 15px;"><span style="font-size: 15px;"><bdt class="forloop-component"></bdt></span></span></span></span></span></span></span></li></ul><p style="font-size: 15px;"><span style="font-size: 15px;"><bdt class="forloop-component"></bdt></span></span></span></span></span></span></span></li></ul><p style="font-size: 15px;"><span style="font-size: 15px;"><bdt class="forloop-component"></bdt></span></span></span></span></span></span></span></li></ul><p style="font-size: 15px;"><span style="font-size: 15px;"><bdt class="forloop-component"></bdt></span></span></span></span></span></span></span></li></ul><p style="font-size: 15px;"><span style="font-size: 15px;"><bdt class="forloop-component"></bdt></span></span></span></span></span></span></span></li></ul><p style="font-size: 15px;"><span style="font-size: 15px;"><bdt class="forloop-component"></bdt></span></span></span></span></span></span></span></li></ul><p style="font-size: 15px;"><span style="font-size: 15px;"><bdt class="forloop-component"></bdt></span></span></span></span></span></span></span></li></ul><div style="line-height: 1.5;"><span style="font-size: 15px;"><bdt class="forloop-component"></bdt></span></span></span></span></span></span></span></li></ul><p style="font-size: 15px;"><bdt class="forloop-component"></bdt></span></span></span></span></span></span></span></span></li></ul><p style="font-size: 15px;"><bdt class="forloop-component"></bdt></span></span></span></span></span></span></span></span></li></ul><p style="font-size: 15px;"><bdt class="forloop-component"><span style="font-size: 15px;"></bdt></span></span></span></span></span></span></span></li></ul><p style="font-size: 15px;"><span style="font-size: 15px;"><bdt class="forloop-component"></bdt></span></span></span></span></span></span></span></li></ul><div><span style="font-size: 15px;"><bdt class="forloop-component"></bdt></span></span></span></span></span></span></span></span></li></ul><div><bdt class="forloop-component"><span style="font-size: 15px;"></bdt></span></span></span></span></span></span></span></span></li></ul><div><bdt class="forloop-component"><span style="font-size: 15px;"></bdt></span></span></span></span></span></span></span></span></li></ul><div><bdt class="forloop-component"><span style="font-size: 15px;"></bdt></span></span></span></span></span></span></span></span></li></ul><div><bdt class="block-component"><span style="font-size: 15px;"></bdt></span></span></span></span></span></span></span></span></span></span></span></li></ul><div><bdt class="block-component"></span></bdt></li></ul><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">The categories of third parties to whom we disclosed personal information for a business or commercial purpose can be found under <bdt class="block-component"></bdt>'<bdt class="else-block"></bdt><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="color: rgb(0, 58, 250);"><a data-custom-class="link" href="#whoshare">WHEN AND WITH WHOM DO WE SHARE YOUR PERSONAL INFORMATION?</a></span><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="color: rgb(89, 89, 89);"><bdt class="block-component"></bdt>'<bdt class="else-block"></bdt></span></span></span></span></span></span></span></span></span></span></span><span data-custom-class="body_text"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="statement-end-if-in-editor"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="statement-end-if-in-editor"></bdt></span></span></span></span></span></span></span></span></span></bdt></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span data-custom-class="body_text"><span style="color: rgb(0, 0, 0);"><span data-custom-class="body_text"><bdt class="block-component"></bdt></span></span></span></span></span></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><strong><span data-custom-class="heading_2"><h3>Your Rights</h3></span></strong><span data-custom-class="body_text">You have rights under certain US state data protection laws. However, these rights are not absolute, and in certain cases, we may decline your request as permitted by law. These rights include:</span><bdt class="block-component"></bdt></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px;"><strong>Right to know</strong> whether or not we are processing your personal data<bdt class="statement-end-if-in-editor"></bdt></span></li></ul><div style="line-height: 1.5;"><span style="font-size: 15px;"><bdt class="block-component"></bdt></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px;"><strong>Right to access</strong>your personal data<bdt class="statement-end-if-in-editor"></bdt></span></li></ul><div style="line-height: 1.5;"><span style="font-size: 15px;"><bdt class="block-component"></bdt></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px;"><strong>Right to correct</strong>inaccuracies in your personal data<bdt class="statement-end-if-in-editor"></bdt></span></li></ul><div style="line-height: 1.5;"><span style="font-size: 15px;"><bdt class="block-component"></bdt></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px;"><strong>Right to request</strong> the deletion of your personal data<bdt class="statement-end-if-in-editor"></bdt></span></li></ul><div style="line-height: 1.5;"><span style="font-size: 15px;"><bdt class="block-component"></bdt></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px;"><strong>Right to obtain a copy</strong>of the personal data you previously shared with us<bdt class="statement-end-if-in-editor"></bdt></span></li></ul><div style="line-height: 1.5;"><span style="font-size: 15px;"><bdt class="block-component"></bdt></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px;"><strong>Right to non-discrimination</strong> for exercising your rights<bdt class="statement-end-if-in-editor"></bdt></span></li></ul><div style="line-height: 1.5;"><span style="font-size: 15px;"><bdt class="block-component"></bdt></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px;"><strong>Right to opt out</strong> of the processing of your personal data if it is used for targeted advertising<bdt class="block-component"></bdt> (or sharing as defined under Californias privacy law)<bdt class="statement-end-if-in-editor"></bdt>, the sale of personal data, or profiling in furtherance of decisions that produce legal or similarly significant effects (<bdt class="block-component"></bdt>'profiling'<bdt class="else-block"></bdt>)<bdt class="statement-end-if-in-editor"></bdt></span></li></ul><div style="line-height: 1.5;"><span style="font-size: 15px;"><bdt class="block-component"></bdt></span></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text">Depending upon the state where you live, you may also have the following rights:</span><bdt class="block-component"></bdt></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px;">Right to access the categories of personal data being processed (as permitted by applicable law, including the privacy law in Minnesota)<bdt class="statement-end-if-in-editor"></bdt></span></li></ul><div style="line-height: 1.5;"><span style="font-size: 15px;"><bdt class="block-component"></bdt></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px;">Right to obtain a list of the categories of third parties to which we have disclosed personal data (as permitted by applicable law, including the privacy law in<bdt class="block-component"></bdt> California, Delaware, and Maryland<bdt class="else-block"></bdt><bdt class="block-component"></bdt>)<bdt class="statement-end-if-in-editor"></bdt></span></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"></span></bdt></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px;">Right to obtain a list of specific third parties to which we have disclosed personal data (as permitted by applicable law, including the privacy law in<bdt class="block-component"></bdt> Minnesota and Oregon<bdt class="else-block"></bdt>)</span><bdt class="statement-end-if-in-editor"><span style="font-size: 15px;"></span></bdt></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"></span></bdt></div><ul><li data-custom-class="body_text" style="line-height: 1.5; font-size: 15px;">Right to obtain a list of third parties to which we have sold personal data (as permitted by applicable law, including the privacy law in Connecticut)<bdt class="statement-end-if-in-editor"></bdt></li></ul><div style="line-height: 1.5;"><span style="font-size: 15px;"><bdt class="block-component"></bdt></span></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px;">Right to review, understand, question, and depending on where you live, correct how personal data has been profiled (as permitted by applicable law, including the privacy law in <bdt class="block-component"></bdt>Connecticut and Minnesota<bdt class="else-block"></bdt>)<bdt class="statement-end-if-in-editor"></bdt></span></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"></span></bdt></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px;">Right to limit use and disclosure of sensitive personal data (as permitted by applicable law, including the privacy law in California)</span><bdt class="statement-end-if-in-editor"><span style="font-size: 15px;"></span></bdt></li></ul><div style="line-height: 1.5;"><bdt class="block-component"><span style="font-size: 15px;"></span></bdt></div><ul><li data-custom-class="body_text" style="line-height: 1.5;"><span style="font-size: 15px;">Right to opt out of the collection of sensitive data and personal data collected through the operation of a voice or facial recognition feature (as permitted by applicable law, including the privacy law in Florida)</span><bdt class="statement-end-if-in-editor"><span style="font-size: 15px;"></span></bdt></li></ul><div style="line-height: 1.5;"><span style="font-size: 15px;"><bdt class="statement-end-if-in-editor"></bdt></span><strong><span style="font-size: 15px;"><span data-custom-class="heading_2"><h3>How to Exercise Your Rights</h3></span></span></strong><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">To exercise these rights, you can contact us <bdt class="block-component"></bdt>by visiting <span style="color: rgb(0, 58, 250);"><bdt class="question"><a target="_blank" data-custom-class="link" href="mailto:secret-badge-sulk@duck.com">secret-badge-sulk@duck.com</a></bdt></span>, <bdt class="else-block"></bdt></span><span style="color: rgb(89, 89, 89); font-size: 15px;"><span data-custom-class="body_text"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span data-custom-class="body_text"><bdt class="block-component"></bdt>by emailing us at <bdt class="question"><a target="_blank" data-custom-class="link" href="mailto:tj7755@duck.com">tj7755@duck.com</a></bdt>, <bdt class="statement-end-if-in-editor"></bdt><bdt class="block-component"></bdt></span><span data-custom-class="body_text"><bdt class="block-component"></bdt><bdt class="block-component"><span data-custom-class="body_text"><bdt class="block-component"></bdt></bdt></span></span></span></span></span></span></span></span></span></span></span></span><span data-custom-class="body_text">or by referring to the contact details at the bottom of this document.</span></span></span><bdt class="block-component"><span style="font-size: 15px;"></span></bdt><bdt class="block-component"><span style="font-size: 15px;"></span></bdt></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text">Under certain US state data protection laws, you can designate an <bdt class="block-component"></bdt>authorised<bdt class="else-block"></bdt> agent to make a request on your behalf. We may deny a request from an <bdt class="block-component"></bdt>authorised<bdt class="else-block"></bdt> agent that does not submit proof that they have been validly <bdt class="block-component"></bdt>authorised<bdt class="else-block"></bdt> to act on your behalf in accordance with applicable laws.</span><br><strong><span data-custom-class="heading_2"><h3>Request Verification</h3></span></strong><span data-custom-class="body_text">Upon receiving your request, we will need to verify your identity to determine you are the same person about whom we have the information in our system. We will only use personal information provided in your request to verify your identity or authority to make the request. However, if we cannot verify your identity from the information already maintained by us, we may request that you provide additional information for the purposes of verifying your identity and for security or fraud-prevention purposes.</span></span></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><br></span></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text">If you submit the request through an <bdt class="block-component"></bdt>authorised<bdt class="else-block"></bdt> agent, we may need to collect additional information to verify your identity before processing your request and the agent will need to provide a written and signed permission from you to submit such request on your behalf.</span></span><bdt class="block-component"><span style="font-size: 15px;"></span></bdt><span style="font-size: 15px;"><span data-custom-class="heading_2"><strong><h3>Appeals</h3></strong></span><span data-custom-class="body_text">Under certain US state data protection laws, if we decline to take action regarding your request, you may appeal our decision by emailing us at <bdt class="block-component"></bdt><bdt class="question noTranslate"><a target="_blank" data-custom-class="link" href="mailto:secret-badge-sulk@duck.com">secret-badge-sulk@duck.com</a></bdt><bdt class="else-block"></bdt>. We will inform you in writing of any action taken or not taken in response to the appeal, including a written explanation of the reasons for the decisions. If your appeal is denied, you may submit a complaint to your state attorney general.</span><bdt class="statement-end-if-in-editor"></bdt></span><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span data-custom-class="body_text"><bdt class="block-component"><bdt class="block-component"></span></bdt></span></span></span></span></span></span></span></span></span></span><bdt class="block-component"><span style="font-size: 15px;"></span></bdt><span style="font-size: 15px;"><strong><span data-custom-class="heading_2"><h3>California <bdt class="block-component"></bdt>'Shine The Light'<bdt class="else-block"></bdt> Law</h3></span></strong><span data-custom-class="body_text">California Civil Code Section 1798.83, also known as the <bdt class="block-component"></bdt>'Shine The Light'<bdt class="else-block"></bdt> law, permits our users who are California residents to request and obtain from us, once a year and free of charge, information about categories of personal information (if any) we disclosed to third parties for direct marketing purposes and the names and addresses of all third parties with which we shared personal information in the immediately preceding calendar year. If you are a California resident and would like to make such a request, please submit your request in writing to us by using the contact details provided in the section <bdt class="block-component"></bdt>'<bdt class="else-block"></bdt></span></span><span data-custom-class="body_text"><a data-custom-class="link" href="#contact"><span style="color: rgb(0, 58, 250); font-size: 15px;">HOW CAN YOU CONTACT US ABOUT THIS NOTICE?</span></a></span><span style="font-size: 15px;"><span data-custom-class="body_text"><bdt class="block-component"></bdt>'<bdt class="else-block"></span></bdt></span><bdt class="statement-end-if-in-editor"><span style="font-size: 15px;"></span></bdt><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span data-custom-class="body_text"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span data-custom-class="body_text"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span data-custom-class="body_text"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span data-custom-class="body_text"><bdt class="statement-end-if-in-editor"><span data-custom-class="body_text"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span data-custom-class="body_text"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span data-custom-class="body_text"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span data-custom-class="body_text"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span data-custom-class="body_text"><bdt class="statement-end-if-in-editor"><bdt class="statement-end-if-in-editor"></bdt></bdt></span></span></span></span></span></span></span></span></span></span></span></bdt></span></span></span></span></span></span></span></span></span></span><bdt class="block-component"><span style="font-size: 15px;"></bdt></span><bdt class="block-component"><span style="font-size: 15px;"></span></bdt></div><div style="line-height: 1.5;"><br></div><div id="policyupdates" style="line-height: 1.5;"><span style="color: rgb(127, 127, 127);"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span id="control" style="color: rgb(0, 0, 0);"><strong><span data-custom-class="heading_1"><h2>12. DO WE MAKE UPDATES TO THIS NOTICE?</h2></span></strong></span></span></span></span></span><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><em><strong>In Short:</strong>Yes, we will update this notice as necessary to stay compliant with relevant laws.</em></span></span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">We may update this Privacy Notice from time to time. The updated version will be indicated by an updated <bdt class="block-component"></bdt>'Revised'<bdt class="else-block"></bdt> date at the top of this Privacy Notice. If we make material changes to this Privacy Notice, we may notify you either by prominently posting a notice of such changes or by directly sending you a notification. We encourage you to review this Privacy Notice frequently to be informed of how we are protecting your information.</span></span></span></div><div style="line-height: 1.5;"><br></div><div id="contact" style="line-height: 1.5;"><span style="color: rgb(127, 127, 127);"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span id="control" style="color: rgb(0, 0, 0);"><strong><span data-custom-class="heading_1"><h2>13. HOW CAN YOU CONTACT US ABOUT THIS NOTICE?</h2></span></strong></span></span></span></span></span><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">If you have questions or comments about this notice, you may <span style="color: rgb(89, 89, 89); font-size: 15px;"><span data-custom-class="body_text"><bdt class="block-component"><bdt class="block-component"></bdt></bdt>email us at <bdt class="question noTranslate"><a target="_blank" data-custom-class="link" href="mailto:tj7755@duck.com">tj7755@duck.com</a> or</bdt><bdt class="statement-end-if-in-editor"><bdt class="block-component"></bdt></bdt></span></span><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text">contact us by post at:</span></span></span></span></span></span></div><div style="line-height: 1.5;"><br></div><div style="line-height: 1.5;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><span style="font-size: 15px;"><span style="color: rgb(89, 89, 89);"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="question noTranslate">Lagiote Revise</bdt></span></span></span></span></span><span data-custom-class="body_text"><span style="color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"></bdt></bdt></span></span></span></span></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text"><bdt class="question noTranslate">__________</bdt><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><bdt class="block-component"></bdt></span></span></span></bdt></span></div><div style="line-height: 1.5;"><span style="font-size: 15px;"><span data-custom-class="body_text"><bdt class="question">__________</bdt><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><bdt class="block-component"></bdt><bdt class="block-component"></bdt><bdt class="block-component"></bdt></span></span></span><span data-custom-class="body_text"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><bdt class="statement-end-if-in-editor"><bdt class="block-component"></bdt></bdt></span></span></span></bdt></span></span></span></span><span data-custom-class="body_text"><span style="font-size: 15px;"><span data-custom-class="body_text"><span style="color: rgb(89, 89, 89);"><bdt class="statement-end-if-in-editor"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;"><span data-custom-class="body_text"><bdt class="block-component"><bdt class="block-component"></bdt></span></span></span></span></span></span><bdt class="block-component"><span style="font-size: 15px;"></span></bdt><span style="font-size: 15px;"><span data-custom-class="body_text"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span style="font-size: 15px;"><span data-custom-class="body_text"><bdt class="statement-end-if-in-editor"><bdt class="block-component"></bdt></span></span></div><div style="line-height: 1.5;"><br></div><div id="request" style="line-height: 1.5;"><span style="color: rgb(127, 127, 127);"><span style="color: rgb(89, 89, 89); font-size: 15px;"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span id="control" style="color: rgb(0, 0, 0);"><strong><span data-custom-class="heading_1"><h2>14. HOW CAN YOU REVIEW, UPDATE, OR DELETE THE DATA WE COLLECT FROM YOU?</h2></span></strong></span></span></span></span></span><span style="font-size: 15px; color: rgb(89, 89, 89);"><span style="font-size: 15px; color: rgb(89, 89, 89);"><span data-custom-class="body_text"><bdt class="block-component"></bdt>Based on the applicable laws of your country<bdt class="block-component"></bdt> or state of residence in the US<bdt class="statement-end-if-in-editor"></bdt>, you may<bdt class="else-block"><bdt class="block-component"> have the right to request access to the personal information we collect from you, details about how we have processed it, correct inaccuracies, or delete your personal information. You may also have the right to <bdt class="block-component"></bdt>withdraw your consent to our processing of your personal information. These rights may be limited in some circumstances by applicable law. To request to review, update, or delete your personal information, please <bdt class="block-component"></span></bdt><span data-custom-class="body_text">visit: <span style="color: rgb(0, 58, 250);"><bdt class="question"><a target="_blank" data-custom-class="link" href="mailto:secret-badge-sulk@duck.com">secret-badge-sulk@duck.com</a></bdt></span><bdt class="else-block"></bdt></span></span><span data-custom-class="body_text">.</span></span></span></div><style>
      ul {
        list-style-type: square;
      }
      ul > li > ul {
        list-style-type: circle;
      }
      ul > li > ul > li > ul {
        list-style-type: square;
      }
      ol li {
        font-family: Arial ;
      }
    </style>
      </div>
      
</body>
</html>
